<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>A Trap When Using letter-spacing to Remove the Extra Space in chrome66.0.3359.139</title>
    <url>/blog/2018/06/a-trap-when-using-letter-spacing-to-remove-the-extra-space-in-chrome66.0.3359.139/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>As we all know there would be extra space between inline-blocks when using inline-block layout. There are lots of solutions like <code>font-size:0</code>,<code>word-spacing</code>,<code>margin-left</code>,<code>letter-spacing</code> and so on.</p>
<h2 id="Choice-I-Made"><a href="#Choice-I-Made" class="headerlink" title="Choice I Made"></a>Choice I Made</h2><p>Normally I prefer using <code>letter-spacing</code> because</p>
<ol>
<li>it seems ok when we assign a value which is bigger than the width of extra space(e.g. <code>-1em</code>).</li>
<li>However, it won’t be okay with <code>word-spacing</code> and <code>margin-left</code> when we set bigger value like <code>-1em</code>.</li>
<li>Using <code>font-size</code> is not convenient when we try to using <code>em</code> as <code>font-size</code> unit.</li>
</ol>
<p>So, <code>letter-spacing</code> seems to be the best choice.</p>
<p>Well, I agree with that though I found a bug in chrome66.0.3359.139 today.</p>
<h2 id="Bug-I-Found"><a href="#Bug-I-Found" class="headerlink" title="Bug I Found"></a>Bug I Found</h2><p>Please run the code below:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"nav"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"nav__text"</span>&gt;</span>nav1<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"nav__text"</span>&gt;</span>nav2<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"nav__text"</span>&gt;</span>nav3<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">  <span class="attribute">color</span>: inherit;</span><br><span class="line">  <span class="attribute">cursor</span>: auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">260px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">letter-spacing</span>: -<span class="number">1em</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nav__text</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">90px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid black;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">letter-spacing</span>: normal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you are using Chrome(test version 66.0.3359.139) or Opera(test version 53.0.2907.99), what you see might be:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180618184625.png"></p>
<p>If you are using Firefox(60.0.2),IE10 or Edge, what you see might be:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180618184736.png"></p>
<p>That’s interesting. So, I checked the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/letter-spacing" target="_blank" rel="noopener">mdn-letter-spacing</a> and found this:</p>
<blockquote>
<length>
Specifies extra inter-character space in addition to the default space between characters. Values may be negative, but there may be implementation-specific limits. **User agents may not further increase or decrease the inter-character space in order to justify text.**
</length></blockquote>
<p>It seems that this is the reason.</p>
<p>So, I tested and try to find the best value for <code>letter-spacing</code> and <strong>it turns out that <code>0.3em</code> or <code>0.31em</code> is the best value.</strong></p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>Anyway, <code>letter-spacing</code> is still the best solution though we have to be more careful.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/letter-spacing" target="_blank" rel="noopener">mdn-letter-spacing</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>chrome</tag>
        <tag>inline-block</tag>
        <tag>letter-spacing</tag>
      </tags>
  </entry>
  <entry>
    <title>About Smooth Scroll</title>
    <url>/blog/2018/06/about-smooth-scroll/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>Recently, I need to make a smooth scroll. Of course, I think of <code>setTimeout</code>. However, I was thinking if there is a better way or API. So, here is the result of my research.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollTo" target="_blank" rel="noopener">scrollTo</a></li>
</ul>
<p>You can use it like:</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.scrollTo(&#123;</span><br><span class="line">  top: <span class="number">1000</span>,</span><br><span class="line">  behavior: <span class="string">'smooth'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>It works in Chrome and Firefox. However, <code>IE</code> and <code>Edge</code> doesn’t support. Code above will run like</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.scrollTo(<span class="number">0</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>Similar API also exists like <code>scrollIntoView</code> or <code>scrollBy</code>. The compatibility is the key problem.</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" target="_blank" rel="noopener">requestAnimationFrame</a></li>
</ul>
<p>I would suggest this API instead of <code>setTimeout</code>. However, the process of implementation is not so easy like an existing API. Well, a little more complicated than <code>setTimeout</code>. However, compared with <code>setTimeout</code>, <code>requestanimationframe</code> has higher performance. Want to know more? Check the reference and SO. Also, here is the demo:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> animationFrameId = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">smoothScoll</span>(<span class="params">targetScrollTop</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> speed = <span class="number">0.1</span>;</span><br><span class="line">  <span class="keyword">let</span> startTime = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> timeLimit = <span class="number">2000</span>;</span><br><span class="line">  <span class="built_in">window</span>.cancelAnimationFrame(animationFrameId);</span><br><span class="line">  animationFrameId = <span class="built_in">window</span>.requestAnimationFrame(step);</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params">timestamp</span>) </span>&#123;</span><br><span class="line">    startTime = startTime || timestamp;</span><br><span class="line">    <span class="keyword">let</span> interval = timestamp - startTime;</span><br><span class="line">    <span class="keyword">let</span> distance = targetScrollTop - getWinScrollTop();</span><br><span class="line">    <span class="keyword">let</span> stepSize = speed * distance;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="built_in">Math</span>.ceil(stepSize)) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        stepSize = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        stepSize = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (distance !== <span class="number">0</span> &amp;&amp; interval &lt; timeLimit) &#123;</span><br><span class="line">      <span class="built_in">window</span>.scrollTo(<span class="number">0</span>, getWinScrollTop() + stepSize);</span><br><span class="line">      animationFrameId = <span class="built_in">window</span>.requestAnimationFrame(step);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getWinScrollTop</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.scrollY || <span class="built_in">window</span>.pageYOffset;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The latest version can be found in my github <a href="https://github.com/xianshenglu/smoothScroll">smoothScroll</a>.</p>
<p>However, the compatibility is not good enough because of <code>IE&lt;10</code> and <code>Opera Mini</code>.</p>
<ul>
<li>Other solution</li>
</ul>
<p>Code for <code>setTimeout</code> is similar with <code>requestAnimationFrame</code> but I won’t talk about it. Except that, jQuery has provided an API like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="string">"a[href='#top']"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  $(<span class="string">'html, body'</span>).animate(&#123; <span class="attr">scrollTop</span>: <span class="number">0</span> &#125;, <span class="string">'slow'</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>Anyway, use <code>requestAnimationFrame</code> if possible. And if not, use <code>setTimeout</code> as shim.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://stackoverflow.com/questions/38709923/why-is-requestanimationframe-better-than-setinterval-or-settimeout" target="_blank" rel="noopener">Why is requestAnimationFrame better than setInterval or setTimeout</a></p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>smooth-scroll</tag>
        <tag>scrollTo</tag>
        <tag>requestAnimationFrame</tag>
        <tag>setTimeout</tag>
      </tags>
  </entry>
  <entry>
    <title>在 VirtualBox 中访问局域网</title>
    <url>/blog/2018/08/access-lan-in-virtualbox/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>工作需要，在 MAC 中开发，调试的时候，就装了 virtualBox 虚拟机来调试 IE，但是开发中经常调试的是局域网的网址，比如 <code>localhost:8080</code>，我可以用 <code>192.168.x.x:8080</code> 在局域网中另一台设备上访问，但是放到虚拟机中就不行了。</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>经搜索，方案如下：</p>
<p>在虚拟系统未打开的情况下,在设置》网络属性中设置两个网络连接：</p>
<ul>
<li>网络连接 1 设置成 NAT，</li>
<li>网络连接 2 设置成 Bridged Adapter,名称是 eth0（这个我没找到，但是选的另一个）</li>
</ul>
<p>这样的话就可以联上互联网同时可以连上局域网。</p>
<p>但是在这种情况下，在虚拟机中输入网址时，遇到 老版的 IE ，需要输入在局域网网址前加 http:&#x2F;&#x2F; 否则，直接输 192.168.x.x 可能会变成自动搜索。</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://blog.csdn.net/ppby2002/article/details/6455892" target="_blank" rel="noopener">设置 VirtualBox 虚拟机访问局域网</a></p>
]]></content>
      <categories>
        <category>software</category>
      </categories>
      <tags>
        <tag>VirtualBox</tag>
        <tag>LAN</tag>
        <tag>192.168.x.x</tag>
        <tag>chinese</tag>
      </tags>
  </entry>
  <entry>
    <title>Angular is not that good before 2023</title>
    <url>/blog/2023/08/angular-is-not-that-good-before-2023/</url>
    <content><![CDATA[<p>You might have often heard someone saying that</p>
<blockquote>
<p>Angular is waiting for you in 3 years.</p>
<p>Angular is better for big or enterprise project</p>
<p>Angular provides an excellent updating experience</p>
<p>…</p>
</blockquote>
<p>In this article, I’ll show you why I think Angular is not as good as you have heard <strong>before 2023 Angular 15, 16</strong>.</p>
<p><strong>Of course, I can’t be 100% fair when comparing Angular with other frameworks&#x2F;libs. Also, because I’m trying to demo that Angular before 2023 is not that good, so I’ll focus too much on the disadvantages. It’s unfair for Angular. After 2023, Angular is getting much better but I’ll cover those parts in other articles.</strong></p>
<p>To be fair, I’m creating 2 projects, 1 for Angular, 1 for Vue in 2023&#x2F;8&#x2F;15.</p>
<p>For Angular, I’m creating with <code>ng new my-app-angular</code> with <code>@angular/cli@16.2.0</code>.<br>For Vue, I’m creating with <code>npm create vue@latest</code> with <code>create-vue@3.7.2</code>.</p>
<p>And I will demo it step by step.</p>
<h3 id="Too-simple-template-when-creating-a-new-project"><a href="#Too-simple-template-when-creating-a-new-project" class="headerlink" title="Too simple template when creating a new project"></a>Too simple template when creating a new project</h3><p>When creating a new project with Angular CLI, I have 2 options</p>
<ul>
<li>Need routing</li>
<li>CSS format</li>
</ul>
<p><img src="/blog/images/Snipaste_2023-08-15_00-09-52.png"></p>
<p>While with Vue CLI,</p>
<p><img src="/blog/images/Snipaste_2023-08-15_00-13-34.png"></p>
<p>besides the 2 options, I also have more than 4 options</p>
<ul>
<li>state-management lib</li>
<li>e2e test lib</li>
<li><code>ESLint</code></li>
<li><code>Prettier</code> for code formatting</li>
<li>……</li>
</ul>
<p>To be honest, in my opinion, for a big or enterprise project configuring the above 4 options is important.</p>
<p>If developers are not a senior or professional front-end engineer, or just want to save some time, and the CLI doesn’t provide these options, they’re easily missing.</p>
<p>If they’re not set up at the beginning of a big project, it’s not easy to make all team members agree on one specific solution. Some people like this state management lib while others like another one. Some people like semi while others don’t…</p>
<p>Even luckily, developers set it up in the iteration, there’s still some legacy codes need to migrate.</p>
<p>By the way, Angular doesn’t have an official state-management solution until now. Angular added this feature to the backlog in 2022 because of <a href="https://github.com/angular/angular/issues/46662">this issue</a>. Until now, the most starred state management solution for Angular is <a href="https://github.com/ngrx/platform">ngrx</a>. And there’re also many people using their own designed state management lib with <code>RxJs</code> and <code>DI</code>.</p>
<h3 id="Too-simple-default-project-folder-structure"><a href="#Too-simple-default-project-folder-structure" class="headerlink" title="Too simple default project folder structure"></a>Too simple default project folder structure</h3><p>For Angular, I don’t even know how to code with the template before I find the <a href="https://angular.io/guide/styleguide#overall-structural-guidelines" target="_blank" rel="noopener">CodingStyleGuide</a> chapter.</p>
<p><img src="/blog/images/Snipaste_2023-08-15_22-53-07.png"></p>
<ul>
<li>Where to put router views?</li>
<li>Where to put shared code?</li>
<li>…</li>
</ul>
<p>While for Vue, I think developers can code immediately.</p>
<p><img src="/blog/images/Snipaste_2023-08-15_22-56-12.png"></p>
<p>Anyway, I’ll follow the Angular style guide to create a <code>heroes</code> feature module. </p>
<p><img src="/blog/images/Snipaste_2023-08-16_00-05-27.png"></p>
<p><em>The demo code is copied from Angular homepage demo.</em></p>
<p>And here is the UI:</p>
<p><img src="/blog/images/Snipaste_2023-08-20_16-13-19.png"></p>
<h3 id="Default-change-detection-strategy-is-a-performance-killer"><a href="#Default-change-detection-strategy-is-a-performance-killer" class="headerlink" title="Default change detection strategy is a performance killer"></a>Default change detection strategy is a performance killer</h3><p>Have you noticed how many times the function is called at the console when the page is loaded? <strong>6*9&#x3D;54 times!</strong> Here is the code</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Heroes<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"heroes"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span></span></span><br><span class="line"><span class="tag">    *<span class="attr">ngFor</span>=<span class="string">"let hero of heroes$ | async"</span></span></span><br><span class="line"><span class="tag">    [<span class="attr">class.selected</span>]=<span class="string">"hero.id === selectedId"</span></span></span><br><span class="line"><span class="tag">    [<span class="attr">class.sensitive</span>]=<span class="string">"isSensitiveHeroName(hero)"</span></span></span><br><span class="line"><span class="tag">    (<span class="attr">mouseenter</span>)=<span class="string">"showTooltip()"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> [<span class="attr">routerLink</span>]=<span class="string">"['/hero', hero.id]"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"badge"</span>&gt;</span>&#123;&#123; hero.id &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#123;&#123; hero.name &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">routerLink</span>=<span class="string">"/sidekicks"</span>&gt;</span>Go to sidekicks<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">"app-hero-list"</span>,</span><br><span class="line">  templateUrl: <span class="string">"./hero-list.component.html"</span>,</span><br><span class="line">  styleUrls: [<span class="string">"./hero-list.component.scss"</span>],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HeroListComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line">  heroes$!: Observable&lt;Hero[]&gt;;</span><br><span class="line">  selectedId = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> service: HeroService, <span class="keyword">private</span> route: ActivatedRoute</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    <span class="keyword">this</span>.heroes$ = <span class="keyword">this</span>.route.paramMap.pipe(</span><br><span class="line">      switchMap(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.selectedId = <span class="built_in">parseInt</span>(params.get(<span class="string">"id"</span>)!, <span class="number">10</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.service.getHeroes();</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  isSensitiveHeroName(hero: Hero) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"isSensitiveHeroName"</span>);</span><br><span class="line">    <span class="keyword">return</span> hero.name.toLowerCase().includes(<span class="string">"sex"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  showTooltip() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And if you move your mouse from top to bottom, the function will be triggered <strong>2*9*9 times!</strong></p>
<p><img src="/blog/images/Snipaste_2023-08-20_16-25-47.png"></p>
<p>In this case, we can use the <code>OnPush</code> strategy.</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span>(&#123;</span><br><span class="line">  selector: <span class="string">'app-hero-list'</span>,</span><br><span class="line">  templateUrl: <span class="string">'./hero-list.component.html'</span>,</span><br><span class="line">  styleUrls: [<span class="string">'./hero-list.component.scss'</span>],</span><br><span class="line">  changeDetection: ChangeDetectionStrategy.OnPush <span class="comment">// +</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>isSensitiveHeroName</code> will be triggered <strong>9</strong> times in the first time and <strong>9*9</strong> times for <code>mouseenter</code> event.</p>
<p><img src="/blog/images/Snipaste_2023-08-20_16-42-37.png"></p>
<p>So the performance is improved by 1200% with <code>OnPush</code> strategy. <strong>In reality, if we want to change the <code>Default</code> strategy to <code>OnPush</code>, we need to apply more changes, not just one line in this demo.</strong></p>
<p>Regarding this case, there’s a better solution for Angular.</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> Hero &#123;</span><br><span class="line">  id: <span class="built_in">number</span>;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  isSensitive?: <span class="built_in">boolean</span>; <span class="comment">// +</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.heroes$ = <span class="keyword">this</span>.route.paramMap.pipe(</span><br><span class="line">  switchMap(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.selectedId = <span class="built_in">parseInt</span>(params.get(<span class="string">"id"</span>)!, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.service.getHeroes().pipe(</span><br><span class="line">      map(<span class="function">(<span class="params">heroes</span>) =&gt;</span> &#123; <span class="comment">// +</span></span><br><span class="line">        <span class="keyword">return</span> heroes.map(<span class="function">(<span class="params">hero</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            ...hero,</span><br><span class="line">            isSensitive: <span class="keyword">this</span>.isSensitiveHeroName(hero), <span class="comment">// +</span></span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Now, we get better performance, maybe the best performance. That’s why you can often see this in the Angular community.</p>
<blockquote>
<p>Never call functions in the template</p>
</blockquote>
<p>Ok. Here are my concerns</p>
<blockquote>
<p>Is it really good to avoid using functions in the template?</p>
</blockquote>
<p>For better performance, we defined a derived state <code>isSensitive</code>. So, each time we change the name of the hero, we need to update <code>isSensitive</code>.</p>
<p>In real-word apps, there would be many derived states dependent on 2 or more other states. So we need to add more and more code to keep the current performance which will quickly bring bugs and maintenance issues.</p>
<p>There might be other ways to keep the performance without writing more code. But Here are my concern</p>
<blockquote>
<p>How long time does Angular need to take developers to write high-performance and easy-maintenance code? 1 month or 1 year?</p>
</blockquote>
<p><strong>Luckily, in 2023 Angular launched <code>Signals</code> which is in developer preview now. <code>Signals</code> allows you to write high-performance and easy-maintenance code.</strong></p>
<h3 id="Complicated-NgModule"><a href="#Complicated-NgModule" class="headerlink" title="Complicated NgModule"></a>Complicated NgModule</h3><p>Now, let’s assume I want to use <code>HeroListComponent</code> out of <code>HeroesModule</code>. I need to export it from <code>HeroesModule</code>, then import the <code>HeroesModule</code> to another module(let’s assume <code>AppModule</code>).</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  declarations: [HeroListComponent],</span><br><span class="line">  imports: [CommonModule, HeroesRoutingModule],</span><br><span class="line">  exports: [</span><br><span class="line">    HeroListComponent, <span class="comment">// +</span></span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HeroesModule &#123;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="meta">@NgModule</span>(&#123;</span><br><span class="line">  declarations: [AppComponent],</span><br><span class="line">  imports: [</span><br><span class="line">    BrowserModule,</span><br><span class="line">    AppRoutingModule,</span><br><span class="line">    HeroesModule, <span class="comment">// +</span></span><br><span class="line">  ],</span><br><span class="line">  providers: [],</span><br><span class="line">  bootstrap: [AppComponent],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>I can see only 1 good point. If I want to use the components exported from <code>HeroesModule</code>, I don’t need to import the components to <code>AppModule</code> again.</p>
<p>However, I can see many drawbacks.</p>
<blockquote>
<p>It’s not easy for developers to know how many things <code>AppModule</code> has imported from <code>HeroesModule</code>. Only Angular knows.</p>
<p>Because a component has to be declared in a module, it’s not easy for developers to know how many things the component is dependent on in the module. For example, is <code>HeroListComponent</code> dependent on <code>CommonModule</code> and <code>HeroesRoutingModule</code>? We need to check.</p>
<p>Thus it’s quite common that if you move a component from one module to another and it’s not working because you need to find out what dependencies the component needs and move the dependencies also. Because the dependencies are not declared in the component.</p>
</blockquote>
<p>In conclusion, a component can not work by itself which is hard to think about if you’re coming from other frameworks.</p>
<p>Luckily, we got <code>standalone</code> components in Angular@15 by the end of 2022. Angular team even provided a tool for you to migrate from <code>NgModule</code> to <code>standalone</code> component.</p>
<h3 id="Deep-binding-with-RxJs"><a href="#Deep-binding-with-RxJs" class="headerlink" title="Deep binding with RxJs"></a>Deep binding with RxJs</h3><p>Many Angular APIs are exposed with <code>Observable</code>, even <code>HttpClient</code>. However, it’s not easy for beginners to write code with fewer bugs with RxJs.</p>
<h4 id="Things-to-be-cautious-in-RxJs-declarative-style"><a href="#Things-to-be-cautious-in-RxJs-declarative-style" class="headerlink" title="Things to be cautious in RxJs declarative style"></a>Things to be cautious in RxJs declarative style</h4><p>For example, the previous <code>HeroListComponent</code> is implemented with a declarative style. <strong>If we remove the <code>heroes$ | async</code> in the template, the <code>service.getHeroes</code> will never be called again.</strong> If you’re new to Angular or RxJs, it might be a shock to you.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Heroes<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"heroes"</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;li *ngFor="let hero of heroes$ | async" [class.selected]="hero.id === selectedId" [class.sensitive]="hero.isSensitive" (mouseenter)="showTooltip()"&gt;</span></span><br><span class="line"><span class="comment">    &lt;a [routerLink]="['/hero', hero.id]"&gt;</span></span><br><span class="line"><span class="comment">      &lt;span class="badge"&gt;&#123;&#123; hero.id &#125;&#125;&lt;/span&gt;&#123;&#123; hero.name &#125;&#125;</span></span><br><span class="line"><span class="comment">    &lt;/a&gt;</span></span><br><span class="line"><span class="comment">  &lt;/li&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Also, if the <code>service.getHeroes</code> throws an error once, the function will not work anymore. That’s why you can often see <code>catchError(() =&gt; EMPTY)</code> in declarative code.</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.heroes$ = <span class="keyword">this</span>.route.paramMap.pipe(</span><br><span class="line">  switchMap(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.selectedId = <span class="built_in">parseInt</span>(params.get(<span class="string">"id"</span>)!, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.service.getHeroes().pipe(</span><br><span class="line">      map(<span class="function">(<span class="params">heroes</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> heroes.map(<span class="function">(<span class="params">hero</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            ...hero,</span><br><span class="line">            isSensitive: <span class="keyword">this</span>.isSensitiveHeroName(hero),</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;),</span><br><span class="line">      catchError(<span class="function"><span class="params">()</span> =&gt;</span> EMPTY) <span class="comment">//+</span></span><br><span class="line">    );</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="Things-to-be-cautious-in-RxJs-imperative-style"><a href="#Things-to-be-cautious-in-RxJs-imperative-style" class="headerlink" title="Things to be cautious in RxJs imperative style"></a>Things to be cautious in RxJs imperative style</h4><p>In reality, many developers are using imperative programming. In this case, <code>HeroListComponent</code> would be like</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HeroListComponent <span class="keyword">implements</span> OnInit &#123;</span><br><span class="line">  heroes!: Hero[];</span><br><span class="line">  selectedId = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> service: HeroService, <span class="keyword">private</span> route: ActivatedRoute</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    <span class="keyword">this</span>.route.paramMap.subscribe(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.selectedId = <span class="built_in">parseInt</span>(params.get(<span class="string">"id"</span>)!, <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">this</span>.service.getHeroes().subscribe(<span class="function">(<span class="params">heroes</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.heroes = heroes.map(<span class="function">(<span class="params">hero</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            ...hero,</span><br><span class="line">            isSensitive: <span class="keyword">this</span>.isSensitiveHeroName(hero),</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And in the template, <code>heroes$ | async</code> needs to be changed to <code>heroes</code>.</p>
<p>However, it has bugs. Just like we need <code>removeEventListener</code> after <code>addEventListener</code>, we also need to <code>unsubscribe</code> or use <code>takeUntilDestroyed</code>.</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.route.paramMap.pipe(takeUntilDestroyed()).subscribe(<span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.selectedId = <span class="built_in">parseInt</span>(params.get(<span class="string">"id"</span>)!, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">this</span>.service</span><br><span class="line">    .getHeroes()</span><br><span class="line">    .pipe(takeUntilDestroyed())</span><br><span class="line">    .subscribe(<span class="function">(<span class="params">heroes</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.heroes = heroes.map(<span class="function">(<span class="params">hero</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          ...hero,</span><br><span class="line">          isSensitive: <span class="keyword">this</span>.isSensitiveHeroName(hero),</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>However, <code>takeUntilDestroyed</code> is in the developer preview until now. Before 2023, we need to add more code. And one more thing, this way is unfriendly for <code>OnPush</code> strategy.</p>
<h4 id="Short-conclusion"><a href="#Short-conclusion" class="headerlink" title="Short conclusion"></a>Short conclusion</h4><p>As you can see, deep binding with RxJs makes it easier for developers to make mistakes or write less performant code. </p>
<p>I do think RxJs is powerful and especially good for edge cases. However, having a powerful tool doesn’t mean that we need to use it in all cases. Lots of frameworks&#x2F;libs&#x2F;projects without RxJs are working quite well.</p>
<p>Also, I didn’t mention the things developers need to know from RxJs and the very intrusive code style it brings.</p>
<h3 id="Current-status-of-Angular"><a href="#Current-status-of-Angular" class="headerlink" title="Current status of Angular"></a>Current status of Angular</h3><p>As you can see, Angular has brought many new solutions. It’s a good thing, but it could be a bad thing if they don’t point out recommended solutions in time. The community could get much more split than before.</p>
<ul>
<li>declarative or imperative programming</li>
<li>less or more <code>RxJs</code></li>
<li><code>Default</code> or <code>OnPush</code></li>
<li><code>NgModule</code> or <code>standalone</code></li>
<li><code>zone.js</code> or <code>Singals</code></li>
<li>…</li>
</ul>
<p>Choses between those will result in different styles, which also make code hard to maintain.</p>
<p>The first 2 choices have already made the community split. Now we have more.</p>
<h3 id="In-my-opinion"><a href="#In-my-opinion" class="headerlink" title="In my opinion,"></a>In my opinion,</h3><ul>
<li><code>standalone</code> + <code>Singals</code> are the future of Angular.</li>
<li><a href="https://github.com/angular/angular/issues/5689#issuecomment-879474919"><code>RxJs</code> will be optional for Angular</a>.</li>
<li>Official state management solution will be provided.</li>
<li>Angular will be more like other frameworks&#x2F;libs.</li>
</ul>
<p>Angular has made great choices like choosing <code>typescript</code>, but choosing <code>NgModule</code> and <code>zone.js</code> might have been proven not that successful. Even built-in <code>RxJs</code> APIs is also probably not a good solution.</p>
<blockquote>
<p>Angular is not waiting for other frameworks&#x2F;libs in 3 years.</p>
<p>He is making progress and choices. Some solutions that many frameworks and developers are not choosing often mean that they might not be that suitable for front end developing. In those cases, Angular is also learning from other frameworks&#x2F;libs instead of waiting and insisting that he’s in the right direction.</p>
</blockquote>
<p>Actually, frameworks&#x2F;libs are both learning from each other. Learning and improving themselves is much better than thinking I’m the best one.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/149"><strong>Issue</strong></a></p>
<p><a href="https://github.com/xianshenglu/blog/blob/master/source/_posts/angular-is-not-that-good-before-2023.md"><strong>Source</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>Angular</tag>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>arrayBuffer, text, and Blob Transformation in Ajax</title>
    <url>/blog/2019/09/arraybuffer-text-blob-transformation-in-ajax/</url>
    <content><![CDATA[<p>In some cases, we might need to fetch and handle some unusual data from a server, for example, Excel file, arrayBuffer, etc. If the backend has a united error handler things can be more complicated. In that case, the response got from backend can be a json, arrayBuffer or other types. For example,</p>
<ul>
<li>Normally the frontend would get a Excel file</li>
<li>If some error happens in the backend or formData is not valid or the session expired, the backend would return a json like</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  message: <span class="string">"unknown error!"</span>,</span><br><span class="line">  status: <span class="number">500</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>So, how can we handle the unknown response type in ajax?</p>
<h3 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a><code>fetch</code></h3><p>If we are using <code>fetch</code>, the code can be like</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; saveAs &#125; <span class="keyword">from</span> <span class="string">"file-saver"</span>;</span><br><span class="line"></span><br><span class="line">fetch(<span class="string">"http://www.your-api.com/getExcel"</span>, &#123;</span><br><span class="line">  credentials: <span class="string">"include"</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    accept: <span class="string">"application/json, text/plain, */*"</span>,</span><br><span class="line">    <span class="string">"content-type"</span>: <span class="string">"application/json;charset=UTF-8"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  referrer: <span class="string">""</span>,</span><br><span class="line">  referrerPolicy: <span class="string">"no-referrer-when-downgrade"</span>,</span><br><span class="line">  body: <span class="string">"&#123;&#125;"</span>,</span><br><span class="line">  method: <span class="string">"POST"</span>,</span><br><span class="line">  mode: <span class="string">"cors"</span></span><br><span class="line">&#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">      .clone()</span><br><span class="line">      .json()</span><br><span class="line">      .catch(<span class="function"><span class="params">er</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> response.blob();</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (&#123;&#125;.toString.call(response) !== <span class="string">"[object Blob]"</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> alert(response.message);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> saveAs(</span><br><span class="line">      <span class="keyword">new</span> Blob([response], &#123;</span><br><span class="line">        type:</span><br><span class="line">          <span class="string">"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8"</span></span><br><span class="line">      &#125;),</span><br><span class="line">      <span class="string">"file.xls"</span></span><br><span class="line">    );</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>The key is the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response" target="_blank" rel="noopener">Response</a> api which can help us transform unknown data to json or blob or other types. However, you might need to take care of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/clone" target="_blank" rel="noopener"><code>clone</code></a> api if you want to use the <code>Response</code> more than once.</p>
<h3 id="XMLHttpRequest"><a href="#XMLHttpRequest" class="headerlink" title="XMLHttpRequest"></a><code>XMLHttpRequest</code></h3><p>If you are using <code>xhr</code>(i.e. <code>XMLHttpRequest</code>), you have to set the response type before sending the request. For example,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">"POST"</span>, <span class="string">"http://www.your-api.com/getExcel"</span>);</span><br><span class="line">xhr.responseType = <span class="string">"blob"</span>;</span><br><span class="line">xhr.withCredentials = <span class="literal">true</span>;</span><br><span class="line">xhr.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>);</span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(xhr.response);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xhr.send(<span class="string">'&#123;"truck_team_id":[]&#125;'</span>);</span><br></pre></td></tr></table></figure>

<p>And the type of <code>xhr.response</code> is decided by <code>xhr.responseType</code> which means we will get a blob object with <code>xhr.responseType = &quot;blob&quot;</code> even if the server returns json. In this case, we might need to know some ways to transform data between blob, text, arrayBuffer, etc.</p>
<p>Luckily, the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob#Methods" target="_blank" rel="noopener">Blob</a> api gives us many choices. The transformation between arrayBuffer, blob and text can be</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// arrayBuffer =&gt; text;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Blob([arrayBuffer]).text(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">//text</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// text =&gt; arrayBuffer;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Blob([text]).arrayBuffer(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result); <span class="comment">// arrayBuffer</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>And if not using <code>Blob</code>, we can still use <code>TextDecoder</code> and <code>TextEncoder</code> to do the transformation job between arrayBuffer and text.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// arrayBuffer to text</span></span><br><span class="line"><span class="keyword">new</span> TextDecoder().decode(arrayBuffer);</span><br><span class="line"><span class="comment">//  text to arrayBuffer</span></span><br><span class="line"><span class="keyword">new</span> TextEncoder().encode(text);</span><br></pre></td></tr></table></figure>

<h3 id="Universality"><a href="#Universality" class="headerlink" title="Universality"></a>Universality</h3><p>Considering the universality, the transformation between arrayBuffer, blob and text can be useful in many scenarios. Worthy of attention!</p>
<p><a href="https://github.com/xianshenglu/blog/issues/101"><strong>Issue</strong></a></p>
<p><a href="https://github.com/xianshenglu/blog/blob/master/source/_posts/arraybuffer-text-blob-transformation-in-ajax.md"><strong>Source</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>arrayBuffer</tag>
        <tag>Blob</tag>
        <tag>fetch</tag>
        <tag>XMLHttpRequest</tag>
        <tag>Excel</tag>
      </tags>
  </entry>
  <entry>
    <title>Associated Validation in Vue</title>
    <url>/blog/2019/08/associated-validation-in-vue/</url>
    <content><![CDATA[<h2 id="Scenario"><a href="#Scenario" class="headerlink" title="Scenario"></a>Scenario</h2><p>Let’s see this gif:</p>
<p><img src="/blog/images/1566887167692.gif"></p>
<p>And collapsed code:</p>
<details>
<summary>Click here to expand code</summary>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//unpkg.com/vue/dist/vue.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//unpkg.com/element-ui@2.11.0/lib/index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:inline</span>=<span class="string">"true"</span> <span class="attr">ref</span>=<span class="string">"form"</span> <span class="attr">:rules</span>=<span class="string">"rules"</span> <span class="attr">:model</span>=<span class="string">"formData"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"startTime:"</span> <span class="attr">prop</span>=<span class="string">"startTime"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-date-picker</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"formData.startTime"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"datetime"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">"choose startTime"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">value-format</span>=<span class="string">"yyyy-MM-dd HH:mm:ss"</span></span></span><br><span class="line"><span class="tag">      &gt;</span><span class="tag">&lt;/<span class="name">el-date-picker</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">"endTime:"</span> <span class="attr">prop</span>=<span class="string">"endTime"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-date-picker</span></span></span><br><span class="line"><span class="tag">        <span class="attr">v-model</span>=<span class="string">"formData.endTime"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">"datetime"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">"choose endTime"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">value-format</span>=<span class="string">"yyyy-MM-dd HH:mm:ss"</span></span></span><br><span class="line"><span class="tag">      &gt;</span><span class="tag">&lt;/<span class="name">el-date-picker</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">"primary"</span> @<span class="attr">click</span>=<span class="string">"onSubmit"</span>&gt;</span>submit<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@import</span> url(<span class="string">"//unpkg.com/element-ui@2.11.0/lib/theme-chalk/index.css"</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Main = &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      formData: &#123;</span><br><span class="line">        startTime: <span class="string">""</span>,</span><br><span class="line">        endTime: <span class="string">""</span></span><br><span class="line">      &#125;,</span><br><span class="line">      rules: &#123;</span><br><span class="line">        startTime: [&#123; <span class="attr">validator</span>: <span class="keyword">this</span>.startEndTimeValidator &#125;],</span><br><span class="line">        endTime: [&#123; <span class="attr">validator</span>: <span class="keyword">this</span>.startEndTimeValidator &#125;]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="comment">// "formData.startTime"() &#123;</span></span><br><span class="line">    <span class="comment">//   this.validateField("endTime");</span></span><br><span class="line">    <span class="comment">// &#125;,</span></span><br><span class="line">    <span class="comment">// "formData.endTime"() &#123;</span></span><br><span class="line">    <span class="comment">//   this.validateField("startTime");</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    startEndTimeValidator(rule, value, callback) &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123;</span><br><span class="line">        formData: &#123; startTime, endTime &#125;</span><br><span class="line">      &#125; = <span class="keyword">this</span>;</span><br><span class="line">      startTime = moment(startTime, <span class="string">"YYYY-MM-DD HH:mm:ss"</span>);</span><br><span class="line">      endTime = moment(endTime, <span class="string">"YYYY-MM-DD HH:mm:ss"</span>);</span><br><span class="line">      <span class="keyword">if</span> (startTime &gt; endTime) &#123;</span><br><span class="line">        <span class="keyword">return</span> callback(</span><br><span class="line">          <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`start time shouldn't be larger than end time！`</span>)</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      callback();</span><br><span class="line">    &#125;,</span><br><span class="line">    validateField(...args) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="keyword">this</span>.$refs.form === <span class="string">"undefined"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.$refs.form.validateField(...args);</span><br><span class="line">    &#125;,</span><br><span class="line">    onSubmit() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"submit!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> Ctor = Vue.extend(Main);</span><br><span class="line"><span class="keyword">new</span> Ctor().$mount(<span class="string">"#app"</span>);</span><br></pre></td></tr></table></figure>

</details>

<br>

<p>When user selected a smaller <code>endTime</code>, we show the message:</p>
<blockquote>
<p>start time shouldn’t be larger than end time！</p>
</blockquote>
<p>If user changes the <code>endTime</code> with a larger one everything is okay. However, user could also choose a smaller <code>startTime</code> to avoid this message.</p>
<p>But the behavior of changing <code>startTime</code> wouldn’t trigger the <code>endTime</code> validation. So, user would still see the error message though he did the right thing.</p>
<p>That’s what we are going to talk about:</p>
<blockquote>
<p>Associated Validation.</p>
</blockquote>
<h2 id="Implementation"><a href="#Implementation" class="headerlink" title="Implementation"></a>Implementation</h2><p>At the very beginning, I have tried adding similar logic in the validator. However, it fails because of dead loop.</p>
<p>To avoid dead loop, I add this</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Main = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="string">"formData.startTime"</span>() &#123;</span><br><span class="line">      <span class="keyword">this</span>.validateField(<span class="string">"endTime"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"formData.endTime"</span>() &#123;</span><br><span class="line">      <span class="keyword">this</span>.validateField(<span class="string">"startTime"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Em, not so good but works.</p>
<p><strong><a href="https://github.com/xianshenglu/blog/issues/99">Issue</a></strong></p>
<p><strong><a href="https://github.com/xianshenglu/blog/blob/master/source/_posts/associated-validation-in-vue.md">Source</a></strong></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>vue</category>
      </categories>
  </entry>
  <entry>
    <title>Auto Zoom in When Form Element Gains Focus in IOS</title>
    <url>/blog/2018/08/auto-zoom-in-when-form-elements-are-focused-in-ios/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>When I was testing my webpage on IOS, I find that the page would be zoomed out automatically if there is some form elements and some element gains focus. Sometimes it will be really weird.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>After searching I found this <a href="https://stackoverflow.com/questions/4389932/how-do-you-disable-viewport-zooming-on-mobile-safari" target="_blank" rel="noopener">How do you disable viewport zooming on Mobile Safari?</a> and I add <code>user-scalable=0</code> in my <code>meta[name=viewport]</code>. It works.</p>
<p>However, user can still zoom the webpage though it won’t zoom out automatically when form element gains focused.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://stackoverflow.com/questions/4389932/how-do-you-disable-viewport-zooming-on-mobile-safari" target="_blank" rel="noopener">How do you disable viewport zooming on Mobile Safari?</a></p>
]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>form</tag>
        <tag>IOS</tag>
        <tag>focus</tag>
      </tags>
  </entry>
  <entry>
    <title>Better Way to Use orientationchange Event on Mobile</title>
    <url>/blog/2018/10/better-way-to-use-orientationchange-event-on-mobile/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>When I was using <code>orientationchange</code> event, I met a few bugs. So, I take it down.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><h4 id="compatibility-problem"><a href="#compatibility-problem" class="headerlink" title="compatibility problem"></a>compatibility problem</h4><p>When I was testing my code on my android, it was ok. However, it doesn’t work on my boss’s iPhone6. So, i have to change the code.</p>
<p>The origin code was like:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span> <span class="attr">id</span>=<span class="string">"box"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span><span class="selector-class">.landscape</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: lightblue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> box = <span class="built_in">document</span>.getElementById(<span class="string">'box'</span>)</span><br><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'orientationchange'</span>, orientationChangeCb)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">orientationChangeCb</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> isLand = isLandscape()</span><br><span class="line">  <span class="keyword">if</span> (isLand) &#123;</span><br><span class="line">    box.classList.add(<span class="string">'landscape'</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    box.classList.remove(<span class="string">'landscape'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isLandscape</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'orientation'</span> <span class="keyword">in</span> <span class="built_in">window</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.abs(<span class="built_in">window</span>.orientation) === <span class="number">90</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>.innerWidth &gt; <span class="built_in">window</span>.innerHeight</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To be compatible with iPhone6, I use <code>resize</code> event instead.</p>
<p>However, the better way I think is :</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> eventForOrientationChange =</span><br><span class="line">  <span class="string">'onorientationchange'</span> <span class="keyword">in</span> <span class="built_in">window</span> ? <span class="string">'orientationchange'</span> : <span class="string">'resize'</span></span><br><span class="line"><span class="keyword">if</span> (isMobile()) &#123;</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(eventForOrientationChange, orientationChangeCb)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="isMobile"><a href="#isMobile" class="headerlink" title="isMobile ?"></a>isMobile ?</h4><p>Because <code>onorientationchange</code> is a mobile event, so if you try to run code below on your computer with chrome, you will get:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.onorientationchange <span class="comment">//undefined</span></span><br><span class="line"><span class="string">'onorientationchange'</span> <span class="keyword">in</span> <span class="built_in">window</span> <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<p>It seems a little weird but it’s true until chrome 69. That’s why I add <code>isMobile()</code> before I use <code>window.addEventListener</code>. In that case, we don’t have to listen for the <code>resize</code> event on desktop.</p>
<h4 id="window-orientation-or-screen-orientation"><a href="#window-orientation-or-screen-orientation" class="headerlink" title="window.orientation or screen.orientation"></a>window.orientation or screen.orientation</h4><p>According to mdn, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/orientation#Specifications" target="_blank" rel="noopener">window.orientation</a> has been <strong>Deprecated</strong>. However, similar API <a href="https://developer.mozilla.org/en-US/docs/Web/API/Screen/orientation#Browser_compatibility" target="_blank" rel="noopener">screen.orientation</a> has a big problem for compatibility. Safari and QQ doesn’t support. As of 2018.10.4, global support in <a href="https://caniuse.com/#search=orientation" target="_blank" rel="noopener">caniuse</a> is only 72.5%.</p>
<h4 id="css-only"><a href="#css-only" class="headerlink" title="css only"></a>css only</h4><p>If you just want to update style, you don’t have to use code above. CSS media queries<br>support code like:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-height:</span> <span class="number">680px</span>), screen <span class="keyword">and</span> (<span class="attribute">orientation:</span> portrait) &#123;</span><br><span class="line">  <span class="comment">/* ...; */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">min-height:</span> <span class="number">680px</span>), screen <span class="keyword">and</span> (<span class="attribute">orientation:</span> landscape) &#123;</span><br><span class="line">  <span class="comment">/* ...; */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://stackoverflow.com/questions/4917664/detect-viewport-orientation-if-orientation-is-portrait-display-alert-message-ad" target="_blank" rel="noopener">detect viewport orientation, if orientation is portrait display alert message advising user of instructions</a></li>
</ul>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>mobile</tag>
        <tag>orientationchange</tag>
      </tags>
  </entry>
  <entry>
    <title>Browsers Disabled Audio AutoPlay</title>
    <url>/blog/2018/11/browsers-disabled-audio-autoplay/</url>
    <content><![CDATA[<p>If you have used <code>audio</code> or <code>video</code>, I guess you probably know <code>autoplay</code> attribute. Sometimes, PM wants to use that. However, the browsers doesn’t want that.</p>
<p>When I was using <code>autoplay</code> on 2018.10, I find that safari and chrome disabled <code>autoplay</code> when user haven’t interacted with the page, especially on safari mobile. It’s annoying.</p>
<p>So, if you want to use <code>autoplay</code> it may fail. So, some guys choose to play the audio when user click or touch the page. But I think the better way is to detect whether the user’s browser support <code>autoplay</code>. And the way is:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">audioEl</span><br><span class="line">  .play()</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//not disabled</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">er</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//disabled</span></span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>However, <a href="https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11998448/" target="_blank" rel="noopener">ie11 and edge before 2018.1 returns <code>undefined</code> when <code>audio.play()</code></a>. So, if you care about that, you may try:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> audioState = audioEl.play()</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> audioState !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">  audioState</span><br><span class="line">    .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//not disabled</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">er</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//disabled</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//other logic? what are you gonna do?</span></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/xianshenglu/blog/issues/18"><strong>Original Post</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://blog.videojs.com/autoplay-best-practices-with-video-js/" target="_blank" rel="noopener">Autoplay Best Practices with Video.js</a></li>
</ul>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>audio</tag>
        <tag>autoplay</tag>
      </tags>
  </entry>
  <entry>
    <title>Build Blog by Github Pages and Hexo</title>
    <url>/blog/2018/05/build-blog-by-github-pages-and-hexo/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>There is a lot of tutorials teaching you build your own blog by github pages with url like <code>https://username.github.io</code>.</p>
<p>Well, I am not going to do that. Why would I have to build blog on my main site rather than <code>https://username.github.io/blog</code>?</p>
<p>That is what I’m going to do! Build a blog under main site so that it wouldn’t take over the main site. Suppose that you have already known something about <code>npm</code> and <code>git</code> or <code>Github</code>.</p>
<h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><ul>
<li>Install <code>hexo</code> and <code>hexo-cli</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br><span class="line">npm install -g hexo</span><br></pre></td></tr></table></figure>

<ul>
<li>Create your blog folder with no file, and get into the folder(for example, my blog folder is <em>blog</em>).</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> blog</span><br></pre></td></tr></table></figure>

<ul>
<li>Initialize hexo and install dependencies</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo init</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<p>Normally, dependencies will be installed automatically</p>
<ul>
<li>Try to run it locally</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo s -g</span><br></pre></td></tr></table></figure>

<p>Normally, you will see:</p>
<p><img src="/blog/images/20180520101721.png" alt="20180520101721.png"></p>
<ul>
<li>Open the browser with the url in the above screenshot:</li>
</ul>
<p><img src="/blog/images/20180520102405.png" alt="20180520102405.png"></p>
<p>You can change the theme if you don’t like it. However that is not the point of this article. You can do it according to the docs in <a href="https://hexo.io/docs/" target="_blank" rel="noopener">hexo</a>.</p>
<ul>
<li>Also, if we want to deploy it on github, we have to install <code>hexo-deployer-git</code> according to <a href="https://hexo.io/docs/" target="_blank" rel="noopener">docs</a>.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<ul>
<li>Suppose that you already have a repository on github. For example, the name is <code>blog</code> and url is <code>https://github.com/username/blog</code>. Then find the <em>_config.yml</em> file in the folder. Open it update the <code>url</code> and <code>root</code> as follows:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">url: https://github.com/username/blog</span><br><span class="line">root: /blog/</span><br></pre></td></tr></table></figure>

<p>Also, update <code>deploy</code> like this:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  <span class="built_in">type</span>: git</span><br><span class="line">  repo: https://github.com/username/blog</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure>

<p>Well, I have to warn you that<br>and the space before word <code>type</code>, <code>repo</code> and <code>branch</code>should be <em>blank space</em> not <em>tab</em>. Otherwise, you will get error about your <code>indentation</code>.</p>
<ul>
<li>Now, try to deploy it on github:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo d -g</span><br></pre></td></tr></table></figure>

<p>Open your repository url like <code>https://github.com/username/blog</code> and you will find there is a few files and folders. Remember to clear cash with <code>ctrl+shift+delete</code> if you just pushed.</p>
<ul>
<li>Suppose that you already make the repository become a github page. Then, you can open your page url like: <code>https://username.github.io/blog/</code>. You will see what you see locally last time.</li>
</ul>
<h2 id="Default-settings"><a href="#Default-settings" class="headerlink" title="Default settings"></a>Default settings</h2><p>some stuff should be done by default which hexo didn’t:</p>
<ul>
<li>Generate <em>.deploy_git&#x2F;categories</em> folder when deployed. This might be done by default.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-category --save</span><br></pre></td></tr></table></figure>

<ul>
<li>Generate <em>index.md</em> under folder <em>source&#x2F;categories</em> and <em>source&#x2F;tags</em></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">hexo new page categories</span><br><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure>

<p>Also, need to add <code>type: tags</code> and <code>type: categories</code> in the above corresponding file <em>index.md</em>. It will help you generate <em>index.html</em> under folder <em>.deploy_git&#x2F;categories</em> and <em>.deploy_git&#x2F;tags</em> when deployed.</p>
<h2 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h2><ul>
<li>I just found that default <code>hexo-renderer-marked</code> didn’t work with some markdown syntax like <em>.deploy_git&#x2F;categories</em>. So, I change my markdown parser;</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked  --save</span><br><span class="line">npm install hexo-renderer-markdown-it  --save</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Before deploying, you had better remove the <em>public</em> and <em>.deploy_git</em> folder because they won’t be rewritten sometimes.</p>
</li>
<li><p>Above operation works well if there is no image in the markdown. However, if there is an image, for example:</p>
</li>
</ul>
<p><img src="/blog/images/Snipaste_2023-08-22_00-31-30.png" alt="Snipaste_2023-08-22_00-31-30.png"></p>
<p>The path for the image will be resolved incorrectly. In consistent with above case, the correct path should be <code>https://username.github.io/blog/images/20180520102405.png</code> while what we got is like <code>https://username.github.io/blog/2018/05/20/images/20180520101721.png</code>.So, we need to modify <code>src</code> to get a new url.</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'error'</span>, windowErrorCb, &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;, <span class="literal">true</span>)</span><br><span class="line"><span class="built_in">document</span>.addEventListener(</span><br><span class="line">  <span class="string">'DOMContentLoaded'</span>,</span><br><span class="line">  refreshImgUrl,</span><br><span class="line">  &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">windowErrorCb</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> target = event.target</span><br><span class="line">  imgErrorCb()</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">imgErrorCb</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> isImgErrorHandled = target.hasAttribute(<span class="string">'data-src-error'</span>)</span><br><span class="line">    <span class="keyword">let</span> isImgPathMatch =</span><br><span class="line">      target.tagName.toLowerCase() === <span class="string">'img'</span> &amp;&amp;</span><br><span class="line">      target.src.match(<span class="regexp">/\/images\/[^/]*?\d&#123;10,20&#125;[^/]*$/</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (isImgPathMatch &amp;&amp; !isImgErrorHandled) &#123;</span><br><span class="line">      target.src = <span class="string">'https://xianshenglu.github.io/blog'</span> + isImgPathMatch[<span class="number">0</span>]</span><br><span class="line">      target.setAttribute(<span class="string">'data-src-error'</span>, <span class="string">'handled'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">refreshImgUrl</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> isImgPathMatchReg = <span class="regexp">/\/images\/[^/]*?\d&#123;10,20&#125;[^/]*$/</span></span><br><span class="line">  $(<span class="string">'img'</span>)</span><br><span class="line">    .toArray()</span><br><span class="line">    .forEach(<span class="function"><span class="params">img</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (img.src.match(isImgPathMatchReg)) &#123;</span><br><span class="line">        img.src = img.src</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>To solve question above, you can put the code above in the bottom of the file <em>theme&#x2F;next&#x2F;source&#x2F;js&#x2F;src&#x2F;motion.js</em> which should be changed according to your theme and image’s path. Actually, you can put the code in any js file as long as you are sure that it will be loaded.</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>Well, the main settings have already finished. And if you want to set the theme or other things, go check the <a href="https://hexo.io/docs/" target="_blank" rel="noopener">docs</a>.</p>
]]></content>
      <categories>
        <category>software</category>
      </categories>
      <tags>
        <tag>blog</tag>
        <tag>hexo</tag>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>Build Multiple Choice Cascader with Third Party ui</title>
    <url>/blog/2018/11/build-multiple-choice-cascader-with-third-party-ui/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>I need to make a cascader which can support multiple choices. However, I didn’t find any ui which supports that until 2018.11.18. That was a little pity.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>I check the <code>element-ui</code> and find multiple cascader was in toDoList while <code>ant-design</code> refuse to support that directly. Maybe because they have already implemented <a href="https://ant.design/components/tree-select/" target="_blank" rel="noopener">TreeSelect</a>. Here is what <code>TreeSelect</code> looks like:</p>
<p><img src="/blog/images/1542536446656.gif"></p>
<p>Almost the result I want except the ui. It doesn’t look like a cascader but a tree.</p>
<p>Anyway, I built a multiple cascader component based on select and cascader in <code>ant-design-vue</code>. Here is the result:</p>
<p><img src="/blog/images/1542536827531.gif"></p>
<p>The principle is easy. I use the <code>input</code> in <code>select</code> and hide the popup. And then I hide the <code>input</code> in <code>cascader</code> and show the popup. So, MultipleCascader is equal to <code>input</code> in <code>select</code> plus popup in <code>cascader</code> and use <code>transform</code> to let them stay together.</p>
<p>Talking about the event, you have to listen and change the data to show correctly. That is a little troublesome.</p>
<p>Anyway, here is the earliest <a href="https://codesandbox.io/s/8njr9xy212" target="_blank" rel="noopener">demo</a> in codesandbox. I am not sure if the demo would be always able to visit.</p>
<p>The latest version is in <a href="https://github.com/xianshenglu/vue/tree/master/demo/multi-cascader-ant-design-vue">here</a>.<br>So, here is the earliest code:</p>
<p><em>App.vue</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot; class=&quot;app&quot;&gt;&lt;MultipleCascader /&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import MultipleCascader from &quot;./components/MultipleCascader&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;app&quot;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    MultipleCascader</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p><em>MultipleCascader.vue</em></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;multi_cascader&quot;&gt;</span><br><span class="line">    &lt;a-cascader</span><br><span class="line">      size=&quot;large&quot;</span><br><span class="line">      class=&quot;multi_cascader__cascader&quot;</span><br><span class="line">      :popupVisible=&quot;cascaderPopupVisible&quot;</span><br><span class="line">      :popupClassName=&quot;&apos;multi_cascader__cascader_popup&apos; + timestamp&quot;</span><br><span class="line">      changeOnSelect</span><br><span class="line">      expandTrigger=&quot;hover&quot;</span><br><span class="line">      :options=&quot;cascaderOptions&quot;</span><br><span class="line">      :fieldNames=&quot;&#123; label: &apos;label&apos;, value: &apos;id&apos;, children: &apos;children&apos; &#125;&quot;</span><br><span class="line">      v-model=&quot;cascaderValues&quot;</span><br><span class="line">      ref=&quot;cascader&quot;</span><br><span class="line">      :showSearch=&quot;&#123; cascaderFilter &#125;&quot;</span><br><span class="line">      @change=&quot;cascaderChange&quot;</span><br><span class="line">    &gt;&lt;/a-cascader&gt;</span><br><span class="line">    &lt;a-select</span><br><span class="line">      size=&quot;large&quot;</span><br><span class="line">      class=&quot;multi_cascader__select&quot;</span><br><span class="line">      dropdownClassName=&quot;hide&quot;</span><br><span class="line">      mode=&quot;multiple&quot;</span><br><span class="line">      :value=&quot;selectValues&quot;</span><br><span class="line">      allowClear</span><br><span class="line">      placeholder=&quot;Please select&quot;</span><br><span class="line">      :options=&quot;selectOptions&quot;</span><br><span class="line">      @focus=&quot;cascaderPopupVisible = true&quot;</span><br><span class="line">      @deselect=&quot;deleteOption&quot;</span><br><span class="line">      @change=&quot;selectChange&quot;</span><br><span class="line">      @search=&quot;selectSearch&quot;</span><br><span class="line">    &gt;&lt;/a-select&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;MultipleCascader&quot;,</span><br><span class="line">  data: function() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      timestamp: Date.now(),</span><br><span class="line">      selectOptions: [],</span><br><span class="line">      selectValues: [],</span><br><span class="line">      cascaderPopupVisible: false,</span><br><span class="line">      cascaderValues: [],</span><br><span class="line">      cascaderOptions: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: 1,</span><br><span class="line">          value: &quot;1&quot;,</span><br><span class="line">          label: &quot;1&quot;,</span><br><span class="line">          children: [</span><br><span class="line">            &#123; id: 1.1, value: 1.1, label: &quot;1-1&quot; &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              id: 1.2,</span><br><span class="line">              value: 1.2,</span><br><span class="line">              label: &quot;1-2&quot;,</span><br><span class="line">              children: [</span><br><span class="line">                &#123; id: 1.21, value: 1.21, label: &quot;1-2-1&quot; &#125;,</span><br><span class="line">                &#123; id: 1.22, value: 1.22, label: &quot;1-2-2&quot; &#125;</span><br><span class="line">              ]</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; id: 2, value: 2, label: &quot;2&quot; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    document.addEventListener(&quot;click&quot;, this.hideCascaderPopup);</span><br><span class="line">  &#125;,</span><br><span class="line">  destroyed() &#123;</span><br><span class="line">    document.removeEventListener(&quot;click&quot;, this.hideCascaderPopup);</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    cascaderChange(values, options) &#123;</span><br><span class="line">      // you may have different logic with the selected option, here I just want the last one.</span><br><span class="line">      let targetValue = values.slice(-1).pop();</span><br><span class="line">      let targetOption = options.slice(-1).pop();</span><br><span class="line">      let selectedValIndex = this.selectValues.indexOf(targetValue);</span><br><span class="line">      if (selectedValIndex &gt;= 0) &#123;</span><br><span class="line">        this.selectValues.splice(selectedValIndex, 1);</span><br><span class="line">        this.selectOptions.splice(selectedValIndex, 1);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        this.selectValues.push(targetValue);</span><br><span class="line">        this.selectOptions.push(targetOption);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    deleteOption(value) &#123;</span><br><span class="line">      let selectedValIndex = this.selectValues.indexOf(value);</span><br><span class="line">      this.cascaderChange([value], [this.selectOptions[selectedValIndex]]);</span><br><span class="line">    &#125;,</span><br><span class="line">    selectChange(values, vNodes) &#123;</span><br><span class="line">      if (values.length === 0) &#123;</span><br><span class="line">        this.selectValues = [];</span><br><span class="line">        this.selectOptions = [];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    selectSearch(keyword) &#123;</span><br><span class="line">      let searchInput = this.$refs.cascader.$el.querySelector(&quot;input&quot;);</span><br><span class="line">      if (searchInput) &#123;</span><br><span class="line">        searchInput.value = keyword;</span><br><span class="line">        searchInput.dispatchEvent(new Event(&quot;input&quot;));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    cascaderFilter(inputValue, path) &#123;</span><br><span class="line">      return path.some(</span><br><span class="line">        option =&gt;</span><br><span class="line">          option.label.toLowerCase().indexOf(inputValue.toLowerCase()) &gt; -1</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    hideCascaderPopup(event) &#123;</span><br><span class="line">      let cascaderPopup = document.querySelector(</span><br><span class="line">        &quot;.multi_cascader__cascader_popup&quot; + this.timestamp</span><br><span class="line">      );</span><br><span class="line">      let isClickCascaderPopup =</span><br><span class="line">        cascaderPopup &amp;&amp; cascaderPopup.contains(event.target);</span><br><span class="line">      if (isClickCascaderPopup) &#123;</span><br><span class="line">        return;</span><br><span class="line">      &#125;</span><br><span class="line">      this.cascaderPopupVisible = false;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.multi_cascader &#123;</span><br><span class="line">  height: 100vh;</span><br><span class="line">  display: flex;</span><br><span class="line">  flex-flow: column;</span><br><span class="line">  justify-content: center;</span><br><span class="line">  align-items: center;</span><br><span class="line">&#125;</span><br><span class="line">.multi_cascader__select &#123;</span><br><span class="line">  width: 50%;</span><br><span class="line">  margin-top: 0;</span><br><span class="line">  margin-bottom: auto;</span><br><span class="line">  transform: translate(0, -100%);</span><br><span class="line">&#125;</span><br><span class="line">.multi_cascader__cascader &#123;</span><br><span class="line">  width: 50%;</span><br><span class="line">  margin-top: auto;</span><br><span class="line">  margin-bottom: 0;</span><br><span class="line">  opacity: 0;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line"></span><br><span class="line">&lt;style&gt;</span><br><span class="line">/* global style*/</span><br><span class="line">.hide &#123;</span><br><span class="line">  display: none;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>ant-design-vue</tag>
        <tag>element-ui</tag>
        <tag>multiple-choice-cascader</tag>
      </tags>
  </entry>
  <entry>
    <title>Chrome, vh Is Always Calculated as If the Url Bar Is Hidden</title>
    <url>/blog/2018/11/chrome-vh-is-always-calculated-as-if-the-url-bar-is-hidden/</url>
    <content><![CDATA[<p>The first time when I know <code>vh</code> I was very excited. Finally, we can do this by <code>css</code> instead of <code>js</code>. However, still too naive.</p>
<p>As we all know, scroll bar would hide automatically on mobile. So, it wouldn’t affect the layout like on desktop.</p>
<p>However, the address bar would also hide when scrolling. Like images below:</p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181125213110.jpg"></p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20181125213118.jpg"></p>
<p>And the code is:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      * &#123;</span><br><span class="line">        margin: 0;</span><br><span class="line">        padding: 0;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      html,</span><br><span class="line">      body,</span><br><span class="line"><span class="css">      <span class="selector-class">.app</span> &#123;</span></span><br><span class="line"><span class="css">        <span class="comment">/* height: 100%; */</span></span></span><br><span class="line">        height: 100vh;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.app</span> &#123;</span></span><br><span class="line">        width: 100%;</span><br><span class="line">        border: 10px solid orange;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        position: relative;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">      <span class="selector-class">.app__footer</span> &#123;</span></span><br><span class="line">        height: 100px;</span><br><span class="line">        width: 100%;</span><br><span class="line">        box-sizing: border-box;</span><br><span class="line">        border: 10px solid pink;</span><br><span class="line">        position: absolute;</span><br><span class="line">        bottom: 0;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span> <span class="attr">class</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">"app__header"</span>&gt;</span><span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">main</span> <span class="attr">class</span>=<span class="string">"app__main"</span>&gt;</span><span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">"app__footer"</span>&gt;</span>app__footer<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The viewport size changes when scrolling. In my Mi6X, the smaller is <code>659px</code> while the larger one is <code>715px</code> when the address bar is hidden.</p>
<p>According to test on chrome 70, <code>height:100%</code> and <code>window.innerHeight</code> is always equal to the smaller one. I think it is correct. I also thought <code>100vh</code> would act like <code>100%</code>. However, it’s not.</p>
<p>According to <a href="https://developers.google.com/web/updates/2016/12/url-bar-resizing" target="_blank" rel="noopener">developers.google</a> the <code>vh</code> is always calculated as if the URL bar is hidden since Chrome version 56.</p>
<p>So, <code>100vh</code> is equal to the larger one which is 715px on my phone. That’s why images above would happen. In this case, if we use something like <code>bottom:0;</code> with <code>100vh</code> we would meet situation like image one. Part of <code>app__footer</code> was covered. Instead, if we use <code>height:100%</code>, it won’t happen.</p>
<p>However, as we all know it wouldn’t be possible to use 100% when we were in nested css modules. So, in this case, how can we get the 100% in nested css modules?</p>
<p>Of course, we can save the 100% to <code>rem</code> like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.style.fontSize = <span class="built_in">window</span>.innerHeight * <span class="number">0.01</span> + <span class="string">'px'</span></span><br></pre></td></tr></table></figure>

<p>But I think the better way is using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_variables" target="_blank" rel="noopener">CSS_variables</a>. For example:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span>,</span><br><span class="line"><span class="selector-class">.app</span> &#123;</span><br><span class="line">  <span class="comment">/* height: 100%; */</span></span><br><span class="line">  <span class="comment">/* height: 100vh; */</span></span><br><span class="line">  <span class="attribute">height</span>: <span class="built_in">calc</span>(var(--vh) * <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.style.setProperty(</span><br><span class="line">  <span class="string">'--vh'</span>,</span><br><span class="line">  <span class="built_in">window</span>.innerHeight * <span class="number">0.01</span> + <span class="string">'px'</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Also, if you are worried about the compatibility. Here is the <a href="https://github.com/jhildenbiddle/css-vars-ponyfill">polyfill</a>.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/38"><strong>Original Post</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://css-tricks.com/the-trick-to-viewport-units-on-mobile/" target="_blank" rel="noopener">the-trick-to-viewport-units-on-mobile</a></li>
<li><a href="https://stackoverflow.com/questions/37112218/css3-100vh-not-constant-in-mobile-browser" target="_blank" rel="noopener">CSS3 100vh not constant in mobile browser</a></li>
</ul>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>vh</tag>
        <tag>CSS variables</tag>
      </tags>
  </entry>
  <entry>
    <title>Easier Way to Understand apply and call in JS</title>
    <url>/blog/2018/12/easier-way-to-understand-apply-and-call-in-js/</url>
    <content><![CDATA[<p>The first time I know <code>apply</code> was when I met this code:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p>As the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/apply" target="_blank" rel="noopener">mdn</a> shows, the syntax is:</p>
<blockquote>
<p>function.apply( thisArg , [argsArray] )</p>
</blockquote>
<p>Actually, in case above, thisArg has no influence which means code below also works:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>.max.apply(<span class="literal">undefined</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="built_in">Math</span>.max.apply(<span class="built_in">Math</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p>The only effect of <code>apply</code> in the code above is that it can pass the values in array to the function <code>max</code>. So, code above equal</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>.max(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>Why would I mention this? Because we don’t need this anymore because we already have <code>...</code> which works like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Math</span>.max(...[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p>The reason that we still need <code>apply</code> and <code>call</code> is the thisArg. They can help us call some powerful methods.</p>
<h3 id="thisArg-in-apply-and-call"><a href="#thisArg-in-apply-and-call" class="headerlink" title="thisArg in apply and call"></a>thisArg in apply and call</h3><p>I guess you might have seen this code:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.slice.call(&#123; <span class="attr">length</span>: <span class="number">2</span> &#125;)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>))</span><br><span class="line">&#125;</span><br><span class="line">fn(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>) <span class="comment">//[1,2,3,4]</span></span><br></pre></td></tr></table></figure>

<p>Today, we don’t need this either because of <code>Array.from</code>. But I still want to talk about it for explanation. In the case above, <code>call</code> was used because we want to do something like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">length</span>: <span class="number">2</span> &#125;</span><br><span class="line">obj.slice() <span class="comment">//Uncaught TypeError: obj.slice is not a function</span></span><br></pre></td></tr></table></figure>

<p>It would cause error because slice was defined in <code>Array.prototype</code>. Only <code>Array</code> instance can call that method. <strong>But actually in the <a href="http://es5.github.io/#x15.4.4.10" target="_blank" rel="noopener">implementation</a> of <code>slice</code>, it doesn’t need to be called by <code>Array</code> instance</strong> and there is a lot of methods like this. So, in this case, <code>call</code> or <code>apply</code> would let non <code>Array</code> instance call these methods which means</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.slice.call(&#123; <span class="attr">length</span>: <span class="number">2</span> &#125;)</span><br><span class="line"><span class="comment">//works like something like this</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123; <span class="attr">length</span>: <span class="number">2</span> &#125;</span><br><span class="line">obj.slice = <span class="built_in">Array</span>.prototype.slice</span><br><span class="line">obj.slice()</span><br></pre></td></tr></table></figure>

<p><strong>And to help it easier to understand , you can remember it like:</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">method.call(thisArg, ...args)</span><br><span class="line"><span class="comment">//works like in most cases</span></span><br><span class="line">thisArg.method = method</span><br><span class="line"><span class="comment">// or this way, if thisArg is a primitive value</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(thisArg).method = method</span><br><span class="line">thisArg.method(...args)</span><br><span class="line"><span class="comment">//for apply</span></span><br><span class="line">method.apply(thisArg, args)</span><br><span class="line"><span class="comment">//works like in most cases</span></span><br><span class="line">thisArg.method = method</span><br><span class="line"><span class="comment">// or this way</span></span><br><span class="line"><span class="built_in">Object</span>.getPrototypeOf(thisArg).method = method</span><br><span class="line">thisArg.method(...args)</span><br></pre></td></tr></table></figure>

<p>Wasn’t that easy ?</p>
<p>So, let get back to <code>Math.max.apply({}, [1, 2, 3, 4])</code>. You can remember it like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> thisArg = &#123;&#125;</span><br><span class="line">thisArg.max = <span class="built_in">Math</span>.max</span><br><span class="line">thisArg.max(...[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<p>And more cases:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.toString.call([]) <span class="comment">//"[object Array]"</span></span><br><span class="line"><span class="comment">//works like this</span></span><br><span class="line"><span class="keyword">let</span> thisArg = []</span><br><span class="line">thisArg.toString = <span class="built_in">Object</span>.prototype.toString</span><br><span class="line">thisArg.toString() <span class="comment">//"[object Array]"</span></span><br><span class="line"><span class="comment">//while</span></span><br><span class="line">[].toString()<span class="comment">//""</span></span><br></pre></td></tr></table></figure>

<p>Or</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">;[<span class="string">' sd '</span>, <span class="number">1</span>, <span class="number">3</span>].map(<span class="built_in">Function</span>.prototype.call, <span class="built_in">String</span>.prototype.trim) <span class="comment">//['sd','1','3']</span></span><br><span class="line"><span class="comment">//works like</span></span><br><span class="line">;[<span class="string">' sd '</span>, <span class="number">1</span>, <span class="number">3</span>].map(<span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">String</span>.prototype.trim.call(...args)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//works like</span></span><br><span class="line">;[<span class="string">' sd '</span>, <span class="number">1</span>, <span class="number">3</span>].map(<span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> thisArg = args[<span class="number">0</span>]</span><br><span class="line">  thisArg.trim = <span class="built_in">String</span>.prototype.trim</span><br><span class="line">  <span class="comment">// way above wouldn't work because thisArg is a Primitive value, so we use way below instead.</span></span><br><span class="line">  <span class="built_in">Object</span>.getPrototypeOf(thisArg).trim = <span class="built_in">String</span>.prototype.trim</span><br><span class="line">  <span class="keyword">return</span> thisArg.trim(...args.slice(<span class="number">1</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="More-in-apply"><a href="#More-in-apply" class="headerlink" title="More in apply"></a>More in apply</h3><p>As <code>apply</code> can accept an array-like object. So, what would happen if coding like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.apply(<span class="literal">null</span>, &#123; <span class="attr">length</span>: <span class="number">2</span> &#125;)</span><br></pre></td></tr></table></figure>

<p>Actually, it equals</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>.apply(<span class="literal">null</span>, [<span class="literal">undefined</span>, <span class="literal">undefined</span>])</span><br></pre></td></tr></table></figure>

<p>So, you can understand it like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> thisArg = &#123;&#125; <span class="comment">//set null would get error in code below, also thisArg in above case is not important</span></span><br><span class="line">thisArg.Array = <span class="built_in">Array</span></span><br><span class="line">thisArg.Array(<span class="literal">undefined</span>, <span class="literal">undefined</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Function-prototype-call-apply"><a href="#Function-prototype-call-apply" class="headerlink" title="Function.prototype.call.apply"></a><code>Function.prototype.call.apply</code></h3><p>You might have seen code using <code>Function.prototype.call.apply</code> which seems a little weird. However, it still make sense, especially in ES5. For example,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arrayLike = &#123; <span class="number">0</span>: <span class="number">0</span>, <span class="attr">length</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="built_in">Function</span>.prototype.call.apply([].push, [arrayLike, <span class="number">1</span>])</span><br><span class="line"><span class="built_in">console</span>.log(arrayLike) <span class="comment">//&#123;0: 0, 1: 1, length: 2&#125;</span></span><br></pre></td></tr></table></figure>

<p>which works like</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayLike = &#123; <span class="number">0</span>: <span class="number">0</span>, <span class="attr">length</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">let</span> thisArg = [].push</span><br><span class="line">thisArg.call(arrayLike, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arrayLike) <span class="comment">//&#123;0: 0, 1: 1, length: 2&#125;</span></span><br></pre></td></tr></table></figure>

<p>also equal</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayLike = &#123; <span class="number">0</span>: <span class="number">0</span>, <span class="attr">length</span>: <span class="number">1</span> &#125;</span><br><span class="line">[].push.call(arrayLike,<span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arrayLike) <span class="comment">//&#123;0: 0, 1: 1, length: 2&#125;</span></span><br></pre></td></tr></table></figure>

<p>which works like</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayLike = &#123; <span class="number">0</span>: <span class="number">0</span>, <span class="attr">length</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="keyword">let</span> thisArg = arrayLike</span><br><span class="line">thisArg.push = [].push</span><br><span class="line">thisArg.push(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arrayLike) <span class="comment">//&#123;0: 0, 1: 1, length: 2&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">Hope it&apos;s easier to understand `apply` and `call`.</span><br><span class="line"></span><br><span class="line">[**Original Post**](https://github.com/xianshenglu/blog/issues/50)</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>apply</tag>
        <tag>call</tag>
      </tags>
  </entry>
  <entry>
    <title>Event Capturing Vs Event Bubbling</title>
    <url>/blog/2018/05/event-capturing-vs-event-bubbling/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>When I am trying to delegate the <code>error</code> event of <code>img</code>, I find that those events won’t bubble up to window. So,does that mean I have to bind so many events as many as images I have?</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>After a while, I think of something about event capturing which maybe can solve this question. So, I tried code below:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">"img"</span> <span class="attr">src</span>=<span class="string">"error.png"</span> <span class="attr">alt</span>=<span class="string">"error.png"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'error'</span>, windowErrorCb, &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;, <span class="literal">true</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">windowErrorCb</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> target = event.target</span><br><span class="line">  <span class="keyword">let</span> isImg = target.tagName.toLowerCase() === <span class="string">'img'</span></span><br><span class="line">  <span class="keyword">if</span> (isImg) &#123;</span><br><span class="line">    imgErrorCb()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">imgErrorCb</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> isImgErrorHandled = target.hasAttribute(<span class="string">'data-src-error'</span>)</span><br><span class="line">    <span class="keyword">if</span> (!isImgErrorHandled) &#123;</span><br><span class="line">      target.setAttribute(<span class="string">'data-src-error'</span>, <span class="string">'handled'</span>)</span><br><span class="line">      target.src = <span class="string">'backup.png'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Code above works normally. If we change the <code>capture</code> and the last argument to <code>false</code>, it doesn’t work.</p>
<p>In this case, we can find that event capturing seems have more applicable situations than event bubbling. Also it seems faster because I catch and handle the event earlier than event bubbling.<br>So, I got these questions:</p>
<ul>
<li><p>Why would we use event bubbling not event capturing as default except for compatibility?</p>
</li>
<li><p>Does event capturing really faster than event bubbling as I thought?</p>
</li>
<li><p>Does event capturing really have more applicable situations?</p>
</li>
</ul>
<p>The answers can be listed below:</p>
<ul>
<li><p>Don’t know yet.</p>
</li>
<li><p>Yes, you can see the demo <a href="https://jsperf.com/delegating-capture-vs-bubble/2" target="_blank" rel="noopener">here</a></p>
</li>
<li><p>Yes.</p>
</li>
</ul>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>After words above, I think we should use event capturing as default.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://stackoverflow.com/questions/2661199/event-capturing-vs-event-bubbling/10335117" target="_blank" rel="noopener">Event Capturing vs Event Bubbling</a></p>
<p><a href="https://jsperf.com/delegating-capture-vs-bubble/2" target="_blank" rel="noopener">delegating-capture-vs-bubble</a></p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>event capturing</tag>
        <tag>event bubbling</tag>
        <tag>event delegate</tag>
        <tag>image load error</tag>
      </tags>
  </entry>
  <entry>
    <title>event.preventDefault() in contextmenu Would Trigger mouseup event</title>
    <url>/blog/2018/12/event.preventdefault()-in-contextmenu-would-trigger-mouseup-event/</url>
    <content><![CDATA[<h3 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h3><p>How many logs would you have when you click and release right mouse button?</p>
<h4 id="Demo1"><a href="#Demo1" class="headerlink" title="Demo1"></a>Demo1</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.onmouseup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Demo2"><a href="#Demo2" class="headerlink" title="Demo2"></a>Demo2</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  event.preventDefault()</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.onmouseup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The answer is 1,2. The question is</p>
<ul>
<li>Does that matter?</li>
<li>And why?</li>
</ul>
<h3 id="Matters"><a href="#Matters" class="headerlink" title="Matters"></a>Matters</h3><p>Normally, click and release right button would only trigger <code>contextmenu</code> instead of <code>mouseup</code>.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.onmouseup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It does make senses in most cases that when we were using <code>onmouseup</code> means that we only want to listen to the <code>mouseup</code> of left button.</p>
<p>However, if you used <code>event.preventDefault()</code> in <code>contextmenu</code>, <code>mouseup</code> event would be triggered when you press and release the right button.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  event.preventDefault()</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.onmouseup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In most cases, this is not expected as it changes the behavior of <code>mouseup</code> listener because of changes in <code>contextmenu</code> listener. To be honest, this awful <strong>unless we add button detection in <code>mouseup</code> listener every time we want to do something when user only press and release left button.</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  event.preventDefault()</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.onmouseup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event.button !== <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Why"><a href="#Why" class="headerlink" title="Why"></a>Why</h3><p>according to mdn <a href="https://developer.mozilla.org/en-US/docs/Web/Events/mouseup" target="_blank" rel="noopener">mouseup</a>, default action of <code>mouseup</code> is</p>
<blockquote>
<p>Default Action : Invoke a context menu (in combination with the right mouse button, if supported)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.oncontextmenu = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.onmouseup = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  event.preventDefault()</span><br><span class="line">  <span class="built_in">console</span>.error(event.type, <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, at least Chrome 70 didn’t prevent triggering <code>contextmenu</code> event. But it might explain something.</p>
<ul>
<li>Because default action of <code>rightClick</code> was to invoke a context menu. So, <code>mouseup</code> won’t get triggered.</li>
<li>And <code>event.preventDefault()</code> in <code>contextmenu</code> listener did the actual prevent job. So, <code>mouseup</code><br>get triggered.</li>
</ul>
<p>Anyway, it’s still hard to understand.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/64"><strong>Original Post</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>mouseup</tag>
        <tag>contextmenu</tag>
        <tag>preventDefault</tag>
      </tags>
  </entry>
  <entry>
    <title>Find What Font the Browser Is Actually Using</title>
    <url>/blog/2018/08/find-what-font-the-browser-is-actually-using/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>When the designer asked me what is the font of some text I told her to press F12 and check the <code>font-family</code> in Computed, like this:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180804182943.png" alt="截图20180804182943"></p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>However, when I am using that <code>font-family</code> I find that I was totally wrong. The actual font the text used is this:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180804183017.png" alt="截图20180804183017"></p>
<p>That is totally different from the <code>font-family</code> though I know that we can’t be sure that the browser would use the <code>font-family</code> we set in css.</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://stackoverflow.com/questions/884177/how-can-i-determine-what-font-a-browser-is-actually-using-to-render-some-text" target="_blank" rel="noopener">how-can-i-determine-what-font-a-browser-is-actually-using-to-render-some-text</a></li>
</ul>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>font-family</tag>
      </tags>
  </entry>
  <entry>
    <title>First Exploration on Mobile</title>
    <url>/blog/2018/06/first-exploration-on-mobile/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>Recently, I have been working on mobile development. Before this I have heard something strange but I didn’t pay attention to. Now, I have to figure out though there is a lot of stuff. I am trying to make it clear as possible as I can but I am not sure content below is completely right.</p>
<h2 id="Basic-concepts"><a href="#Basic-concepts" class="headerlink" title="Basic concepts"></a>Basic concepts</h2><h3 id="Css-Pixels-Physical-Pixels-and-DPR"><a href="#Css-Pixels-Physical-Pixels-and-DPR" class="headerlink" title="Css Pixels, Physical Pixels and DPR"></a>Css Pixels, Physical Pixels and DPR</h3><p>First, let’s start with demo:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cont"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cont</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20%</span>;</span><br><span class="line">  <span class="attribute">background</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: right;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20%</span>;</span><br><span class="line">  <span class="attribute">background</span>: yellowgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Before switching to device mode, make sure you don’t have code starts with <code>&lt;meta name=&quot;viewport&quot; ...</code> in your <code>head</code> tag.</p>
<p>Normally, we will find everything seems ok when we switch to mobile. For example, Let’s switch to iPhone6.</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180614143059.png"></p>
<p>According to <a href="https://developer.chrome.com/devtools/docs/device-mode" target="_blank" rel="noopener">chrome-devtools</a>, width 375 and height 667 is <code>css pixels</code>. And before we keep going , we need to figure out some terms first including <code>css pixels</code>, <code>physical pixels</code> and <code>DPR</code>. Here is some related readings:</p>
<ul>
<li><p><a href="https://stackoverflow.com/questions/3588983/converting-between-physical-pixels-and-css-pixels" target="_blank" rel="noopener">converting-between-physical-pixels-and-css-pixels</a></p>
</li>
<li><p><a href="https://stackoverflow.com/questions/8785643/what-exactly-is-device-pixel-ratio" target="_blank" rel="noopener">what-exactly-is-device-pixel-ratio</a></p>
</li>
<li><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener">mdn-devicePixelRatio</a></p>
</li>
</ul>
<p>After reading those stuff, I am still confused. But I can figure something out at least. Well, here is the point based on iPhone6:</p>
<ul>
<li><p>width 375 and height 667 is <code>css pixels</code></p>
</li>
<li><p><code>DPR</code> is 2</p>
</li>
<li><p><code>DPR</code> &#x3D; <code>physical pixels</code>&#x2F;<code>css pixels</code>. So <code>physical pixels</code> is 750*1334</p>
</li>
</ul>
<h3 id="Layout-Viewport-and-Visual-Viewport"><a href="#Layout-Viewport-and-Visual-Viewport" class="headerlink" title="Layout Viewport and Visual Viewport"></a>Layout Viewport and Visual Viewport</h3><p>Ok, let’s keep going. If you calculate the dimensions of viewport, you will get some strange values like below:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.clientWidth <span class="comment">//980</span></span><br><span class="line"><span class="built_in">document</span>.documentElement.clientHeight <span class="comment">//1743</span></span><br></pre></td></tr></table></figure>

<p>Maybe you thought that the value should be 375*667 or 750*1334. However, it doesn’t. The result 980*1743 is the dimensions of <code>layout viewport</code>. Well, before keep going we need to know something about <code>layout viewport</code> and <code>visual viewport</code>. Here is the related articles:</p>
<ul>
<li><p><a href="https://www.quirksmode.org/mobile/viewports.html" target="_blank" rel="noopener">quirksmode-viewports</a></p>
</li>
<li><p><a href="https://www.quirksmode.org/mobile/viewports2.html" target="_blank" rel="noopener">quirksmode-viewports2</a></p>
</li>
<li><p><a href="https://quirksmode.org/mobile/viewports/" target="_blank" rel="noopener">quirksmode-viewports-app</a></p>
</li>
</ul>
<p>Based on the articles above we can be sure of something about <code>layout viewport</code> and <code>visual viewport</code>.</p>
<ul>
<li><p><code>layout viewport</code> is the area that the browser uses to calculate the dimensions of elements with percentual width.</p>
</li>
<li><p><code>visual viewport</code> is the part of the page that’s currently shown on-screen. The user may scroll to change the part of the page he sees, or zoom to change the size of the <code>visual viewport</code>.</p>
</li>
<li><p>Zoom doesn’t change the size of <code>layout viewport</code> but <code>visual viewport</code>.</p>
</li>
<li><p>The size of <code>visual viewport</code> &lt;&#x3D; the size of <code>layout viewport</code>.</p>
</li>
<li><p>Both <code>layout viewport</code> and <code>visual viewport</code> are measured by <code>css pixels</code>.</p>
</li>
<li><p>Many mobile browsers initially show any page in fully zoomed-out mode to show the complete content of the site. Thus <code>layout viewport</code> is equal to the <code>visual viewport</code> at that moment.</p>
</li>
</ul>
<p>And in this case of iPhone6, here is something we can be sure of:</p>
<ul>
<li><p><code>layout viewport</code> is 980*1743</p>
</li>
<li><p><code>visual viewport</code> is also 980*1743</p>
</li>
<li><p>The mobile browser show the page in fully zoomed-out mode to show the complete content of the site.</p>
</li>
</ul>
<h3 id="Meta-Tag"><a href="#Meta-Tag" class="headerlink" title="Meta Tag"></a>Meta Tag</h3><p>Now, we know what happened when we switch to mobile mode. Also, we know why the size of font becomes smaller in visual.</p>
<p>However, we would want the <code>layout viewport</code> to be 375*667 or 750*1334 if we want to build a adaptive website. Fortunately, we can control the size of <code>layout viewport</code> by tag <code>meta</code>. For instance,</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=375,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>You can find the doc of <code>meta</code> in <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta#Specifications" target="_blank" rel="noopener">mdn-meta</a> and <code>viewport</code> in <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Mobile/Viewport_meta_tag" target="_blank" rel="noopener">mdn-viewport_meta_tag</a>. In the code above, we define 375px for the <code>width</code> of <code>layout viewport</code>. Here, 375px is <code>css pixels</code>. Also, you can prove it by:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.clientWidth <span class="comment">//375</span></span><br><span class="line"><span class="built_in">document</span>.documentElement.clientHeight <span class="comment">//667</span></span><br></pre></td></tr></table></figure>

<p>So, any change? Yes. The change is the font-size is bigger in visual than before. Before we change the text is too small to read.</p>
<p>We can keep testing by change the <code>width</code> in <code>meta</code>. For example, let’s try 750:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=750,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Look what we got:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180614143060.gif"></p>
<p>This makes sense. However, if you remove <code>user-scalable=no</code> in the <code>meta</code> the browser will again enter into the fully zoomed-out mode. In that case, you will find the font-size is smaller and the whole page is showed in the screen which make the effect of <code>initial-scale=1</code> disappear.</p>
<p>To be compatible with mobiles with different sizes we need to switch the number to <code>device-width</code>:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>It is easy to understand, I think. Until now, it seems that we can be compatible with mobiles. Is that true?</p>
<h2 id="Adaptive-Layout"><a href="#Adaptive-Layout" class="headerlink" title="Adaptive Layout"></a>Adaptive Layout</h2><p>In the case above, we set <code>width:50%</code> for the <code>.left</code> and <code>.right</code> box. So, they could be adaptive. If we use <code>px</code> the page will not be adaptive because the size of viewport varies between mobiles. So, we have two choices</p>
<ol>
<li>Use different size according to the size of viewport</li>
<li>Use percentage always</li>
</ol>
<p>Option2 will work if our page is simple enough. In most instances, it will bring a disaster because of nested elements. One modification in parent will bring changes to all descendant elements.</p>
<p>The problem of option1 is if we can avoid writing so many media queries codes to adapt to different sizes of viewport. For example:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ... other codes for .cont with different sizes */</span></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width:</span> <span class="number">800px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.cont</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">max-width:</span> <span class="number">400px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.cont</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*... other codes for .cont with different sizes */</span></span><br></pre></td></tr></table></figure>

<p>Actually, we can avoid these codes. The key is <code>rem</code>. For example, code above can be simplified like:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">80px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cont</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* no more codes for .cont with different sizes */</span></span><br></pre></td></tr></table></figure>

<p>When the size of viewport is 400px, we just need to update the <code>font-size</code> of <code>html</code> with <code>40px</code>. That is easy with js. Seems wonderful with <code>rem</code>? huh?</p>
<p>You can use <code>rem</code> everywhere and js just run one time. Here is the related lib <a href="https://github.com/amfe/lib-flexible">lib-flexible</a>.</p>
<h2 id="Latest-Adaptive-Layout"><a href="#Latest-Adaptive-Layout" class="headerlink" title="Latest Adaptive Layout"></a>Latest Adaptive Layout</h2><p>Basically, there is no big problem with <code>rem</code>. Well, you might realize that we can totally use <code>vw</code> instead. That’s correct! The compatibility has become better for most developers to use. The same thing happen to <code>flex</code> and <code>grid</code> layout. Until 2018.6, <code>flex</code> is a choice but we still need to wait for <code>grid</code> or look for some polyfill.</p>
<p>However, there is still some little problems when using <code>vw</code> or <code>rem</code> layout.</p>
<ul>
<li>We still use <code>px</code> for <code>font-size</code> and <code>border</code>.</li>
</ul>
<p>I think it is easy to understand because decimals would appear. In that case, we may get <code>15px</code> or <code>17px</code> instead of <code>16px</code>. At the same time, <code>border</code> may disappear because of some numbers like <code>0.9px</code>.</p>
<ul>
<li>Develop with plugins</li>
</ul>
<p>For instance, if we are developing based on iPhone6 whose width is 375px in css pixel while the designer gives us a PSD whose width is 750px, how we are going to do? Calculate the div with 75px and transform to 10% and write 10vw? So we calculate and write it one by one? That’s terrible.</p>
<p>We can just write 75px and other numbers and leave the transform jobs to plugins(e.g. <code>less</code>,<code>postcss</code>.etc.).</p>
<h2 id="Problems-Caused-by-DPR"><a href="#Problems-Caused-by-DPR" class="headerlink" title="Problems Caused by DPR"></a>Problems Caused by DPR</h2><h3 id="Blurry-or-Sharp-in-Different-DPR-Device"><a href="#Blurry-or-Sharp-in-Different-DPR-Device" class="headerlink" title="Blurry or Sharp in Different DPR Device"></a>Blurry or Sharp in Different DPR Device</h3><p>Until now, we haven’t talked about DPR which we mentioned in the beginning. As <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener">mdn-devicepixelratio</a> says:</p>
<blockquote>
<p>In simpler terms, this tells the browser how many of the screen’s actual pixels should be used to draw a single CSS pixel.</p>
</blockquote>
<p>On the desktop or before the appearance of Retina display, DPR is always equal to 1. However, things became complicated after that. At present, there is a lot of DPR on the market which varies from 1 to 4. Sometimes, there comes 1.5 or 2.75. Anyway, we will talk about it later.</p>
<p>We can always get DPR by <code>window.devicePixelRatio</code>. The problem is that on retina screens or device whose DPR more than 1 images will become blurry. Of course we will try to avoid that. So, we have to figure out what happened to those mobiles with bigger DPR.</p>
<p>According to <a href="https://www.smashingmagazine.com/2012/08/towards-retina-web/" target="_blank" rel="noopener">towards-retina-web</a>,</p>
<blockquote>
<p>A bitmap pixel is the smallest unit of data in a raster image (PNG, JPG, GIF, etc). Each pixel contains information on how it is to be displayed, including its position in the image’s coordinate system and its color.</p>
</blockquote>
<blockquote>
<p>Beside its raster resolution, an image on the Web has an abstract size, defined in CSS pixels. The browser squeezes or stretches the image based on its CSS height or width during the rendering process.</p>
</blockquote>
<blockquote>
<p>When a raster image is displayed at full size on a standard-density display, 1 bitmap pixel corresponds to 1 device pixel, resulting in a full-fidelity representation. Because a bitmap pixel can’t be further divided, it gets multiplied by four on Retina displays(assuming DPR is 2) to preserve the same physical size of the image, losing detail along the way.</p>
</blockquote>
<p>For example, we got iPhone6 whose DPR is 2. And img we have is:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"example.png"</span> <span class="attr">width</span>=<span class="string">"2"</span> <span class="attr">height</span>=<span class="string">"2"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Assume that size of example.png is 2*2 and the picture is like:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180615093229.png"></p>
<p>With DPR of 2, the browser has to use 2 device pixels to draw a single css pixel. So <code>img</code> with 2*2 css pixels will be drew by 4*4 device pixel which means example.png with 2*2 bitmap pixels will be drew by 4*4 device pixel. So, 4 bitmap pixels of example.png will be drew by 16 device pixels which means 1 bitmap pixel will be drew by 4 device pixels.</p>
<p>Let’s move on, normally what we want might be:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180615090536.png"></p>
<p>However, actual result will be:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180615090453.png"></p>
<p>The result happens because 1 bitmap pixel can’t be further divided into 4 device pixels. That’s what @smashingmagazine says:</p>
<blockquote>
<p>A bitmap pixel is the smallest unit of data in a raster image (PNG, JPG, GIF, etc).</p>
</blockquote>
<blockquote>
<p>Because a bitmap pixel can’t be further divided, it gets multiplied by four on Retina displays(assuming DPR is 2) to preserve the same physical size of the image, losing detail along the way.</p>
</blockquote>
<p>You can also find another example in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener">mdn-devicepixelratio</a>.</p>
<p>So, how can we fix this? Basically, choices we have are listed as below:</p>
<ol>
<li>Change the size of <code>img</code>, for example:</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"example.png"</span> <span class="attr">width</span>=<span class="string">"1"</span> <span class="attr">height</span>=<span class="string">"1"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In this case, <code>img</code> with 1*1 css pixel will be drew by 2*2 device pixels which means example.png with 2*2 bitmap pixels will be divided by 2*2 device pixels. Hence, 1 bitmap pixel corresponds to 1 device pixel.</p>
<p>We might not use this alone because the layout would be affected.</p>
<ol start="2">
<li>Replace example.png with 4*4 and keep the original <code>img</code> with 2*2 css pixels, same explanation as above.</li>
</ol>
<p>In this case, we might do this by changing the <code>src</code> attribute in the <code>img</code>. For example, update the <code>src</code> search param <code>?v=2*2</code> with <code>?v=4*4</code> or change from example.png to <a href="mailto:&#x65;&#120;&#x61;&#x6d;&#112;&#x6c;&#x65;&#64;&#50;&#120;&#x2e;&#x70;&#110;&#103;" target="_blank" rel="noopener">&#x65;&#120;&#x61;&#x6d;&#112;&#x6c;&#x65;&#64;&#50;&#120;&#x2e;&#x70;&#110;&#103;</a>. <a href="https://github.com/strues/retinajs">retinajs</a> will help you do this job.</p>
<ol start="3">
<li><p>Use icon-font instead of raster image.</p>
</li>
<li><p>Use svg instead.</p>
</li>
</ol>
<p>Actually, what you need to care about is not only <code>img</code> but also <code>background-image</code>. So, option1 and option2 will be not convenient without any other help(e.g. retinajs).</p>
<p>Also, with DPR smaller than 2 we need to switch size back. If not, image will become sharp which is the opposite process of blur. For instance:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180615155759.png"></p>
<p>Compare with the process of blur:</p>
<p><img src="/blog/../images/%E6%88%AA%E5%9B%BE20180615090453.png"></p>
<p>Option3 and option4 would be easier. And with the help of <a href="http://www.iconfont.cn/" target="_blank" rel="noopener">iconfont</a>, things can be easier and easier when you choose svg.</p>
<p>Personally, I would choose option4 in daily work. For more information about the options, click <a href="https://www.smashingmagazine.com/2012/08/towards-retina-web/" target="_blank" rel="noopener">towards-retina-web</a>.</p>
<h3 id="Problems-about-Border"><a href="#Problems-about-Border" class="headerlink" title="Problems about Border"></a>Problems about Border</h3><p>Assume that we are using iPhone6 whose DPR is 2, border with 1 css pixel will be drew with 2 device pixels. Does that matter?</p>
<p>Yeah, sometimes that make the border thicker in visual. When we set 1px on border, actually what we might want is to set the thinnest border that device support. Normally, on desktop browser 1px is the thinnest. So in this case, you might need to talk with designer if he wants the thinnest border(e.g. 0.5px) or still 1px.</p>
<p>Anyway, there is lots of ways if we want to set the thinnest border. So, I wrote another blog to talk about that. Please check <a href="./layout-on-mobile.md">border on mobile</a>.</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>I have written too much about the basic knowledge about layout on mobile. However, there are still lots of problems I haven’t mentioned. Anyway, I will write them in other blogs.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://www.quirksmode.org/mobile/viewports.html" target="_blank" rel="noopener">quirksmode-viewports</a></p>
<p><a href="https://www.quirksmode.org/mobile/viewports2.html" target="_blank" rel="noopener">quirksmode-viewports2</a></p>
<p><a href="https://quirksmode.org/mobile/viewports/" target="_blank" rel="noopener">quirksmode-viewports-app</a></p>
<p><a href="https://www.quirksmode.org/blog/archives/2010/04/a_pixel_is_not.html" target="_blank" rel="noopener">a_pixel_is_not</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta#Specifications" target="_blank" rel="noopener">mdn-meta</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Mobile/Viewport_meta_tag" target="_blank" rel="noopener">mdn-viewport_meta_tag</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener">mdn-devicepixelratio</a></p>
<p><a href="https://drafts.csswg.org/mediaqueries-3/#units" target="_blank" rel="noopener">specs-mediaqueries-3</a></p>
<p><a href="https://developer.chrome.com/devtools/docs/device-mode" target="_blank" rel="noopener">chrome-devtools</a></p>
<p><a href="https://stackoverflow.com/questions/8785643/what-exactly-is-device-pixel-ratio" target="_blank" rel="noopener">what-exactly-is-device-pixel-ratio</a></p>
<p><a href="https://stackoverflow.com/questions/3588983/converting-between-physical-pixels-and-css-pixels" target="_blank" rel="noopener">converting-between-physical-pixels-and-css-pixels</a></p>
<p><a href="https://www.smashingmagazine.com/2012/08/towards-retina-web/" target="_blank" rel="noopener">towards-retina-web</a></p>
<p><a href="http://www.iconfont.cn/" target="_blank" rel="noopener">iconfont</a></p>
<p><a href="https://github.com/strues/retinajs">retinajs</a></p>
<p><a href="https://github.com/amfe/lib-flexible">lib-flexible</a></p>
<p>Chinese:</p>
<p><a href="https://segmentfault.com/a/1190000004336869" target="_blank" rel="noopener">移动端适配方案(上)</a></p>
<p><a href="https://segmentfault.com/a/1190000004358316" target="_blank" rel="noopener">移动端适配方案(下)</a></p>
<p><a href="http://www.html-js.com/article/Mobile-terminal-H5-mobile-terminal-HD-multi-screen-adaptation-scheme%203041" target="_blank" rel="noopener">移动端高清、多屏适配方案</a></p>
<p><a href="https://www.w3cplus.com/mobile/lib-flexible-for-html5-layout.html" target="_blank" rel="noopener">使用 flexible 实现手淘 h5 页面的终端适配</a></p>
<p><a href="https://www.w3cplus.com/mobile/vw-layout-in-vue.html" target="_blank" rel="noopener">如何在 vue 项目中使用 vw 实现移动端适配</a></p>
<p><a href="https://www.w3cplus.com/css/vw-for-layout.html" target="_blank" rel="noopener">再聊移动端页面的适配</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>mobile</tag>
        <tag>layout</tag>
        <tag>rem</tag>
        <tag>viewport</tag>
        <tag>layout viewport</tag>
        <tag>visual viewport</tag>
        <tag>css pixel</tag>
        <tag>device pixel</tag>
        <tag>DPR</tag>
        <tag>retina</tag>
        <tag>meta</tag>
        <tag>device-width</tag>
        <tag>initial-scale</tag>
        <tag>user-scalable</tag>
      </tags>
  </entry>
  <entry>
    <title>How to Debug with a More Efficient Way</title>
    <url>/blog/2018/05/how-to-debug-with-a-more-efficient-way/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>There is always sometimes when I ran into a problem and I was stuck in there. After problems solved, I watched back and thought maybe I can fix the problem alone or it shouldn’t take me so much time to work it out. So, I decided to write something about how to debug with a more efficient way.</p>
<h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><h3 id="Calm-down-first"><a href="#Calm-down-first" class="headerlink" title="Calm down first"></a>Calm down first</h3><p>Are you beginning to sweat now? Take a walk if you are and forget about the origin thought.</p>
<h3 id="Try-to-figure-out-what-the-question-you-are-facing"><a href="#Try-to-figure-out-what-the-question-you-are-facing" class="headerlink" title="Try to figure out what the question you are facing"></a>Try to figure out what the question you are facing</h3><h4 id="Problems-which-are-in-a-big-project"><a href="#Problems-which-are-in-a-big-project" class="headerlink" title="Problems which are in a big project"></a>Problems which are in a big project</h4><p>Well, I hate this but I still meet this in some cases.</p>
<p>At present, I am trying to extract the problem from the big project and reproduce it in a demo which is as minimal as possible. Then, I will try to figure out what the problem I am actually facing with. After all, it’s easier to debug in a minimal demo than a big project. Then, fix the demo and fix the project.</p>
<p>Sometimes the problems can’t be or are not easy to be extracted. In that case, I would try to disable other functions which might complicate the problems to make the problems easier to fix.</p>
<h4 id="Problems-which-are-out-of-control"><a href="#Problems-which-are-out-of-control" class="headerlink" title="Problems which are out of control"></a>Problems which are out of control</h4><p>If the error is out of your control, for example, you are working with something you basically have no idea, you had better pay attention to the error information. Then find the document and search for something about the error information.</p>
<p>It is quite common to encounter a new problem when we are using a frame which we don’t know much about it. If that happens, the quickest way is to find the document and see if the way we use is not right.</p>
<h4 id="Problems-seem-familiar"><a href="#Problems-seem-familiar" class="headerlink" title="Problems seem familiar"></a>Problems seem familiar</h4><p>If you know something about your error, for example, you are running a demo which doesn’t behave as you expected, maybe you should stop and ask yourself a few questions:</p>
<ul>
<li><p>What is my expected output?</p>
</li>
<li><p>Why should the demo behave like that?</p>
</li>
</ul>
<p>In this way, you might say that it should behave like that because the specs said that it should ….. It doesn’t matter if you don’t remember the details of the specs. In this case, you should go to check the part of the specs and read the specs carefully again to see if it really defines the behavior you expected. And I still suggest you reading the specs again even that you remember the details.</p>
<p>Don’t tell me you don’t know where the specs is because this shouldn’t happen. Or if it really happens, it is better for you to find the specs as soon as possible.</p>
<p>Usually, you will find that you missed something in the specs or just misunderstand the specs or the specs just didn’t define the specific behavior.</p>
<p>However, sometimes you are totally right after reading the specs. In this case, I think it’s time to ask in the community like <a href="https://stackoverflow.com/" target="_blank" rel="noopener">Stackoverflow</a> or just ask the specs working group. Before asking, you had better know something about how to ask.</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>Anyway, the last way is <a href="https://www.google.com/" target="_blank" rel="noopener">google</a> and I will update when I figure out something new.</p>
]]></content>
      <categories>
        <category>debug</category>
      </categories>
      <tags>
        <tag>debug</tag>
        <tag>efficiency</tag>
      </tags>
  </entry>
  <entry>
    <title>How to Prevent Collapse of Empty Rows in HTML table</title>
    <url>/blog/2019/08/how-to-prevent-collapse-of-empty-rows-in-html-table/</url>
    <content><![CDATA[<p>If you have met empty rows in HTML table or have seen this question</p>
<p><a href="https://stackoverflow.com/questions/42225196/prevent-collapse-of-empty-rows-in-html-table-via-css/42225797" target="_blank" rel="noopener">Prevent collapse of empty rows in HTML table via CSS</a></p>
<p>you might know what I am saying. See this image:</p>
<p><img src="/blog/images/%7B7BF1B62D-3148-4A47-BC17-538AFEEE4D19%7D_20190827105623.jpg"></p>
<p>Above answers can’t handle strings like <code>&quot; &quot;</code>. In this case, we still need the help of js. Just like the idea of css,</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">// prevent empty table rows collapse</span><br><span class="line"><span class="selector-class">.cell</span><span class="selector-pseudo">:empty</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"\00a0"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>We can write a function like</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">falsyToNbsp</span>(<span class="params">value, falsyValues = [null, undefined, <span class="string">""</span>, NaN]</span>) </span>&#123;</span><br><span class="line">  value = <span class="keyword">typeof</span> value === <span class="string">"string"</span> ? value.trim() : value;</span><br><span class="line">  <span class="keyword">return</span> falsyValues.includes(value) ? <span class="string">"\u00a0"</span> : value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

 <!--//todo unicode in `html`, how does `\u00a0` show? -->

<p>You can use it in vue filters like</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; falsyToNbsp &#125; <span class="keyword">from</span> <span class="string">"utils"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  filters: &#123;</span><br><span class="line">    falsyToNbsp</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>or with other libs.</p>
<p><strong><a href="https://github.com/xianshenglu/blog/issues/98">Issue</a></strong></p>
<p><strong><a href="https://github.com/xianshenglu/blog/blob/master/source/_posts/how-to-prevent-collapse-of-empty-rows-in-html-table.md">Source</a></strong></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>content</tag>
        <tag>table</tag>
      </tags>
  </entry>
  <entry>
    <title>If you have no time to write tests, I&#39;d recommend trying e2e test</title>
    <url>/blog/2023/09/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test/</url>
    <content><![CDATA[<p>It’s very common that developers don’t have time to write tests, especially unit tests. </p>
<p>In real-world apps, unit tests take lots of time so many teams give it up. Since they have given up the foundation of the test suit(unit test), they will also give up other tests. emmm……</p>
<p>Actually, investing time in e2e(end-to-end) tests can be a cost-effective choice, especially for web apps. The least time can help you solve the biggest problem. For example,</p>
<ul>
<li>I want to avoid the blank page appearing in my website(Fatal bugs but only need the least time to avoid).</li>
<li>I want to reduce the high&#x2F;critical bugs in the testing phase or production environment(Important for the DEV&#x2F;QA team but only need a little time)</li>
<li>I want to keep the core functions available in any case(Depends on how many core functions you want to cover)</li>
</ul>
<p>Now, I’ll show the demo.</p>
<h3 id="Choose-an-e2e-test-frameworks"><a href="#Choose-an-e2e-test-frameworks" class="headerlink" title="Choose an e2e test frameworks"></a>Choose an e2e test frameworks</h3><p>There’re many e2e test frameworks. I’ll compare them in another article, you can see a short comparison  via this graph. </p>
<p><img src="/blog/images/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test-image-1.png" alt="Alt text"></p>
<p><em><a href="https://npmtrends.com/cypress-vs-playwright-vs-selenium-webdriver-vs-webdriverio" target="_blank" rel="noopener">source</a></em></p>
<p>Because <a href>playwright</a> is very convenient to demo, I’ll choose this one in this article. </p>
<h3 id="Set-up-e2e-tests"><a href="#Set-up-e2e-tests" class="headerlink" title="Set up e2e tests"></a>Set up e2e tests</h3><p>I create the test project using <code>npm init playwright@latest</code>. Also, I installed <a href="https://marketplace.visualstudio.com/items?itemName=ms-playwright.playwright" target="_blank" rel="noopener">playwright vscode extension</a>. These are the files created by playwrite.</p>
<p><img src="/blog/images/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test-image-2.png" alt="Alt text"></p>
<h3 id="Run-the-example-tests"><a href="#Run-the-example-tests" class="headerlink" title="Run the example tests"></a>Run the example tests</h3><p>Now, I’ll run the example test through the start button provided by the vscode extension.</p>
<p><img src="/blog/images/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test-image-3.png" alt="Alt text"></p>
<p>You can see the browsers opened and the test passed.</p>
<p><img src="/blog/images/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test-image-4.png" alt="Alt text"></p>
<p>You can also see the test results in many places.</p>
<p><img src="/blog/images/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test-image-5.png" alt="Alt text"></p>
<h3 id="A-brief-conclusion"><a href="#A-brief-conclusion" class="headerlink" title="A brief conclusion"></a>A brief conclusion</h3><ul>
<li><p>As you can see, it’s extremely simple to run tests and see the running status(because the browser can be opened during the tests). </p>
</li>
<li><p>Also, in the example test, <strong>we only need 3 lines to verify that the target websites is available</strong> and not displaying a blank page to users. If we deploy the tests to the CI QA and end users will have much lower chances of meeting a blank page.</p>
</li>
</ul>
<p>You can also see the generated test reports</p>
<p><img src="/blog/images/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test-image-6.png" alt="Alt text"><br><img src="/blog/images/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test-image-7.png" alt="Alt text"></p>
<h3 id="One-step-further"><a href="#One-step-further" class="headerlink" title="One step further"></a>One step further</h3><p>If <a href="https://playwright.dev/" target="_blank" rel="noopener">playwright homepage</a> is our own product, then we can summarize the core functions or test cases</p>
<ol>
<li>The homepage should be available</li>
<li>click the <code>Docs</code> should go to the document page</li>
<li>The document page should display the correct documents</li>
</ol>
<p>Actually, there’re many remaining functions in the homepage, but the core functions are not too many. Since it’s a document website, the core function is that it is available and provides correct content. </p>
<p>If other functions are broken, it’s not that important. Even if found in the production environment, you may not be required to fix it urgently like in 1 hour.</p>
<p><strong>That’s the truth in reality, not everything has the same importance.</strong></p>
<p>If you do have enough time, of course, you can cover more cases. In that case, I guess you’re also required to write unit tests.</p>
<p>Anyway, based on my time budget and assumption, I’ll demo how to cover the remaining test cases.</p>
<p>Here’s all the code for the above cases, less than 30 lines(including empty lines).</p>
<p><img src="/blog/images/if-you-have-no-time-to-write-tests-i-d-recommend-trying-e2e-test-image-8.png" alt="Alt text"></p>
<p>In real-world apps, to make element locating easier, we can add an attribute like <code>data-testid</code> in the testing element, then we can use something like </p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">await</span> page.getByTestId(<span class="string">'nav-docs'</span>).click();</span><br></pre></td></tr></table></figure>

<p>instead of </p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">await</span> page.locator(<span class="string">'.navbar__link'</span>).getByText(<span class="string">'Docs'</span>).click();</span><br></pre></td></tr></table></figure>

<p>to make writing e2e tests even easier.</p>
<p>The only thing left now is to deploy the e2e test to your CI environment(Jenkins, Github Actions…). You can find the documents <a href="https://playwright.dev/docs/ci" target="_blank" rel="noopener">here</a>.</p>
<h3 id="One-more-thing"><a href="#One-more-thing" class="headerlink" title="One more thing"></a>One more thing</h3><p>Writing e2e tests can also help you write automation scripts to <strong>solve life problems</strong>, not just good for development works. </p>
<p>So, are you planning to write some e2e tests for your project now?</p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>TBD</tag>
      </tags>
  </entry>
  <entry>
    <title>Image Load Error Handler</title>
    <url>/blog/2018/11/image-load-error-handler/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>In the past, I posted an answer in SO about how to <a href="https://stackoverflow.com/questions/92720/jquery-javascript-to-replace-broken-images/50484874" target="_blank" rel="noopener">replace broken images</a>. And the code is</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(</span><br><span class="line">  <span class="string">'error'</span>,</span><br><span class="line">  windowErrorCb,</span><br><span class="line">  &#123;</span><br><span class="line">    capture: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">true</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">windowErrorCb</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> target = event.target</span><br><span class="line">  <span class="keyword">let</span> isImg = target.tagName.toLowerCase() === <span class="string">'img'</span></span><br><span class="line">  <span class="keyword">if</span> (isImg) &#123;</span><br><span class="line">    imgErrorCb()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">imgErrorCb</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> isImgErrorHandled = target.hasAttribute(<span class="string">'data-src-error'</span>)</span><br><span class="line">    <span class="keyword">if</span> (!isImgErrorHandled) &#123;</span><br><span class="line">      target.setAttribute(<span class="string">'data-src-error'</span>, <span class="string">'handled'</span>)</span><br><span class="line">      target.src = <span class="string">'backup.png'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">//anything you want to do</span></span><br><span class="line">      <span class="built_in">console</span>.log(target.alt, <span class="string">'both origin and backup image fail to load!'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And the point is :</p>
<ol>
<li><p>Put the code in the head and executed as the first inline script. So, it will listen the errors happen after the script.</p>
</li>
<li><p>Use event capturing to catch the errors earlier, also for those events which don’t bubble.</p>
</li>
<li><p>Use event delegation which avoids binding events on each image.</p>
</li>
<li><p>Give the error img element an attribute after giving them a backup.png to avoid error of the <em>backup.png</em> and subsequent infinite loop like below:</p>
</li>
</ol>
<blockquote>
<p>img error-&gt;backup.png-&gt;error-&gt;backup.png-&gt;error-&gt;,,,,,</p>
</blockquote>
<p>I thought the answer is almost perfect. But it turns out there is more scenes I don’t know.</p>
<h4 id="No-Src"><a href="#No-Src" class="headerlink" title="No Src?"></a>No Src?</h4><p>Until Chrome 70.0.3538.102 in win7, code below wouldn’t trigger error event.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>But code below would trigger!</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> /&gt;</span> <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>That does make sense. However, <code>img</code> without <code>src</code> wouldn’t hidden. They would have 1px border like:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181119171728.png"></p>
<p>In this case, we may have to do something about that. For instance,</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">:not(</span><span class="selector-attr">[src]</span>) &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>or a default <code>backgroundImage</code> which will work on <code>img</code> though 1px border is still there.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">:not(</span><span class="selector-attr">[src]</span>) &#123;</span><br><span class="line">  <span class="attribute">background</span>: no-repeat left top / cover;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(to right, lightblue, pink); <span class="comment">/*or your logo*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="BackgroundImage-Error"><a href="#BackgroundImage-Error" class="headerlink" title="BackgroundImage Error?"></a>BackgroundImage Error?</h4><p>I still can’t find a perfect solution for <code>backgroundImage</code>. The best answer in SO is like:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.app__bg_img_box</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: no-repeat left top / cover;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(./images/github.png), <span class="built_in">linear-gradient</span>(to right, lightblue, pink);</span><br><span class="line">  <span class="comment">/* you can also use default.png like code below */</span></span><br><span class="line">  <span class="comment">/* background-image: url(./images/github.png), url(./images/default.png); */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And the cons is obvious.</p>
<p><img src="/blog/images/1542620382678.gif"></p>
<ol>
<li>You have to take care of the transparency problem of the target image.</li>
<li>Users can see the toggle between target image and default image.</li>
<li>A little flaw is that default image will always be downloaded.</li>
</ol>
<p>Another way I figured out is like code below. Here is the simplest code:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> backgroundDivs = <span class="built_in">Array</span>.from(<span class="built_in">document</span>.querySelectorAll(<span class="string">'.app__bg_img_box'</span>))</span><br><span class="line">backgroundDivs.forEach(<span class="function"><span class="params">div</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> imgUrl = <span class="built_in">window</span></span><br><span class="line">    .getComputedStyle(div)</span><br><span class="line">    .backgroundImage.match(<span class="regexp">/url\(["']?(.*)["']?\)/</span>)</span><br><span class="line">  <span class="keyword">if</span> (imgUrl) &#123;</span><br><span class="line">    <span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">    img.src = imgUrl[<span class="number">1</span>]</span><br><span class="line">    img.onerror = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">      div.style.backgroundImage = <span class="string">'url(./images/default.png)'</span></span><br><span class="line">      img.onerror = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>It will work well in most simple scenes but the cons is also obvious:</p>
<ol>
<li>Code will be more complicated if you want to deal with multiple backgroundImages.</li>
<li>Each time you updated your dom structure, you may have to run the code above if you have add new divs with backgroundImage.</li>
</ol>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>If lucky enough, we may have the new API in <a href="https://drafts.csswg.org/css-images-4/#image-set-notation" target="_blank" rel="noopener">Images</a> which would make code below work.</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">background: image('target.gif', 'fallback.gif');</span><br></pre></td></tr></table></figure>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><p><a href="https://stackoverflow.com/questions/22287474/onerror-event-using-background-url" target="_blank" rel="noopener">onerror event using background: url()</a></p>
</li>
<li><p><a href="https://drafts.csswg.org/css-images-4/#image-set-notation" target="_blank" rel="noopener">image-set-notation</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>img</tag>
      </tags>
  </entry>
  <entry>
    <title>Label Can&#39;t Be Focused In Firefox With Element.focus()</title>
    <url>/blog/2018/06/label-can-t-be-focused-in-firefox-with-element.focus()/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>As the title says, let’s see the demo below:</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">id</span>=<span class="string">"cont"</span> <span class="attr">contentEditable</span>&gt;</span></span><br><span class="line">   label should be focused</span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"focus"</span>&gt;</span>make label focus<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#cont</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'#focus'</span>)[<span class="number">0</span>].onclick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  $(<span class="string">'#cont'</span>)[<span class="number">0</span>].focus()</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">'#cont'</span>)[<span class="number">0</span>].onfocus = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.type)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="built_in">document</span>.querySelectorAll(selector))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Suppose that you are using chrome, after loaded please press <code>F12</code> and open the console and then click the button. <code>label#cont</code> should be focused after clicking the button.So, there will be word <code>focus</code> at the console.</p>
<p>However, firefox wouldn’t do that until you click the label. Anyway, I have posted a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1468049" target="_blank" rel="noopener">bug</a>. Let’s see what will happen.</p>
]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>focus</tag>
        <tag>label</tag>
        <tag>firefox</tag>
        <tag>contentEditable</tag>
      </tags>
  </entry>
  <entry>
    <title>Layout On Mobile</title>
    <url>/blog/2018/06/layout-on-mobile/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>Based on <a href="../first-exploration-on-mobile/">first-exploration-on-mobile</a> we can develop adaptive pages on mobile. Now, let’s do it.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><h3 id="Basic-Code"><a href="#Basic-Code" class="headerlink" title="Basic Code"></a>Basic Code</h3><p>Suppose that we got the PSD which is designed according to iPhone6. So, what do we have now?</p>
<ul>
<li>width:375*667</li>
<li>DPR:2</li>
</ul>
<p>So, let’s develop according to iPhone6 first. And this is the basic code:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=375,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="comment">/* reset.css */</span></span></span><br><span class="line"></span><br><span class="line">    * &#123;</span><br><span class="line">      margin: 0;</span><br><span class="line">      padding: 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    html,</span><br><span class="line">    body &#123;</span><br><span class="line">      height: 100%;</span><br><span class="line">      width: 100%;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    li &#123;</span><br><span class="line">      list-style: none;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    a &#123;</span><br><span class="line">      text-decoration: none;</span><br><span class="line">      color: inherit;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="comment">/* base.css */</span></span></span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.nav</span>,</span></span><br><span class="line"><span class="css">    <span class="selector-class">.nav__list</span> &#123;</span></span><br><span class="line">      width: 100%;</span><br><span class="line">      height: 100%;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.nav__list</span> &#123;</span></span><br><span class="line">      background-color: pink;</span><br><span class="line">      overflow: hidden;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.nav__item</span> &#123;</span></span><br><span class="line">      width: 65px;</span><br><span class="line">      height: 40px;</span><br><span class="line">      line-height: 40px;</span><br><span class="line">      margin: 5px;</span><br><span class="line">      float: left;</span><br><span class="line">      background-color: yellowgreen;</span><br><span class="line">      color: white;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.nav__link</span> &#123;</span></span><br><span class="line">      display: block;</span><br><span class="line">      width: 100%;</span><br><span class="line">      height: 100%;</span><br><span class="line">      text-align: center;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"nav"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav__list"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav4<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav5<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Well, I made a simple one just for test. Hope you don’t mind. If we switch to iPhone6 device, it looks okay.</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180616161355.png"></p>
<p>Of course it will be terrible if we switch to other devices. For example, iPhone6 Plus:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180616161446.png"></p>
<p>We got extra space on the right because the width of iPhone6 Plus is 414px which is wider than 375px in iPhone6.</p>
<p><strong>Please notice that we have used 65px, 40px and 5px in the css. Those values should be zoomed according to the device-width.</strong></p>
<p>So, here is the way how we fix this:</p>
<h3 id="Adaptive-by-rem-and-js"><a href="#Adaptive-by-rem-and-js" class="headerlink" title="Adaptive by rem and js"></a>Adaptive by rem and js</h3><p>We need do some transform to use rem. On iPhone6 with 375px and DPR:2,</p>
<ol>
<li>We can use 65px, 40px, 5px with:</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=375,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>We can also use 130px, 80px, 10px with:</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=750,initial-scale=0.5"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Further on, if we calculate rem by (device-width*DPR)&#x2F;10:</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--width=750=375*DPR,initial-scale=0.5=1/DPR--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=750,initial-scale=0.5"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="comment">/*75px = device-width * DPR / 10 */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">75px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="comment">/*32px = 16px * DPR */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Those numbers would be:</p>
<ul>
<li>65px &#x3D;&gt; (65&#x2F;375) * device-width &#x3D;&gt; (65&#x2F;375) * 10rem</li>
<li>40px &#x3D;&gt; (40&#x2F;375) * device-width &#x3D;&gt; (40&#x2F;375) * 10rem</li>
<li>5px &#x3D;&gt; (5&#x2F;375) * device-width &#x3D;&gt; (5&#x2F;375) * 10rem</li>
</ul>
<p>In fact, options above will get the same effect. But for option3, <strong>we make everything connected with DPR and device-width.</strong></p>
<p>So, here is the basic logic to be adaptive:</p>
<ol>
<li>We use the device-width*DPR&#x2F;10 to calculate <code>rem</code> and set it on <code>html</code>.</li>
<li>We set (initial font-size * DPR) on <code>body</code>.</li>
<li>For <code>font-size</code> set with px, we have to set different font-size for different DPR by <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/-webkit-device-pixel-ratio" target="_blank" rel="noopener">@media&#x2F;-webkit-device-pixel-ratio</a> or plugins(e.g. less).</li>
<li>We update <code>meta</code> by setting the <code>width</code> as device-width*DPR and <code>initial-scale</code> as 1&#x2F;DPR which would make the page render in device-width*DPR and then scale to device-width.</li>
</ol>
<p>Well, you can just see the code:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(</span></span><br><span class="line"><span class="javascript">      <span class="string">'DOMContentLoaded'</span>,</span></span><br><span class="line">      () =&gt; &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> dpr = <span class="built_in">window</span>.devicePixelRatio</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> html = <span class="built_in">document</span>.documentElement</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> body = <span class="built_in">document</span>.body</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> deviceWidth = <span class="built_in">window</span>.innerWidth || html.clientWidth</span></span><br><span class="line"><span class="javascript">        html.style.fontSize = (deviceWidth * dpr) / <span class="number">10</span> + <span class="string">'px'</span></span></span><br><span class="line"><span class="javascript">        html.setAttribute(<span class="string">'data-dpr'</span>, dpr)</span></span><br><span class="line"><span class="javascript">        body.style.fontSize = <span class="string">'initial'</span></span></span><br><span class="line"><span class="javascript">        body.style.fontSize = <span class="built_in">parseInt</span>(getComputedStyle(body).fontSize) * dpr + <span class="string">'px'</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> metaViewport = <span class="built_in">document</span>.querySelector(<span class="string">'meta[name=viewport]'</span>)</span></span><br><span class="line">        metaViewport.setAttribute(</span><br><span class="line"><span class="javascript">          <span class="string">'content'</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">`width=<span class="subst">$&#123;dpr * deviceWidth&#125;</span>,initial-scale=<span class="subst">$&#123;<span class="number">1</span> <span class="regexp">/ dpr&#125;`</span></span></span></span></span><br><span class="line">        )</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;,</span></span><br><span class="line"><span class="javascript">      <span class="literal">true</span></span></span><br><span class="line">    )</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet/less"</span> <span class="attr">href</span>=<span class="string">"./less.less"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdnjs.cloudflare.com/ajax/libs/less.js/3.0.2/less.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>base.css in <em>less.less</em></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* base.css */</span></span><br><span class="line"><span class="selector-class">.px2px</span>(<span class="variable">@name</span>, <span class="variable">@px</span>) &#123;</span><br><span class="line">  <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span>) * <span class="number">1px</span>;</span><br><span class="line">  <span class="selector-attr">[data-dpr='2']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span>*<span class="number">2</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for mx3</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.5']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.5</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//for Pixel2</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.625']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.625</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for XiaoMi note</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.75']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.75</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-attr">[data-dpr='3']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">3</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//for Pixel2 XL</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='3.5']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">3.5</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for Samsung note4</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='4']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: <span class="variable">@px</span> * <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">  <span class="comment">//suggest use em not px otherwise have to set different font-size for different DPR</span></span><br><span class="line">  <span class="selector-class">.px2px</span>(font-size, <span class="number">16px</span>);</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__list</span> &#123;</span><br><span class="line">  <span class="comment">// width: 110%;</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="comment">// for inline-block</span></span><br><span class="line">  <span class="comment">// white-space: nowrap;</span></span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">  <span class="comment">// letter-spacing: -0.3em;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__item</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="comment">// display: inline-block;</span></span><br><span class="line">  <span class="comment">// letter-spacing: normal;</span></span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">65</span>/<span class="number">375</span> * <span class="number">10rem</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">10rem</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5</span>/<span class="number">375</span> * <span class="number">10rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">10rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__link</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Code above will work in Apple’s product. However, when we switch to Pixel 2 we will find this:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180617130210.png"></p>
<p>After a little calculation, I find that the total width of 5 <code>navs</code> is 1078.85 while width of <code>.nav__list</code> is 1078. Well, I think it is reasonable though I hate this.</p>
<p>In this case, we have to do something else to fix this. For example:</p>
<ul>
<li>Set <code>margin-right:auto</code> on the last nav.</li>
<li>Set wider <code>width</code> of <code>.nav__list</code> and set <code>overflow:hidden</code> on <code>.nav</code>.</li>
<li>Use <code>width:20%</code> and <code>padding</code> instead of <code>margin</code>.</li>
<li>Other css tricks.</li>
</ul>
<p>Anyway, this is the previous solution for adaptation on mobile before appearance of <code>vw</code>,<code>flex</code> and <code>grid</code> layout.</p>
<p>Let’s make a conclusion:</p>
<ul>
<li>principle</li>
</ul>
<ol>
<li>Set different font-size for different DPR by less.</li>
<li>Use viewport scale to solve the problem of 1px on border and font-size.</li>
<li>Make the width and height of element connect with device-width by <code>rem</code>.</li>
</ol>
<ul>
<li>pro</li>
</ul>
<ol>
<li>Fix 1px problem on <code>border</code> because we set 1px on device*DPR.</li>
</ol>
<ul>
<li>con</li>
</ul>
<ol>
<li>We have to set lots of <code>font-size</code> based on DPR every time we want to set <code>font-size</code> with px. Though we can simplify our job by preprocessor(e.g. less). However, how we going to do with more and more DPR?</li>
</ol>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.px2px</span>(<span class="variable">@name</span>, <span class="variable">@px</span>) &#123;</span><br><span class="line">  <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span>) * <span class="number">1px</span>;</span><br><span class="line">  <span class="selector-attr">[data-dpr='2']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span>*<span class="number">2</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for mx3</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.5']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.5</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//for Pixel2</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.625']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.625</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for XiaoMi note</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.75']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.75</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-attr">[data-dpr='3']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">3</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//for Pixel2 XL</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='3.5']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">3.5</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for Samsung note4</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='4']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: <span class="variable">@px</span> * <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Write more and more? That’s not a good idea.</p>
<p><strong>If we use <code>em</code> instead it will not be a problem because we already set the initial font-size * DPR on <code>body</code>.</strong></p>
<ol start="2">
<li>Decimals appear which may cause a little problem in layout.</li>
</ol>
<h3 id="Adaptive-by-vw"><a href="#Adaptive-by-vw" class="headerlink" title="Adaptive by vw"></a>Adaptive by vw</h3><p>Before we start with <code>vw</code> let’s take a look at the rem and js solution. So, do we have a <strong>better</strong> solution for:</p>
<ol>
<li>border 1px problem? I don’t think so.</li>
<li>make the width and height of element connect with device-width? Yes, we do have <code>vw</code>, <code>vh</code> even <code>vmin</code> and <code>vmax</code>.</li>
</ol>
<p>And for the con of the rem and js solution:</p>
<ol>
<li><strong>In this case, we can use <code>rem</code> instead of <code>em</code> because <code>rem</code> works more like <code>px</code> than <code>em</code></strong></li>
<li>Can we avoid the decimals ? May be not with <code>vw</code> but won’t be worse than <code>rem</code>.</li>
</ol>
<p>Anyway, here is the code:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(</span></span><br><span class="line"><span class="javascript">      <span class="string">'DOMContentLoaded'</span>,</span></span><br><span class="line">      () =&gt; &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> dpr = <span class="built_in">window</span>.devicePixelRatio</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> html = <span class="built_in">document</span>.documentElement</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> body = <span class="built_in">document</span>.body</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> deviceWidth = <span class="built_in">window</span>.innerWidth || html.clientWidth</span></span><br><span class="line"><span class="javascript">        html.setAttribute(<span class="string">'data-dpr'</span>, dpr)</span></span><br><span class="line"><span class="javascript">        html.style.fontSize = <span class="string">'initial'</span></span></span><br><span class="line"><span class="javascript">        html.style.fontSize = <span class="built_in">parseInt</span>(getComputedStyle(html).fontSize) * dpr + <span class="string">'px'</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> metaViewport = <span class="built_in">document</span>.querySelector(<span class="string">'meta[name=viewport]'</span>)</span></span><br><span class="line">        metaViewport.setAttribute(</span><br><span class="line"><span class="javascript">          <span class="string">'content'</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">`width=<span class="subst">$&#123;dpr * deviceWidth&#125;</span>,initial-scale=<span class="subst">$&#123;<span class="number">1</span> <span class="regexp">/ dpr&#125;`</span></span></span></span></span><br><span class="line">        )</span><br><span class="line">      &#125;,</span><br><span class="line"><span class="javascript">      &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;,</span></span><br><span class="line"><span class="javascript">      <span class="literal">true</span></span></span><br><span class="line">    )</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet/less"</span> <span class="attr">href</span>=<span class="string">"./less.less"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdnjs.cloudflare.com/ajax/libs/less.js/3.0.2/less.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>base.css in <em>less.less</em></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* base.css */</span></span><br><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__list</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__item</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">65</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__link</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I tested every device in chrome device-mode. They all work.</p>
<p><strong>However, there are still decimals which might bite you someday.</strong></p>
<p>Anyway, let’s make a conclusion:</p>
<ul>
<li>principle</li>
</ul>
<ol>
<li>Make the font-size connect with dpr by <code>rem</code>.</li>
<li>Use viewport scale to solve the problem of 1px on border and font-size.</li>
<li>Make the width and height of element connect with device-width by <code>vw</code>.</li>
</ol>
<ul>
<li>pro</li>
</ul>
<ol>
<li>Border 1px problem is solved as before.</li>
<li>Decimals problem will be a litter better than rem and js solution.</li>
</ol>
<ul>
<li>con</li>
</ul>
<ol>
<li>Decimals still exist.</li>
</ol>
<h3 id="Adaptive-by-vw-and-flex"><a href="#Adaptive-by-vw-and-flex" class="headerlink" title="Adaptive by vw and flex"></a>Adaptive by vw and flex</h3><p>Solution with vw almost perfect except the decimals. So, how we are going to fix that? <code>Flex</code> gave us a choice.</p>
<p><strong>We can leave the decimals to browser by <code>flex</code>.</strong></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*part of css which has been modified*/</span></span><br><span class="line"><span class="selector-class">.nav__list</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">  <span class="attribute">display</span>: flex; <span class="comment">/*new added*/</span></span><br><span class="line">  <span class="attribute">justify-content</span>: space-around; <span class="comment">/*new added*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__item</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> auto; <span class="comment">/*new added*/</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">65</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If you don’t know something about flex, please check MDN. Anyway, we can leave decimals to browser. That is the most exciting part.</p>
<p>Well, let’s make a conclusion:</p>
<ul>
<li>principle</li>
</ul>
<ol>
<li>Make the font-size connect with dpr by <code>rem</code>.</li>
<li>Use viewport scale to solve the problem of 1px on border and font-size.</li>
<li>Make the width and height of element connect with device-width by <code>vw</code>.</li>
<li>Leave margin to browser by <code>flex</code>.</li>
</ol>
<ul>
<li>pro</li>
</ul>
<ol>
<li>Border 1px problem is solved as before.</li>
<li>Decimals problem will be better than <code>vw</code>.</li>
</ol>
<ul>
<li>con</li>
</ul>
<ol>
<li>Decimals still exist but only has a little influence.</li>
</ol>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>Anyway, the decimals problem always exist because of different sizes of mobiles. But the more new API we have, the less influence it will have.</p>
<p>Besides, js above is not perfect. Here is the <a href="https://github.com/xianshenglu/mobile/blob/master/layout/">current</a> version I am using.</p>
<p>And the last thing is we didn’t handle the problem with <code>img</code>. Maybe you should seek some help from <a href="https://github.com/strues/retinajs">retina.js</a>.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="../first-exploration-on-mobile/">first-exploration-on-mobile</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/-webkit-device-pixel-ratio" target="_blank" rel="noopener">@media&#x2F;-webkit-device-pixel-ratio</a></p>
<p><a href="https://github.com/amfe/lib-flexible">lib-flexible</a></p>
<p><a href="https://github.com/strues/retinajs">retina.js</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>mobile</tag>
        <tag>orientationchange</tag>
        <tag>rem</tag>
        <tag>DPR</tag>
        <tag>device-width</tag>
        <tag>initial-scale</tag>
        <tag>vw</tag>
        <tag>flex</tag>
      </tags>
  </entry>
  <entry>
    <title>Make Your Own Vue Project Template - Formatter Part</title>
    <url>/blog/2019/05/make-your-own-vue-project-template-formatter-part/</url>
    <content><![CDATA[<p>As far as I know, several formatters would run with several rules when I want to format .vue file in the <code>vscode</code> editor. I have been confused for a long time about these formatters and their specific rules, also the combined situations. Sometimes it makes me crazy. For example,</p>
<ul>
<li>For formatters, there are <code>ESLint</code>, <code>prettier</code>, <code>vscode internal formatter</code> and some other formatters which I don’t know.</li>
<li>For rules, there are <code>.eslintrc.js</code>, <code>.prettierrc.js</code>, <code>user settings</code> and other plugins like <code>eslint-plugin-html</code>, <code>eslint-plugin-vue</code>, etc.</li>
<li>In some cases, I am so sure that the code has been processed by at least 2 formatters because I saw the process of the code.</li>
<li>…</li>
</ul>
<h2 id="What-Do-You-Want"><a href="#What-Do-You-Want" class="headerlink" title="What Do You Want?"></a>What Do You Want?</h2><p>Before we keep going we have to figure out one question.</p>
<blockquote>
<p>What exactly format do we want ?</p>
</blockquote>
<p>After thinking, I figure it out.</p>
<blockquote>
<p>How can I let different developers <strong>commit</strong> with the identical styles?</p>
</blockquote>
<p>To be more specific, I want</p>
<ul>
<li><input checked disabled type="checkbox"> Slightly dependent on developers’ user settings, use configuration files instead of plugins or rules in developers’ editor as possible as we can.</li>
<li><input checked disabled type="checkbox"> Syntax-highlighting</li>
<li><input checked disabled type="checkbox"> Format and lint .js and <code>script</code> in .vue.</li>
<li><input checked disabled type="checkbox"> Format and lint .css, .less, .scss and <code>style</code> in .vue.</li>
<li><input checked disabled type="checkbox"> Format and lint <code>template</code> in .vue.</li>
<li><input disabled type="checkbox"> Format and lint <code>.html</code>.</li>
<li><input checked disabled type="checkbox"> Format and lint before commit</li>
<li><input checked disabled type="checkbox"> Can be unified on <code>vscode</code> at least, better if works on more editors.</li>
</ul>
<h2 id="Can-We-Do-This-by-One-Plugin-Like-Prettier"><a href="#Can-We-Do-This-by-One-Plugin-Like-Prettier" class="headerlink" title="Can We Do This by One Plugin Like Prettier?"></a>Can We Do This by One Plugin Like Prettier?</h2><p>Well, I didn’t find that plugin. And prettier can’t do this job either.</p>
<p>As we all know, currently prettier is the most popular format plugins. And it supports lots of editors and languages. So, it’s quite common to think that why don’t we just use prettier directly instead of using lots of linters or plugins?</p>
<p>Well, according to doc in <a href="https://prettier.io/docs/en/comparison.html" target="_blank" rel="noopener">prettier</a>,</p>
<blockquote>
<p>Linters have two categories of rules:<br><strong>Formatting rules</strong>: eg: max-len, no-mixed-spaces-and-tabs, keyword-spacing, comma-style…<br>Prettier alleviates the need for this whole category of rules! Prettier is going to reprint the entire program from scratch in a consistent way, so it’s not possible for the programmer to make a mistake there anymore :)<br><strong>Code-quality rules</strong>: eg no-unused-vars, no-extra-bind, no-implicit-globals, prefer-promise-reject-errors…<br><strong>Prettier does nothing to help with those kind of rules.</strong> They are also the most important ones provided by linters as they are likely to catch real bugs with your code!</p>
</blockquote>
<p>Therefore, we have to do it one by one.</p>
<h2 id="Main-Work"><a href="#Main-Work" class="headerlink" title="Main Work"></a>Main Work</h2><h3 id="Syntax-highlighting"><a href="#Syntax-highlighting" class="headerlink" title="Syntax-highlighting"></a>Syntax-highlighting</h3><p>I found two ways:</p>
<ol>
<li>add config below to <em>settings.json</em> which let <code>vscode</code> highlight it as html.</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="string">"files.associations"</span>: &#123; <span class="string">"*.vue"</span>: <span class="string">"html"</span> &#125;,</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>install <a href="https://marketplace.visualstudio.com/items?itemName=octref.vetur" target="_blank" rel="noopener">Vetur</a> plugin.</li>
</ol>
<p><strong>I would recommend <code>Vetur</code></strong> because</p>
<ul>
<li><a href="https://marketplace.visualstudio.com/items?itemName=sdras.vue-vscode-snippets" target="_blank" rel="noopener">Vue <code>VSCode</code> Snippets</a> and other plugins may depend on it.</li>
<li>Highlight .vue as html won’t get better highlighting effect than <code>Vetur</code>.</li>
<li>Other problems may appear…</li>
</ul>
<!-- ### Work in A Consistent Way(Specific Rules)

- For .js or `script` in .vue, we have [ESLint rules][https://eslint.org/docs/rules/].
- For .css, .less, .scss and `style` in .vue, we have [stylelint rules][https://stylelint.io/user-guide/rules/] with the help of plugins and [prettier][prettier-linters].
- For html and `template` in .vue, we have [htmlhint rules][https://github.com/htmlhint/htmlhint/wiki/rules] with the help of plugins and prettier.

**So, we can make formatters and linters to work in a consistent way with several linters and plugins.** -->

<h3 id="Format-and-Lint-js-script-and-template-in-vue"><a href="#Format-and-Lint-js-script-and-template-in-vue" class="headerlink" title="Format and Lint .js, script and template in .vue."></a>Format and Lint .js, <code>script</code> and <code>template</code> in .vue.</h3><h5 id="Parser"><a href="#Parser" class="headerlink" title="Parser"></a>Parser</h5><p>As <a href="https://github.com/eslint/eslint#what-about-experimental-features">ESLint</a> said,</p>
<blockquote>
<p>ESLint’s parser only officially supports the latest final ECMAScript standard.</p>
</blockquote>
<blockquote>
<p>In other cases (including if rules need to warn on more or fewer cases due to new syntax, rather than just not crashing), we recommend you use other parsers and&#x2F;or rule plugins. If you are using Babel, you can use the babel-eslint parser and eslint-plugin-babel to use any option available in Babel.</p>
</blockquote>
<blockquote>
<p>Once a language feature has been adopted into the ECMAScript standard (stage 4 according to the TC39 process), we will accept issues and pull requests related to the new feature, subject to our contributing guidelines.</p>
</blockquote>
<p>In my case, there is <code>stage2</code> in my <em>.babelrc</em> presets.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">"env"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">"modules"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">"targets"</span>: &#123;</span><br><span class="line">          <span class="attr">"browsers"</span>: [<span class="string">"&gt; 1%"</span>, <span class="string">"last 2 versions"</span>, <span class="string">"not ie &lt;= 8"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"stage-2"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>So, I have to use <code>babel-eslint</code> as parser.</strong></p>
<h5 id="Plugins"><a href="#Plugins" class="headerlink" title="Plugins"></a>Plugins</h5><p>Also, I want to lint <code>script</code> in .vue, obviously I need plugins. According to the doc in <code>eslint-plugin-html</code>,</p>
<blockquote>
<p>Initially, <code>eslint-plugin-vue</code> was using <code>eslint-plugin-html</code> to lint code inside script tags.<br>Since v3, <code>eslint-plugin-vue</code> is using its own parser, so it is incompatible with <code>eslint-plugin-html</code>.<br>You should use <code>eslint-plugin-vue</code> exclusively and remove <code>eslint-plugin-html</code> from your dependencies if you still have it.</p>
</blockquote>
<p>That’s why we still can see some <em>.eslintrc.js</em> like below in old projects.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="comment">// required to lint *.vue files</span></span><br><span class="line">  plugins: [<span class="string">"html"</span>]</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>Also, as documented in <a href="https://vue-loader.vuejs.org/guide/linting.html#eslint" target="_blank" rel="noopener">vue-loader doc</a>,</p>
<blockquote>
<p>The official <code>eslint-plugin-vue</code> supports linting both the <code>template</code> and <code>script</code> parts of Vue single file components.</p>
</blockquote>
<p><strong>So, we can use <code>eslint-plugin-vue</code> to lint .js, <code>script</code> and <code>template</code> in .vue.</strong></p>
<h5 id="Specific-Rules"><a href="#Specific-Rules" class="headerlink" title="Specific Rules"></a>Specific Rules</h5><p>Though there is a lot of rule libs I can choose. For example, <code>eslint:recommended</code>, <code>standard</code>, <code>airbnb</code>, etc. Also, for .vue files, there is <code>plugin:vue/recommended</code>, <code>&quot;plugin:vue/base</code>, etc. However, You might still need to read and check which lib or rules you can accept or want because it is quite common to find that there is some rules you can’t accept in lots of rule libs.</p>
<p><strong>In the end, our configuration might be something like this:</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    parser: <span class="string">"babel-eslint"</span>, <span class="comment">// https://eslint.vuejs.org/user-guide/#usage</span></span><br><span class="line">    sourceType: <span class="string">"module"</span> <span class="comment">// "module" if your code is in ECMAScript modules</span></span><br><span class="line">  &#125;,</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">    es6: <span class="literal">true</span> <span class="comment">// enable ES6 global variables</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="comment">// ...other rule libs</span></span><br><span class="line">    <span class="string">"eslint:recommended"</span>,</span><br><span class="line">    <span class="string">"plugin:vue/essential"</span></span><br><span class="line">    <span class="comment">// ...other rule libs</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// required to lint *.vue files</span></span><br><span class="line">  plugins: [<span class="string">"vue"</span>],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">// add your custom rules here, including .vue and es rules.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Format-and-Lint-css-less-scss-and-style-in-vue"><a href="#Format-and-Lint-css-less-scss-and-style-in-vue" class="headerlink" title="Format and Lint .css, .less, .scss and style in .vue."></a>Format and Lint .css, .less, .scss and <code>style</code> in .vue.</h3><p>As documented in <a href="https://vue-loader.vuejs.org/guide/linting.html#stylelint" target="_blank" rel="noopener">vue-loader doc</a>,</p>
<blockquote>
<p><code>stylelint</code> supports linting style parts of Vue single file components.</p>
</blockquote>
<h3 id="Format-and-lint-html"><a href="#Format-and-lint-html" class="headerlink" title="Format and lint .html."></a>Format and lint <code>.html</code>.</h3><p>There is two cases happen to <code>.html</code>.</p>
<ul>
<li><p>One is vue component file like</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- component.vue --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span> <span class="attr">src</span>=<span class="string">"./template.html"</span>&gt;</span><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">src</span>=<span class="string">"./style.scss"</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./index.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>For this one, <code>eslint-plugin-vue</code> wouldn’t support in the near future and recommend using .vue file. Related <a href="https://github.com/vuejs/eslint-plugin-vue/issues/490">issue1</a>, <a href="https://github.com/mysticatea/vue-eslint-parser/issues/28">issue2</a>.</p>
</li>
<li><p>Another is <em>index.html</em> or <em>public&#x2F;index.html</em></p>
<p>In rare cases, we would need to modify this file. So, we might want to add formatter and linter for this file. Actually,</p>
<ul>
<li><code>stylelint</code> would lint <code>style</code> in it automatically.</li>
<li>While <code>htmlhint</code> would be needed to format and lint <code>html</code> in it.</li>
<li>The only problem is the <code>script</code>. <strong>However, I didn’t add <code>eslint-plugin-html</code> for this file because</strong><ul>
<li>Normally, there shouldn’t be inline script in <em>index.html</em></li>
<li>Inline script has different linting requirements because it would directly run in the browser and not be transformed by <code>babel</code>. So, It has to be written in ES5. If you want to lint the script, you might have to write lots of disable comments in it.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>So, in my project I add <em>.htmlhintrc</em> which is like</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"tagname-lowercase"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"attr-lowercase"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"attr-value-double-quotes"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"attr-value-not-empty"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"attr-no-duplication"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"doctype-first"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"tag-pair"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"empty-tag-not-self-closed"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"spec-char-escape"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"id-unique"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"src-not-empty"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"title-require"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"alt-require"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"doctype-html5"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"id-class-value"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"style-disabled"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"inline-style-disabled"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"space-tab-mixed-disabled"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"attr-unsafe-chars"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>However, <code>prettier</code> doesn’t support <code>htmlhint</code> integration, so make sure that you don’t add stylistic rules in <em>.htmlhintrc</em>. You might not be able to understand previous sentence before finish reading the <code>Prettier</code> part. Don’t worry, keep reading.</p>
<h3 id="Prettier"><a href="#Prettier" class="headerlink" title="Prettier"></a>Prettier</h3><h5 id="Do-We-Need-Prettier"><a href="#Do-We-Need-Prettier" class="headerlink" title="Do We Need Prettier"></a>Do We Need <code>Prettier</code></h5><p>Until now, we can use</p>
<ul>
<li><code>ESLint</code>, <code>eslint-plugin-vue</code> to format and lint .js, <code>script</code> and <code>template</code> in .vue files.</li>
<li><code>stylelint</code> to format and lint .css, .less, .scss files and <code>style</code> in .vue files.</li>
<li><code>htmlhint</code> to format and lint .html.</li>
</ul>
<p>It seems that all formatting and linting job have been done without <code>Prettier</code>. So, here comes a question:</p>
<blockquote>
<p>Do we need <code>Prettier</code>?</p>
</blockquote>
<p>Actually, it’s a good question. Someone just ask <a href="https://github.com/prettier/prettier-eslint/issues/101">here</a>,</p>
<blockquote>
<p>If eslint can auto fix&#x2F;format code why to use <code>Prettier</code>?</p>
</blockquote>
<p>And the answer is something like:</p>
<blockquote>
<p><code>Prettier</code> can do some formatting thing that eslint can’t do and vice versa. So, here comes <code>prettier-eslint</code> which combines them.</p>
</blockquote>
<p>The same thing also happens on stylelint. Until 0.49.0 version, <a href="https://github.com/shinnn/vscode-stylelint">vscode-stylelint</a> still doesn’t support auto fix in editor but <a href="https://github.com/prettier/prettier-vscode">prettier-vscode</a> can.</p>
<p>So, we do need <code>Prettier</code>, also with plugins to combine <code>Prettier</code> with <code>ESLint</code> and <code>stylelint</code>.</p>
<h5 id="Prettier-First-or-Linter-First"><a href="#Prettier-First-or-Linter-First" class="headerlink" title="Prettier First or Linter First?"></a>Prettier First or Linter First?</h5><p>Generally, there are four ways to combine them.</p>
<table>
<thead>
<tr>
<th></th>
<th><code>prettier-eslint</code></th>
<th><code>eslint-config-prettier</code></th>
</tr>
</thead>
<tbody><tr>
<td><code>prettier-stylelint</code></td>
<td>Code ➡️ prettier ➡️ eslint&#x2F;stylelint ➡️ Formatted</td>
<td>Code ➡️ eslint➡️ prettier ➡️ Formatted <br> Code ➡️ prettier ➡️ stylelint ➡️ Formatted</td>
</tr>
<tr>
<td><code>stylelint-config-prettier</code></td>
<td>Code ➡️ prettier ➡️ eslint ➡️ Formatted <br> Code ➡️ stylelint ➡️ prettier ➡️ Formatted</td>
<td>Code ➡️ eslint&#x2F;stylelint ➡️ prettier ➡️ Formatted</td>
</tr>
</tbody></table>
<p>I guess most people chose</p>
<ul>
<li><code>prettier-eslint</code> and <code>prettier-stylelint</code> which is</li>
</ul>
<blockquote>
<p>Code ➡️ prettier ➡️ eslint&#x2F;stylelint –fix ➡️ Formatted Code</p>
</blockquote>
<ul>
<li>or <code>eslint-config-prettier</code> and <code>stylelint-config-prettier</code> which is</li>
</ul>
<blockquote>
<p>Code ➡️ eslint&#x2F;stylelint ➡️ prettier –write ➡️ Formatted Code</p>
</blockquote>
<p>Both of them would work when formatting and linting before commit. The only difference is</p>
<blockquote>
<p>Prettier first or linter first?</p>
</blockquote>
<p><strong>Obviously, the latter would decide the code style.</strong></p>
<p>If you choose <code>prettier-eslint</code> and <code>prettier-stylelint</code>, the pros are</p>
<ul>
<li>you can decide the code style by <em>.eslintrc.js</em> and <em>.stylelintrc.js</em> which provide lots of options.</li>
</ul>
<p>the cons are about the editor plugins.</p>
<ul>
<li><p><code>vscode-stylelint</code> doesn’t support auto fix. You can find the <a href="https://github.com/shinnn/vscode-stylelint/issues/138">issue here</a>.</p>
</li>
<li><p><code>vscode-eslint</code> <strong>can’t fix all at one time</strong> by enable <code>&quot;eslint.autoFixOnSave&quot;: true</code>. You can find the <a href="https://github.com/microsoft/vscode-eslint/issues/154">issue here</a>. You might encounter situations like:</p>
</li>
</ul>
<p><img src="/blog/images/1560605687550.gif"></p>
<p>or even worse like</p>
<p><img src="/blog/images/1560606459359.gif"></p>
<p>If you choose <code>eslint-config-prettier</code> and <code>stylelint-config-prettier</code>, the pros are</p>
<ul>
<li><code>prettier-vscode</code> support auto fix and fix all at one time.</li>
</ul>
<p>the cons are</p>
<ul>
<li>You don’t have too many choices in code style because <code>Prettier</code> only provides a few options for user to choose.</li>
</ul>
<p>Finally, I choose <code>eslint-config-prettier</code> and <code>stylelint-config-prettier</code>.</p>
<p>Actually, these two configs just do one thing:</p>
<blockquote>
<p>Turns off all rules that are unnecessary or might conflict with Prettier.</p>
</blockquote>
<p>So, when you chose this it means that</p>
<blockquote>
<p>let prettier do the formatting job while let eslint and stylelint do the linting job.</p>
</blockquote>
<p>Also, <strong>you shouldn’t add stylistic rules in your <em>.eslintrc.js</em> and <em>.stylelintrc.js</em> files as those rules would overwrite <code>eslint-config-prettier</code> and <code>stylelint-config-prettier</code></strong>. Even though you chose <code>prettier-eslint</code> and <code>prettier-stylelint</code>, you should also avoid adding conflicting stylistic rules between <em>.prettierrc.js</em> and <em>.eslintrc.js</em> or <em>.stylelintrc.js</em>.</p>
<p>In the end, my <em>.prettierrc.js</em></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  semi: <span class="literal">false</span>,</span><br><span class="line">  singleQuote: <span class="literal">true</span>,</span><br><span class="line">  tabWidth: <span class="number">2</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>and <em>.eslintrc.js</em></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// https://eslint.org/docs/user-guide/configuring</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  root: <span class="literal">true</span>,</span><br><span class="line">  parserOptions: &#123;</span><br><span class="line">    <span class="comment">// https://eslint.vuejs.org/user-guide/#usage</span></span><br><span class="line">    parser: <span class="string">"babel-eslint"</span>,</span><br><span class="line">    ecmaVersion: <span class="number">2019</span></span><br><span class="line">  &#125;,</span><br><span class="line">  env: &#123;</span><br><span class="line">    browser: <span class="literal">true</span>,</span><br><span class="line">    node: <span class="literal">true</span>,</span><br><span class="line">    es6: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="comment">// https://github.com/standard/standard/blob/master/docs/RULES-en.md</span></span><br><span class="line">    <span class="string">"standard"</span>,</span><br><span class="line">    <span class="comment">// rules for vue, didn't include any js rules lib like standard or airbnb</span></span><br><span class="line">    <span class="comment">// https://github.com/vuejs/eslint-plugin-vue#priority-a-essential-error-prevention.</span></span><br><span class="line">    <span class="string">"plugin:vue/recommended"</span>,</span><br><span class="line">    <span class="comment">// turn off ESLint default stylistic rules</span></span><br><span class="line">    <span class="comment">// https://github.com/prettier/eslint-config-prettier/blob/master/index.js</span></span><br><span class="line">    <span class="string">"prettier"</span>,</span><br><span class="line">    <span class="comment">// turn off stylistic rules defined in standard</span></span><br><span class="line">    <span class="comment">// https://github.com/prettier/eslint-config-prettier/blob/master/standard.js</span></span><br><span class="line">    <span class="string">"prettier/standard"</span>,</span><br><span class="line">    <span class="comment">// turn off stylistic rules defined in plugin:vue/recommended</span></span><br><span class="line">    <span class="comment">// https://github.com/prettier/eslint-config-prettier/blob/master/vue.js</span></span><br><span class="line">    <span class="string">"prettier/vue"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// required to lint index.html and *.vue files</span></span><br><span class="line">  plugins: [<span class="string">"vue"</span>],</span><br><span class="line">  <span class="comment">// add your custom rules here</span></span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">//! avoid add stylistic rules</span></span><br><span class="line">    <span class="comment">// non stylistic rules which are not in the standard but I need</span></span><br><span class="line">    <span class="string">"no-debugger"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-console"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-extra-semi"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-prototype-builtins"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"require-atomic-updates"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"array-callback-return"</span>: [<span class="string">"error"</span>, &#123; <span class="attr">allowImplicit</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">    <span class="string">"block-scoped-var"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"guard-for-in"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-alert"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-implicit-coercion"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-extra-label"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-eq-null"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-else-return"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-case-declarations"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"vars-on-top"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"require-unicode-regexp"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"require-await"</span>: <span class="string">"error"</span>,</span><br><span class="line">    radix: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"prefer-promise-reject-errors"</span>: [<span class="string">"error"</span>, &#123; <span class="attr">allowEmptyReject</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">    <span class="string">"no-void"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-useless-concat"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-useless-catch"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-script-url"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-return-await"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-undef"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-use-before-define"</span>: [<span class="string">"error"</span>, &#123; <span class="attr">functions</span>: <span class="literal">false</span>, <span class="attr">classes</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">    <span class="string">"no-delete-var"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-label-var"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-restricted-globals"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        name: <span class="string">"event"</span>,</span><br><span class="line">        message: <span class="string">"Use local parameter instead."</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// todo not good enough for confusing let foo=()=&gt;&#123;&#125;</span></span><br><span class="line">    <span class="string">"arrow-body-style"</span>: [<span class="string">"error"</span>, <span class="string">"as-needed"</span>],</span><br><span class="line">    <span class="string">"arrow-parens"</span>: [<span class="string">"error"</span>, <span class="string">"as-needed"</span>],</span><br><span class="line">    <span class="string">"no-confusing-arrow"</span>: [<span class="string">"error"</span>, &#123; <span class="attr">allowParens</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">    <span class="string">"no-var"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"prefer-const"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"prefer-rest-params"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"prefer-spread"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"require-yield"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"symbol-description"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="comment">// eslint-plugin-vue Uncategorized rules</span></span><br><span class="line">    <span class="string">"vue/v-on-function-call"</span>: [<span class="string">"error"</span>, <span class="string">"never"</span>],</span><br><span class="line">    <span class="string">"vue/require-direct-export"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="comment">// 'vue/no-empty-pattern': 'error',</span></span><br><span class="line">    <span class="string">"vue/eqeqeq"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"vue/comma-dangle"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="comment">// disable if too many violations</span></span><br><span class="line">    <span class="string">"vue/component-name-in-template-casing"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      <span class="string">"PascalCase"</span> | <span class="string">"kebab-case"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        registeredComponentsOnly: <span class="literal">true</span>,</span><br><span class="line">        ignores: []</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>and <em>.stylelintrc.js</em></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  extends: [</span><br><span class="line">    <span class="string">"stylelint-config-recommended"</span>,</span><br><span class="line">    <span class="comment">// https://github.com/bjankord/stylelint-config-sass-guidelines</span></span><br><span class="line">    <span class="string">"stylelint-config-sass-guidelines"</span>,</span><br><span class="line">    <span class="string">"stylelint-config-prettier"</span></span><br><span class="line">  ],</span><br><span class="line">  plugins: [<span class="string">"stylelint-color-format"</span>, <span class="string">"stylelint-no-indistinguishable-colors"</span>],</span><br><span class="line">  rules: &#123;</span><br><span class="line">    <span class="comment">//! avoid add stylistic rules</span></span><br><span class="line">    <span class="string">"color-named"</span>: <span class="string">"never"</span>,</span><br><span class="line">    <span class="string">"declaration-no-important"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"selector-max-empty-lines"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"selector-max-id"</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">"selector-max-universal"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="string">"no-unknown-animations"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"selector-class-pattern"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"declaration-property-value-blacklist"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="comment">// todo  reduce to 1 when BEM is determined</span></span><br><span class="line">    <span class="string">"max-nesting-depth"</span>: [</span><br><span class="line">      <span class="number">1</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        ignore: [<span class="string">"pseudo-classes"</span>, <span class="string">"blockless-at-rules"</span>],</span><br><span class="line">        ignoreAtRules: [<span class="string">"each"</span>, <span class="string">"media"</span>, <span class="string">"supports"</span>, <span class="string">"include"</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"scss/at-import-partial-extension-blacklist"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"scss/at-import-partial-extension-whitelist"</span>: [<span class="string">"scss"</span>],</span><br><span class="line">    <span class="string">"scss/dollar-variable-pattern"</span>: <span class="regexp">/--.+/u</span>,</span><br><span class="line">    <span class="string">"scss/partial-no-import"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"scss/double-slash-comment-inline"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"scss/double-slash-comment-empty-line-before"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"scss/selector-nest-combinators"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"scss/dollar-variable-default"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"scss/at-function-pattern"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"scss/at-mixin-pattern"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"scss/at-import-no-partial-leading-underscore"</span>: <span class="literal">null</span>,</span><br><span class="line">    <span class="string">"plugin/stylelint-no-indistinguishable-colors"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"color-format/format"</span>: &#123;</span><br><span class="line">      format: <span class="string">"rgb"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Format-and-Lint-Before-Commit"><a href="#Format-and-Lint-Before-Commit" class="headerlink" title="Format and Lint Before Commit"></a>Format and Lint Before Commit</h3><p>After some research, I found that <a href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" target="_blank" rel="noopener">git hook</a> can help us do this job. We can build it by ourself or use third party tools like <code>husky</code>. In my case, I use <code>husky</code> to add git hook and use <code>lint-staged</code> to run my linters and formatters. So, in my project, I add <em>.huskyrc.js</em>,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  hooks: &#123;</span><br><span class="line">    <span class="string">"pre-commit"</span>: <span class="string">"lint-staged"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>and <em>.lint-staged.config.js</em>,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="string">"*.(js|vue)"</span>: [<span class="string">"eslint --fix --cache"</span>, <span class="string">"prettier --write"</span>, <span class="string">"git add"</span>],</span><br><span class="line">  <span class="string">"*.(vue|htm|html|css|less|sass|scss|styl|stylus|md|js)"</span>: [</span><br><span class="line">    <span class="string">"stylelint --fix --cache"</span>,</span><br><span class="line">    <span class="string">"prettier --write "</span>,</span><br><span class="line">    <span class="string">"git add"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"*.(htm|html)"</span>: [<span class="string">"htmlhint"</span>, <span class="string">"prettier --write"</span>, <span class="string">"git add"</span>]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>It will run <code>eslint/stylelint/htmlhint</code> before commit. If error appears, commit would be blocked until errors have been fixed.</p>
<p>So far, we can ensure the code quality in the repository by <code>eslint</code>, <code>eslint-plugin-vue</code>, <code>stylelint</code>, <code>htmlhint</code>, <code>prettier</code>, <code>husky</code> and <code>lint-staged</code> <strong>with no requirements for user settings</strong>.</p>
<p>Hope svg below can help you organize thoughts.</p>
<p><img src="/blog/images/1560080932098.svg"></p>
<h3 id="Ways-to-Avoid-Linting-Some-Lines"><a href="#Ways-to-Avoid-Linting-Some-Lines" class="headerlink" title="Ways to Avoid Linting Some Lines"></a>Ways to Avoid Linting Some Lines</h3><p>Sometimes, we might need to avoid linting some lines. So, I made a disable list.</p>
<ul>
<li><p><a href="https://eslint.org/docs/user-guide/command-line-interface#--no-inline-config" target="_blank" rel="noopener"><code>eslint</code></a></p>
<p><code>vscode</code> also provides convenience like below,</p>
<p><img src="/blog/images/1560221484774.gif"></p>
</li>
<li><p><code>eslint-plugin-vue</code><br>Find it via this <a href="https://github.com/vuejs/eslint-plugin-vue/issues/260#issuecomment-425179782">issue</a>.</p>
<blockquote>
<p>try <code>&lt;!-- eslint-disable --&gt;</code> this will disable linting for everything below it, you can use <code>&lt;!-- eslint-enable --&gt;</code> to re-enable it back.</p>
</blockquote>
</li>
<li><p><a href="https://stylelint.io/CHANGELOG/" target="_blank" rel="noopener"><code>stylelint</code></a></p>
<p>You can find it in the change log. Also, for convenience you can install a snippet plugin. For example, I use <a href="https://marketplace.visualstudio.com/items?itemName=hedinne.stylelint-disable-snippets" target="_blank" rel="noopener">Stylelint Disable Snippets</a> which works like</p>
<p><img src="/blog/images/1560221484775.gif"></p>
</li>
<li><p><code>htmlhint</code></p>
<p><strong>They haven’t support it yet</strong>. The latest <a href="https://github.com/htmlhint/HTMLHint/issues/161">issue</a>.</p>
</li>
<li><p><code>git</code></p>
<p>In the situation that we need to commit directly and skip the git hook, we can use command like <code>git commit --no-verify -m &quot;your commit message&quot;</code>.</p>
</li>
</ul>
<h3 id="Let-Editor-Consistent-With-Project-Configurations"><a href="#Let-Editor-Consistent-With-Project-Configurations" class="headerlink" title="Let Editor Consistent With Project Configurations"></a>Let Editor Consistent With Project Configurations</h3><p>It is quite common that we want to develop with auto-save, auto-formatter and auto-lint with our editor. In this case, we need to depend on editor’s plugins. According to above configuration. We need</p>
<ul>
<li><code>eslint</code>, <code>stylelint</code> and <code>htmlhint</code> for lint</li>
<li><code>prettier</code> for format.</li>
<li><code>Vetur</code> for the syntax highlighting.</li>
</ul>
<p>After installing these plugins in your editor, we have to combine them in a proper way. For me, the way is</p>
<ol>
<li>Set <code>prettier</code> as default formatter.</li>
<li>Disable <code>vetur</code> formatter.</li>
<li>Disable <code>vetur</code> validation for .vue files and internal validation for .css, .less, .scss, <code>style</code> in .html, .js.</li>
<li>Enable <code>stylelint</code>, <code>eslint</code> and <code>htmlhint</code> validation.</li>
<li>Enable internal <code>script</code> in .html validation because we didn’t add validation for that.</li>
</ol>
<p>And in the user settings, take <code>vscode</code> for example</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"files.autoSave"</span>: <span class="string">"onFocusChange"</span>,</span><br><span class="line">  <span class="comment">// call internal formatter for current file on save.</span></span><br><span class="line">  <span class="attr">"editor.formatOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// set internal formatter as prettier-vscode</span></span><br><span class="line">  <span class="attr">"editor.defaultFormatter"</span>: <span class="string">"esbenp.prettier-vscode"</span>,</span><br><span class="line">  <span class="comment">// default value is ['vue']</span></span><br><span class="line">  <span class="attr">"prettier.disableLanguages"</span>: [<span class="string">""</span>],</span><br><span class="line">  <span class="comment">// show eslint on status bar</span></span><br><span class="line">  <span class="attr">"eslint.alwaysShowStatus"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// some rules like [spaced-comment](https://github.com/prettier/prettier/issues/5755) enable in standard</span></span><br><span class="line">  <span class="comment">// but not disabled in prettier/standard, so need auto fix by eslint.</span></span><br><span class="line">  <span class="attr">"eslint.autoFixOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// enable validation in real time</span></span><br><span class="line">  <span class="attr">"eslint.validate"</span>: [</span><br><span class="line">    <span class="string">"javascript"</span>,</span><br><span class="line">    <span class="string">"javascriptreact"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"language"</span>: <span class="string">"html"</span>,</span><br><span class="line">      <span class="attr">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"language"</span>: <span class="string">"vue"</span>,</span><br><span class="line">      <span class="attr">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// enable validation in real time</span></span><br><span class="line">  <span class="attr">"stylelint.enable"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">"htmlhint.enable"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// disable vetur formatter because formatting job would be done by prettier</span></span><br><span class="line">  <span class="attr">"vetur.format.enable"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">//disable vetur validation because</span></span><br><span class="line">  <span class="comment">// eslint plugin in editor will validate template and script using configuration file in project.</span></span><br><span class="line">  <span class="attr">"vetur.validation.template"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"vetur.validation.script"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// stylelint plugin in editor will validate using configuration file in project.</span></span><br><span class="line">  <span class="attr">"vetur.validation.style"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"html.validate.styles"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"css.validate"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"less.validate"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"scss.validate"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// we didn't validate script in html, so enable default validation</span></span><br><span class="line">  <span class="attr">"html.validate.scripts"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">// disable default validate</span></span><br><span class="line">  <span class="comment">// eslint plugin in editor will validate template and script using configuration file in project.</span></span><br><span class="line">  <span class="attr">"javascript.validate.enable"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// tslint plugin in editor will validate template and script using configuration file in project.</span></span><br><span class="line">  <span class="attr">"typescript.validate.enable"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And I made this image for a better understanding.</p>
<p><img src="/blog/images/vue-project-format-editor-plugin-user-settings.svg"></p>
<h3 id="How-to-Handle-History-Files-with-Current-Formatter-and-Linter"><a href="#How-to-Handle-History-Files-with-Current-Formatter-and-Linter" class="headerlink" title="How to Handle History Files with Current Formatter and Linter?"></a>How to Handle History Files with Current Formatter and Linter?</h3><p>Actually, there are many choices. For example,</p>
<ul>
<li>We can fix all the stylistic errors at one time and add disable comments around the remaining linting errors. After that, each time we commit, it won’t have any effects on the code review.</li>
<li>Or we can fix all the errors one by one though it will need lots of time.</li>
<li>Or you can just leave it there until one day you commit that file. In that case, you might need adding comments each time you commit which would have a little effects on our code review.</li>
<li>…</li>
</ul>
<p>For me, I choose the first one. So,</p>
<ol>
<li>I add these scripts in my <em>package.json</em>.</li>
</ol>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">"lint:es"</span>: <span class="string">"eslint --ext .js,.vue ./ --fix --cache --debug"</span>,</span><br><span class="line">    <span class="attr">"lint:style"</span>: <span class="string">"stylelint \"**/*.&#123;vue,htm,html,css,less,sass,scss,styl,stylus,md,js&#125;\" --fix --cache"</span>,</span><br><span class="line">    <span class="attr">"lint:html"</span>: <span class="string">"htmlhint **/*.&#123;htm,html&#125; --ignore */build/**, */dist/**, */node_modules/**"</span>,</span><br><span class="line">    <span class="attr">"lint"</span>: <span class="string">"exitzero npm run lint:es &amp;&amp; exitzero npm run lint:style &amp;&amp; exitzero npm run lint:html"</span>,</span><br><span class="line">    <span class="attr">"format"</span>: <span class="string">"prettier --write \"**/*.*\""</span>,</span><br><span class="line">    <span class="attr">"lint-format"</span>: <span class="string">"npm run lint &amp;&amp; npm run format"</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>and install related packages by</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i eslint@latest eslint-plugin-vue@latest eslint-config-prettier@latest eslint-plugin-standard@latest eslint-config-standard@latest eslint-loader@latest eslint-plugin-node@latest eslint-plugin-promise@latest eslint-plugin-json@latest -D</span><br><span class="line"></span><br><span class="line">npm i husky@latest lint-staged@latest prettier@latest htmlhint@latest stylelint@latest stylelint-config-prettier@latest stylelint-config-recommended@latest stylelint-config-sass-guidelines@latest stylelint-color-format@latest stylelint-no-indistinguishable-colors@latest exitzero@latest -D</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>Run <code>npm run lint-format</code>.</p>
</li>
<li><p>Check all the formatted and linted files.</p>
<ul>
<li>Add the files which don’t need formatting and linting to the <em>.stylelintignore</em>, <em>.prettierignore</em> or <em>.eslintignore</em>.</li>
<li>Add configuration comments to disable the errors which the linters can’t fix. In this case, you might need <code>eslint-disable-snippets</code> and <code>Stylelint Disable Snippets</code> editor plugin.</li>
</ul>
</li>
<li><p>Commit the modified files by <code>git commit -m &quot;init format and lint&quot;</code>.</p>
</li>
</ol>
<h3 id="Remarks"><a href="#Remarks" class="headerlink" title="Remarks"></a>Remarks</h3><ul>
<li><p><code>prettier</code> doesn’t support <code>stylus</code> until v1.18.2.</p>
</li>
<li><p><code>eslint</code> <a href="https://github.com/Microsoft/vscode-eslint/issues/550">would ignore files whose names start from dot</a>. For example,</p>
<ul>
<li><em>.postcssrc.js</em></li>
<li><em>.prettierrc.js</em></li>
<li><em>.stylelintrc.js</em></li>
<li>…</li>
</ul>
<p>However, <code>prettier</code> would format these files. So, if you want to keep consistent with <code>prettier</code> we can add these files to <em>.eslintignore</em> like</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">!/*.js</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>vue-cli3.0</code> has choice for <code>formatOnSave</code>. However, I don’t recommend because it has multiple cons</p>
<ul>
<li>Project has to run</li>
<li>Consume more time on dev</li>
<li>Equals compulsory which is not friendly</li>
</ul>
</li>
<li><p>Sometimes you need to restart editor after modifying the <em>.prettierrc.js</em> or <em>.eslintrc.js</em>, especially when you modified options like <code>tabWidth</code> etc.</p>
</li>
<li><p>If you have enabled multiple formatters in <code>vscode</code>, you would see <code>Format Document with ...</code> choice when you right click your mouse.</p>
<p><img src="/blog/images/%7B1D5A8060-0A1F-41C2-9BBA-5BF6739CFDAA%7D_20190616142237.jpg"></p>
<p><img src="/blog/images/%7B3B680AB4-B268-4192-BD5A-0DEC72BDCD58%7D_20190616142502.jpg"></p>
<p>The <code>Format Document</code> choice is using your default formatter which is defined by <code>&quot;editor.defaultFormatter&quot;</code>. For example, <code>&quot;editor.defaultFormatter&quot;: &quot;esbenp.prettier-vscode&quot;</code> is using <code>prettier</code> as default formatter.</p>
</li>
<li><p><code>lint-staged</code> has problems with committing partially staged files currently. The related issues are <a href="https://github.com/okonet/lint-staged/issues/62">#62</a>, <a href="https://github.com/okonet/lint-staged/pull/75">#75</a> and <a href="https://hackernoon.com/announcing-lint-staged-with-support-for-partially-staged-files-abc24a40d3ff" target="_blank" rel="noopener">article</a>.</p>
</li>
<li><p>Prettier support vue at <a href="https://github.com/prettier/prettier/releases/tag/1.15.0">v1.15</a>. So to make sure that prettier will work for you, you might need to check if your prettier version is not earlier than <code>v1.15</code>.</p>
</li>
<li><p>This latest vue project format template can be found in my repository <a href="https://github.com/xianshenglu/vue-project-template">vue-project-template</a>.</p>
</li>
<li><p>Actually, this idea was not only for vue but also for other front end projects. Whatever lib we choose, we are always writing style, html and script. All we need to do is to choose different plugins for our project. In this case, we choose, <code>eslint-plugin-vue</code>. In other case, you might need <code>eslint-plugin-react</code>, <code>eslint-plugin-angular</code>, etc.</p>
</li>
</ul>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://github.com/microsoft/vscode-eslint/issues/154">‘Fix all auto-fixable problems’ doesn’t fix as many issues as possible</a></li>
<li><a href="https://stackoverflow.com/questions/44690308/whats-the-difference-between-prettier-eslint-eslint-plugin-prettier-and-eslint" target="_blank" rel="noopener">What’s the difference between prettier-eslint, eslint-plugin-prettier and eslint-config-prettier?</a></li>
<li><a href="https://css-tricks.com/poll-results-popularity-of-css-preprocessors/" target="_blank" rel="noopener">Poll Results: Popularity of CSS Preprocessors</a></li>
<li><a href="http://drops.dagstuhl.de/opus/volltexte/2017/7943/pdf/OASIcs-SLATE-2017-8.pdf" target="_blank" rel="noopener">A Survey on CSS Preprocessors</a></li>
</ul>
<p><strong><a href="https://github.com/xianshenglu/blog/blob/master/source/_posts/make-your-own-vue-project-template-formatter-part.md">Source</a></strong></p>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>codeStyle</tag>
        <tag>ESLint</tag>
        <tag>babel</tag>
        <tag>babel-eslint</tag>
        <tag>eslint-plugin-vue</tag>
        <tag>eslint-config-prettier</tag>
        <tag>stylelint</tag>
        <tag>stylelint-config-recommended</tag>
        <tag>stylelint-config-prettier</tag>
        <tag>htmlhint</tag>
        <tag>prettier</tag>
        <tag>husky</tag>
        <tag>lint-staged</tag>
      </tags>
  </entry>
  <entry>
    <title>Move the Switch of Console to URLSearchParams</title>
    <url>/blog/2018/10/move-the-switch-of-console-to-urlsearchparams/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>It is very common for us to use <code>console.log</code> When we are in a development environment. So, how do you handle this when you are preparing to deploy it to server?</p>
<p>In the past, I chose to delete those debug logs. However, I guess nobody likes doing that and in some place, I really want to keep that.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>One day, I find a better way to handle this. Before the main js code, I add code below:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> urlSearchParams = <span class="keyword">new</span> URLSearchParams(<span class="built_in">window</span>.location.search)</span><br><span class="line"><span class="keyword">let</span> isDebug = urlSearchParams.get(<span class="string">'debug'</span>) === <span class="string">'1'</span></span><br><span class="line"><span class="keyword">if</span> (!isDebug) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>debug</category>
      </categories>
      <tags>
        <tag>console.log</tag>
        <tag>URLSearchParams</tag>
      </tags>
  </entry>
  <entry>
    <title>MS Bug In Flex</title>
    <url>/blog/2018/06/ms-bug-in-flex/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>I met some bug with MS’s flex box.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><ul>
<li><code>min-height</code><br>See code below:</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"par"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child child1"</span>&gt;</span>child1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child child2"</span>&gt;</span>child2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"child child3"</span>&gt;</span>child3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.par</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#eee</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">400px</span>;</span><br><span class="line">  <span class="attribute">min-height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">justify-content</span>: center;</span><br><span class="line">  <span class="attribute">flex-flow</span>: column nowrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* _:-ms-lang(x),</span></span><br><span class="line"><span class="comment">.par &#123;</span></span><br><span class="line"><span class="comment">    height: 200px;</span></span><br><span class="line"><span class="comment">&#125; */</span></span><br><span class="line"><span class="selector-class">.par</span> <span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">1</span> <span class="number">1</span> auto;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child1</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child2</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.child3</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: yellowgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I think the result is pretty clear. As the image below :</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180609161841.png"></p>
<p>However, what I got in <code>IE10</code> and <code>Edge</code> is like :</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180609161934.png"></p>
<p>The problem is quite clear. Property <code>flex</code> doesn’t work in MS when there is only <code>min-height</code>. I think it is a bug so I just fix it by hack. And the hack is the comments in the code above.</p>
<ul>
<li>IE10 <code>flex</code> doesn’t work if flex item is inline element</li>
</ul>
<p>For example:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: flex;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">500px</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">60px</span> auto <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">justify-content</span>: space-between;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"box"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"box__link"</span>&gt;</span>box1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"box__link"</span>&gt;</span>box2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"box__link"</span>&gt;</span>box3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Code above is quite clear. However, in IE10, you will see:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180818144157.png" alt="截图20180818144157"></p>
<p><code>justify-content:space-between</code> doesn’t work. If you add</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.box__link</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It will work. See:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180818144338.png" alt="截图20180818144338"></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>bug</tag>
        <tag>flex</tag>
        <tag>ms</tag>
        <tag>min-height</tag>
        <tag>display</tag>
        <tag>IE</tag>
        <tag>Edge</tag>
      </tags>
  </entry>
  <entry>
    <title>Notes for Developing Mobile Web Page</title>
    <url>/blog/2019/01/notes-for-developing-mobile-web-page/</url>
    <content><![CDATA[<h4 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h4><p>I guess most of you were using <code>rem</code>, <code>vw</code>, <code>viewport</code> etc.</p>
<p>For <code>rem</code> or <code>vw</code>, we always work with the below tag.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>And then we transformed <code>px</code> to <code>rem</code> or <code>vw</code> by plugins. However, some guys prefer using internal scale logic like below:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- if the device-width is 375 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=750, initial-scale=0.5"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>It will also work by changing the <code>width</code> and <code>initial-scale</code> at the same time.</p>
<p>However, in most cases, we can see the <code>meta[name=&quot;viewport&quot;]</code> with more complicated content. For example,</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">  <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>What if we remove the <code>minimum-scale</code>, <code>minimum-scale</code> and <code>user-scalable</code>? The result is:</p>
<ul>
<li><p>If an <code>input</code> was focused on safari, the web page would zoom in. Here is the proof.</p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190201171932.gif"></p>
</li>
<li><p>You will get the scale buttons like below when you touch the page in WeChat 7.0.0, at least in Android.</p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190128134750.png"></p>
</li>
</ul>
<p>And the solution is to add <code>user-scalable=no</code> or <code>minimum-scale=1, minimum-scale=1</code>. But you have to accept a shortcoming:</p>
<ul>
<li><strong>User can’t zoom the page using two fingers, at least in my Android WeChat and Chrome 71.</strong> Though in some browsers user can still zoom like UC, QQ etc.</li>
</ul>
<p>For better compatibility, we may have to use both <code>user-scalable=no</code> and <code>minimum-scale=1, minimum-scale=1</code>. That’s why we always see the code below.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">  <span class="attr">name</span>=<span class="string">"viewport"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=no"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Screen-With-High-Resolution"><a href="#Screen-With-High-Resolution" class="headerlink" title="Screen With High Resolution"></a>Screen With High Resolution</h4><p>Normally, we would use <code>png@2x</code>, <code>png@3x</code> etc to solve the vague problem of images brought by high resolution screen. For example,</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="keyword">@media</span> (<span class="attribute">-webkit-min-device-pixel-ratio:</span> <span class="number">2</span>), (<span class="attribute">min-resolution:</span> <span class="number">192dpi</span>) &#123;</span><br><span class="line">  <span class="selector-class">.example</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'/images/my_image@2x.png'</span>) center center no-repeat;</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">-webkit-min-device-pixel-ratio:</span> <span class="number">3</span>), (<span class="attribute">min-resolution:</span> <span class="number">288dpi</span>) &#123;</span><br><span class="line">  <span class="selector-class">.example</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'/images/my_image@3x.png'</span>) center center no-repeat;</span><br><span class="line">    <span class="attribute">background-size</span>: cover;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>A convenient way to do this is by <a href="https://github.com/strues/retinajs">retinajs</a>. And for icons, I would suggest you use <code>svg</code> if possible.</p>
<h4 id="vh-Is-Always-Calculated-as-If-the-Url-Bar-Is-Hidden"><a href="#vh-Is-Always-Calculated-as-If-the-Url-Bar-Is-Hidden" class="headerlink" title="vh Is Always Calculated as If the Url Bar Is Hidden."></a><code>vh</code> Is Always Calculated as If the Url Bar Is Hidden.</h4><p>In brief, <code>100vh</code> doesn’t equal <code>window.innerHeight</code>. For more, check <a href="https://github.com/xianshenglu/blog/issues/38">issues&#x2F;38</a>.</p>
<h4 id="Consider-the-Pop-Up-Keyboard"><a href="#Consider-the-Pop-Up-Keyboard" class="headerlink" title="Consider the Pop-Up Keyboard"></a>Consider the Pop-Up Keyboard</h4><p>If there is an input or another form element, the keyboard would pop up when the element was focused. For example,</p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20190202174136.jpg"></p>
<p>Is this a bug? Maybe… At least, you have to notice that before deploying. And the best way I think is to consult PM or designer if it’s okay.</p>
<p>In that case, the keyboard would make <code>vh</code> smaller which may ruin the layout using <code>vh</code>.</p>
<h4 id="Link-Highlight-While-It’s-Being-Tapped"><a href="#Link-Highlight-While-It’s-Being-Tapped" class="headerlink" title="Link Highlight While It’s Being Tapped"></a>Link Highlight While It’s Being Tapped</h4><p>In my Android Chrome 71, the highlight would show when I touch the link.</p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20190202173819.jpg"></p>
<p>We can disable it by the code below.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-tap-highlight-color</span>: <span class="built_in">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="attribute">-webkit-tap-highlight-color</span>: transparent; <span class="comment">/* For some Androids */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>I would suggest you disable it because different manufacturers may show different colors</strong>.</p>
<h4 id="img-Without-src-Would-Have-1px-White-border-on-Mobile-Chrome-70"><a href="#img-Without-src-Would-Have-1px-White-border-on-Mobile-Chrome-70" class="headerlink" title="img Without src Would Have 1px White border on Mobile Chrome 70."></a><code>img</code> Without src Would Have 1px White <code>border</code> on Mobile Chrome 70.</h4><p>You may need to add the code below to your <em>reset.css</em> to hide the <code>img</code> without <code>src</code>.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">img</span><span class="selector-pseudo">:not(</span><span class="selector-attr">[src]</span>) &#123;</span><br><span class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Qrcode-in-WeChat"><a href="#Qrcode-in-WeChat" class="headerlink" title="Qrcode in WeChat"></a>Qrcode in WeChat</h4><ul>
<li>Use <code>img</code> Instead of <code>background-image</code>. Otherwise, it won’t work.</li>
<li>Don’t put two qrcodes in one screen. Otherwise, it would only recognize one.</li>
</ul>
<h4 id="Format-detection"><a href="#Format-detection" class="headerlink" title="Format-detection"></a>Format-detection</h4><p>It is said that iOS safari has a default style for telephone numbers, email, etc. As I tested in iPhoneX 11.3, at least for telephone numbers, it does have a default style like below.</p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190201171930.png"></p>
<p>If we want to disable the default style we can use the code below to avoid that.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">  <span class="attr">name</span>=<span class="string">"format-detection"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">content</span>=<span class="string">"telephone=no, email=no, date=no, address=no, url=no"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>If you want to call telephone, send message etc when the element is clicked you can do it by</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"tel:020-11811922"</span>&gt;</span>Call me: 020-11811922<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"sms:10086"</span>&gt;</span>Send me a message: 10086<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="Disable-Select"><a href="#Disable-Select" class="headerlink" title="Disable Select"></a>Disable Select</h4><p>You may want to avoid the situation like below when the user is touching the <strong>text of the element</strong>.</p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20190202173857.jpg"> <img src="/blog/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20190202173902.jpg"></p>
<p>You can use the code below to avoid that.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.example</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-user-select</span>: none;</span><br><span class="line">  <span class="attribute">-moz-user-select</span>: none;</span><br><span class="line">  <span class="attribute">-ms-user-select</span>: none;</span><br><span class="line">  <span class="attribute">user-select</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The user may still hear the tone or feel the vibration, at least in my WeChat 7.0.0. <strong>However, the user can still trigger selection on UC, QQ browser with an extra operation.</strong></p>
<h4 id="Avoid-Popup-Menu-in-Long-Touch-（Not-Compatible）"><a href="#Avoid-Popup-Menu-in-Long-Touch-（Not-Compatible）" class="headerlink" title="Avoid Popup Menu in Long Touch ?（Not Compatible）"></a>Avoid Popup Menu in Long Touch ?（Not Compatible）</h4><p>You may also want to disable popup like below when the user is touching <strong>an image or other stuff</strong></p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20190202173852.jpg"> <img src="/blog/images/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20190202173826.jpg"></p>
<p>In this case, <code>user-select:none</code> is not enough to cover this. You may have to add js code like below.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.addEventListener(<span class="string">'contextmenu'</span>, event =&gt; event.preventDefault())</span><br></pre></td></tr></table></figure>

<p>Our User may still hear the tone or feel the vibration, at least in my Android Chrome 71. <strong>However, in WeChat, QQ and UC browser, it doesn’t work.</strong></p>
<p>and CSS to disable callout in iOS.</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.target</span> &#123;</span><br><span class="line">  <span class="attribute">-webkit-touch-callout</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Use-touchstart-to-Imitate-hover"><a href="#Use-touchstart-to-Imitate-hover" class="headerlink" title="Use touchstart to Imitate hover"></a>Use <code>touchstart</code> to Imitate <code>hover</code></h4><p>As we all know, there is no <code>hover</code> on mobile. If you really want that, you can use <code>touchstart</code> to imitate it.</p>
<h4 id="No-Need-to-Worry-About-the-Scroll-Bar"><a href="#No-Need-to-Worry-About-the-Scroll-Bar" class="headerlink" title="No Need to Worry About the Scroll Bar"></a>No Need to Worry About the Scroll Bar</h4><p>On mobile, the scroll bar would hide automatically when you stop scrolling.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/69"><strong>Source</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://www.w3.org/TR/css-device-adapt-1/#user-scalable" target="_blank" rel="noopener">user-scalable</a></li>
</ul>
]]></content>
      <categories>
        <category>summary</category>
      </categories>
      <tags>
        <tag>mobile</tag>
      </tags>
  </entry>
  <entry>
    <title>Notes for Developing Web Page</title>
    <url>/blog/2019/02/notes-for-developing-web-page/</url>
    <content><![CDATA[<p>Here is the stuff.</p>
<h3 id="Still-Consider-IE"><a href="#Still-Consider-IE" class="headerlink" title="Still Consider IE?"></a>Still Consider IE?</h3><p>If you still need to be compatible with IE browser, the below tag might be needed to render page using EdgeHTML instead of uncertain render engine.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Use-Custom-Font-on-the-Web"><a href="#Use-Custom-Font-on-the-Web" class="headerlink" title="Use Custom Font on the Web?"></a>Use Custom Font on the Web?</h3><p><a href="https://github.com/ecomfe/fontmin/">fontmin</a> will help you. For more information, check <a href="https://github.com/xianshenglu/blog/issues/72">issues&#x2F;72</a>.</p>
<h3 id="Consider-Scroll-Bar"><a href="#Consider-Scroll-Bar" class="headerlink" title="Consider Scroll Bar"></a>Consider Scroll Bar</h3><p>Before we can directly set scroll bar width by <code>::-webkit-scrollbar</code> <strong>for major browsers on PC</strong>, we always need to take care of the toggle of scroll bar because it might affect the layout except in Mac. For example,</p>
<ul>
<li>It is common that we need to use <code>box-sizing: border-box;</code> to include the scroll bar.</li>
<li>Sometimes we even need to get the scroll bar width in js.</li>
</ul>
<p>Anyway, make sure that you have already considered scroll bar before production. For example, the style, the effect of layout, etc.</p>
<h3 id="Mobile-Web-Page"><a href="#Mobile-Web-Page" class="headerlink" title="Mobile Web Page"></a>Mobile Web Page</h3><p>For the mobile web page, we need to do something else and I write a summary <a href="https://github.com/xianshenglu/blog/issues/69">here</a>.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/68"><strong>Source</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>summary</category>
      </categories>
  </entry>
  <entry>
    <title>Override 3rd Party Style</title>
    <url>/blog/2018/10/override-3rd-party-style/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>It is very common to see 3rd party libs in our projects, especially some UI frames. Meanwhile, here comes the problems.</p>
<p>How can we override partial 3rd party style and avoid our style being overridden by 3rd party.</p>
<p>Well, that’s two question.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><h3 id="Override-Partial-3rd-Party-Style"><a href="#Override-Partial-3rd-Party-Style" class="headerlink" title="Override Partial 3rd Party Style"></a>Override Partial 3rd Party Style</h3><ul>
<li><em>lib-override.css</em></li>
</ul>
<p>I think the first thing is to prepare a single file like <em>lib-override.css</em> to do this job whatever choice we make.</p>
<ul>
<li>override ways</li>
</ul>
<p>It’s obvious that <code>!important</code> or <code>#id</code> can help us do this job. However, I wouldn’t suggest you to do that. I would choose to use class selector with namespace to solve this kind of problem. For example,</p>
<p>3rd party code is:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.el-button--primary</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then you can write:</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.app</span> &#123;</span><br><span class="line">  <span class="selector-class">.el-button--primary</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Code above also works to avoid our style being overridden by 3rd party. In some cases, if one class is not enough you may have to add more class as namespace.</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>override.css</tag>
      </tags>
  </entry>
  <entry>
    <title>Problems Met When Using canvas</title>
    <url>/blog/2018/10/problems-met-when-using-canvas/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>Kind of weird when using <code>canvas</code>, but it’s true. Let’s take a look.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><h3 id="canvas-would-lost-accurate-data-when-opacity-isn’t-equal-to-255"><a href="#canvas-would-lost-accurate-data-when-opacity-isn’t-equal-to-255" class="headerlink" title="canvas would lost accurate data when opacity isn’t equal to 255"></a>canvas would lost accurate data when opacity isn’t equal to 255</h3><p>sample code:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'canvas'</span>)</span><br><span class="line"><span class="keyword">let</span> cxt = canvas.getContext(<span class="string">'2d'</span>)</span><br><span class="line"><span class="keyword">let</span> imageData = cxt.getImageData(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> data = imageData.data</span><br><span class="line"></span><br><span class="line">data[<span class="number">0</span>] = <span class="number">200</span></span><br><span class="line">data[<span class="number">1</span>] = <span class="number">100</span></span><br><span class="line">data[<span class="number">2</span>] = <span class="number">50</span></span><br><span class="line">data[<span class="number">3</span>] = <span class="number">25</span></span><br><span class="line"><span class="built_in">console</span>.log(imageData.data) <span class="comment">//[200, 100, 50, 25]</span></span><br><span class="line">cxt.putImageData(imageData, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">let</span> debugImgData = cxt.getImageData(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(debugImgData.data) <span class="comment">//[204, 102, 51, 25]</span></span><br></pre></td></tr></table></figure>

<p><code>imageData.data</code> wouldn’t be equal to <code>debugImgData.data</code> because opacity isn’t equal to 255. If we set opacity to 255. They would be the same.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">data[<span class="number">3</span>] = <span class="number">255</span></span><br></pre></td></tr></table></figure>

<h3 id="imageData-data-is-readonly"><a href="#imageData-data-is-readonly" class="headerlink" title="imageData.data is readonly"></a>imageData.data is readonly</h3><p>You can modify <code>data</code> but you can’t reassign it like <code>imageData.data=[1,22,3,5]</code>. It will fail <strong>silently</strong>.</p>
<h3 id="copy-imageData"><a href="#copy-imageData" class="headerlink" title="copy imageData"></a>copy imageData</h3><p>Because <code>imageData.data</code> is readonly. So, you can’t copy it like code below:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> newImgData = cxt.createImageData(debugImgData)</span><br><span class="line">newImgData.data = debugImgData.data</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'newImgData'</span>, newImgData.data) <span class="comment">//[0,0,0,0]</span></span><br></pre></td></tr></table></figure>

<p>According to mdn, return value of <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/createImageData" target="_blank" rel="noopener">createImageData</a> is</p>
<p><em>A new ImageData object with the specified width and height. The new object is filled with transparent black pixels.</em></p>
<p>which is <code>[0,0,0,0,,,,]</code>. And assignment of <code>newImgData.data = debugImgData.data</code> fail silently. So, if you want to copy <code>imageData</code> the right way is:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> newImgData = cxt.createImageData(debugImgData)</span><br><span class="line">newImgData.data.set(debugImgData.data)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'newImgData'</span>, newImgData.data) <span class="comment">//[200, 100, 50, 255]</span></span><br></pre></td></tr></table></figure>

<p>That is because <code>ImageData.data</code> is a <code>Uint8ClampedArray</code>. So we can find the API of<br><code>Uint8ClampedArray.prototype.set()</code> which stores multiple values in the typed array, reading input values from a specified array.</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://stackoverflow.com/questions/36588722/html-canvas-putimagedata-with-transparency-causes-incorrect-rgb-to-be-saved#" target="_blank" rel="noopener">HTML Canvas putImageData with transparency causes incorrect RGB to be saved</a></li>
</ul>
]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>canvas</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 qrcodejs 生成二维码的几个问题</title>
    <url>/blog/2018/10/problems-met-when-using-qrcodejs/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>产品希望我这边下载页面加个二维码，可以扫描下载 APP，并且希望二维码中有公司的 logo，很合理的需求，不过实现的时候依旧遇到了几个问题，在此记录下。</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>二维码的实现逻辑我当然没有这个时间去研究，直接用的 <a href="https://github.com/davidshimjs/qrcodejs">qrcodejs</a>。官方给的 demo 是最简单的版本，各种各样的需求都是在 issues 里找到的提示，似乎这个库已经很久没有人去维护了，虽然 star 是很多。</p>
<h4 id="官网示例（改编）"><a href="#官网示例（改编）" class="headerlink" title="官网示例（改编）"></a>官网示例（改编）</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrcode"</span> <span class="attr">class</span>=<span class="string">"qrcode"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.qrcode</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid green;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> qrcodeEl = <span class="built_in">document</span>.getElementById(<span class="string">'qrcode'</span>)</span><br><span class="line"><span class="keyword">let</span> qrcode = <span class="keyword">new</span> QRCode(qrcodeEl, &#123;</span><br><span class="line">  text: <span class="string">'https://avatars1.githubusercontent.com/u/23273077'</span>,</span><br><span class="line">  width: <span class="number">128</span>,</span><br><span class="line">  height: <span class="number">128</span>,</span><br><span class="line">  colorDark: <span class="string">'#000000'</span>,</span><br><span class="line">  colorLight: <span class="string">'#ffffff'</span>,</span><br><span class="line">  correctLevel: QRCode.CorrectLevel.H</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>效果如图：</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181003145142.png" alt="截图20181003145142.png"></p>
<h4 id="尺寸控制"><a href="#尺寸控制" class="headerlink" title="尺寸控制"></a>尺寸控制</h4><p>我给官网的示例加上了边框，二维码的尺寸和 js 里的尺寸不一样，这个缺点立马就暴露出来了。</p>
<p>我很可能是想生成的二维码填满传入的 <code>qrcode</code> 元素的，但是这里的 <code>width</code> 不支持 100%，更不支持 <code>vw</code> 这种尺寸单位了。当然，我可以用 <code>qrcode.offsetWidth</code> 来解决这个问题，但是如果 <code>qrcode</code> 的尺寸后期会动态修改的话，那不还是会有问题么。</p>
<p>经 SO 的提示，发现了一个好方案，</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.qrcode</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid green;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.qrcode</span> <span class="selector-tag">canvas</span> + <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就可以了，不过仍然有个不足，<strong>就是二维码有失真。经测试，只有传入的尺寸和 <code>qrcode</code> 的尺寸一样时，才不会失真，所以传入的尺寸还是需要动态计算。</strong>不过，可以试试 svg 的 qrcode 库，svg 不会出现这个问题。</p>
<h4 id="加-logo-的二维码"><a href="#加-logo-的二维码" class="headerlink" title="加 logo 的二维码"></a>加 logo 的二维码</h4><p><a href="https://github.com/davidshimjs/qrcodejs">qrcodejs</a> 并没有提供这个 API，issues 里有人给了 demo，其实就是在原有元素上覆盖一个 logo 就可以了，虽然遮盖了原有二维码的一部分，但是实测并不影响扫描。不过我没有进行大规模测试，<strong>可能会有一定的错误率。</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"qrcode"</span> <span class="attr">class</span>=<span class="string">"qrcode"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"https://avatars1.githubusercontent.com/u/23273077"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">class</span>=<span class="string">"qrcode__logo"</span></span></span><br><span class="line"><span class="tag">  /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.qrcode</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid green;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">15px</span>;</span><br><span class="line">  <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.qrcode</span> <span class="selector-tag">canvas</span> + <span class="selector-tag">img</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.qrcode__logo</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">50px</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">10%</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">margin</span>: auto;</span><br><span class="line">  <span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如图：</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181003164515.png" alt="截图20181003164515.png"></p>
<h4 id="检测二维码的生成"><a href="#检测二维码的生成" class="headerlink" title="检测二维码的生成"></a>检测二维码的生成</h4><p>某些情况下，我需要重用二维码，在这种情况下，我发现，二维码的生成是异步的，譬如：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> qrcodeEl = <span class="built_in">document</span>.getElementById(<span class="string">'qrcode'</span>)</span><br><span class="line"><span class="keyword">let</span> qrcode = <span class="keyword">new</span> QRCode(qrcodeEl, &#123;</span><br><span class="line">  text: <span class="string">'https://avatars1.githubusercontent.com/u/23273077'</span>,</span><br><span class="line">  width: <span class="number">200</span>,</span><br><span class="line">  height: <span class="number">200</span>,</span><br><span class="line">  colorDark: <span class="string">'#000000'</span>,</span><br><span class="line">  colorLight: <span class="string">'#ffffff'</span>,</span><br><span class="line">  correctLevel: QRCode.CorrectLevel.H</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> qrcodeImg = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.qrcode canvas+img'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'qrcodeImg.src'</span>, qrcodeImg.src)</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'qrcodeImg.src'</span>, qrcodeImg.src)</span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p>第一个日志就是空白的，第二个才有 base64。搞笑的是，<a href="https://github.com/davidshimjs/qrcodejs">qrcodejs</a> 也没有给出回调或者通知告诉用户什么时候生成完毕。</p>
<p>这个问题也是在 issues 里找到的提示，关键点在于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserver" target="_blank" rel="noopener">MutationObserver</a>。</p>
<p>这个 API 很少在项目中用，因为不兼容性 ie11-，但是有时在几千行代码里 debug 时会用，尤其是我怀疑中间有代码改了某个元素的属性，确又找不到证据或者找不到哪段代码时，会用这个来监测下。在这里的用法如下：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> qrcodeEl = <span class="built_in">document</span>.getElementById(<span class="string">'qrcode'</span>)</span><br><span class="line"><span class="keyword">let</span> qrcode = <span class="keyword">new</span> QRCode(qrcodeEl, &#123;</span><br><span class="line">  text: <span class="string">'https://avatars1.githubusercontent.com/u/23273077'</span>,</span><br><span class="line">  width: <span class="number">200</span>,</span><br><span class="line">  height: <span class="number">200</span>,</span><br><span class="line">  colorDark: <span class="string">'#000000'</span>,</span><br><span class="line">  colorLight: <span class="string">'#ffffff'</span>,</span><br><span class="line">  correctLevel: QRCode.CorrectLevel.H</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> qrcodeImg = <span class="built_in">document</span>.querySelector(<span class="string">'.qrcode canvas+img'</span>)</span><br><span class="line">listenQrcodeSrc()</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listenQrcodeSrc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> observeConfig = &#123; <span class="attr">attributes</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> observeCb = <span class="function"><span class="keyword">function</span>(<span class="params">mutationsList, observer</span>) </span>&#123;</span><br><span class="line">    mutationsList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">mutation</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        mutation.type.toLowerCase() === <span class="string">'attributes'</span> &amp;&amp;</span><br><span class="line">        mutation.attributeName.toLowerCase() === <span class="string">'src'</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'qrcodeImg src done!'</span>, mutation.target.src)</span><br><span class="line">        observer.disconnect()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> MutationObserver !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> observer = <span class="keyword">new</span> MutationObserver(observeCb)</span><br><span class="line">    observer.observe(qrcodeImg, observeConfig)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="微信中二维码要放在-img-中，不能放在-background-image"><a href="#微信中二维码要放在-img-中，不能放在-background-image" class="headerlink" title="微信中二维码要放在 img 中，不能放在 background-image"></a>微信中二维码要放在 <code>img</code> 中，不能放在 <code>background-image</code></h4><p>2019.1.31 ，微信 7.0.0 亲测</p>
<h4 id="微信中多个二维码在一起识别错误"><a href="#微信中多个二维码在一起识别错误" class="headerlink" title="微信中多个二维码在一起识别错误"></a>微信中多个二维码在一起识别错误</h4><p>这个问题，我也遇到了，根据网友的提示，微信是截屏识别的，所以会出现这种问题。我测试的结果是，左右两个，永远识别的右边的那个。网上有好几种方案：</p>
<ul>
<li>调透明度和层级</li>
</ul>
<p>最初尝试过，结果发现失败，等到成功的时候，透明度已经小于 0.5 了，视觉差异太明显，所以放弃了这个方案。</p>
<ul>
<li>替换二维码</li>
</ul>
<p>最终采取的是这个，这个也有问题，就是用户会看到二维码变化的过程，除非你把多个二维码做得很像。</p>
<p>假设，我们要显示两个二维码，所谓替换二维码，其实也就是在多个 <code>img.src</code> 属性里切换，可以把实际的二维码保存在 <code>data-real-src</code> 属性里，然后在用户 <code>touchstart</code> 事件中，替换另一个 <code>img</code> 的 <code>src</code> 为当前按下的这个，然后在 <code>touchend</code> 事件中再改回来，因为原来的地址都保存在 <code>data-real-src</code> 属性里。</p>
<p>这里就用到了前面提到的检测 <code>src</code> 属性来判断 <code>qrcode</code> 生成完毕，否则一开始直接把 <code>src</code> 属性赋给 <code>data-real-src</code> 属性，就是空白。</p>
<p>示例代码（这里代码跟前面脱节了，dom 是另外的结构，仅作为示例代码）：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//* pubMethods 是类似 jq 的一些 API 的汇总对象</span></span><br><span class="line"><span class="keyword">var</span> qrcodeImgs = pubMethods.$(<span class="string">'.download__qrcode-box canvas+img'</span>)</span><br><span class="line">listenQrcodeSrc()</span><br><span class="line"><span class="keyword">var</span> downloadBox = pubMethods.$(<span class="string">'.download'</span>)[<span class="number">0</span>]</span><br><span class="line">downloadBox.addEventListener(<span class="string">'touchstart'</span>, changeQrcodeSrcToOne)</span><br><span class="line">downloadBox.addEventListener(<span class="string">'touchend'</span>, changeQrcodeSrcBack)</span><br><span class="line">downloadBox.addEventListener(<span class="string">'touchcancel'</span>, changeQrcodeSrcBack)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">listenQrcodeSrc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> observeConfig = &#123; <span class="attr">attributes</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  <span class="keyword">var</span> observeCb = <span class="function"><span class="keyword">function</span>(<span class="params">mutationsList, observer</span>) </span>&#123;</span><br><span class="line">    mutationsList.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">mutation</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        mutation.type.toLowerCase() === <span class="string">'attributes'</span> &amp;&amp;</span><br><span class="line">        mutation.attributeName.toLowerCase() === <span class="string">'src'</span></span><br><span class="line">      ) &#123;</span><br><span class="line">        mutation.target.setAttribute(<span class="string">'data-real-src'</span>, mutation.target.src)</span><br><span class="line">        observer.disconnect()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  qrcodeImgs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> MutationObserver !== <span class="string">'undefined'</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> observer = <span class="keyword">new</span> MutationObserver(observeCb)</span><br><span class="line">      observer.observe(ele, observeConfig)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeQrcodeSrcToOne</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> target = event.target</span><br><span class="line">  <span class="keyword">var</span> getQrcodeBox = pubMethods.closest(</span><br><span class="line">    target,</span><br><span class="line">    <span class="string">'.download__qrcode-box'</span>,</span><br><span class="line">    downloadBox</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">if</span> (getQrcodeBox) &#123;</span><br><span class="line">    <span class="keyword">var</span> targetImg = qrcodeImgs.filter(<span class="function"><span class="keyword">function</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> getQrcodeBox.contains(ele)</span><br><span class="line">    &#125;)[<span class="number">0</span>]</span><br><span class="line">    qrcodeImgs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">      ele.src = targetImg.getAttribute(<span class="string">'data-real-src'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">changeQrcodeSrcBack</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  qrcodeImgs.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">ele</span>) </span>&#123;</span><br><span class="line">    ele.src = ele.getAttribute(<span class="string">'data-real-src'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><p><a href="https://stackoverflow.com/questions/34546241/make-qr-code-full-width" target="_blank" rel="noopener">Make qr code full width</a></p>
</li>
<li><p><a href="https://www.zhihu.com/question/35246592" target="_blank" rel="noopener">微信中有两个挨着二维码长按识别的问题?</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>qrcodejs</tag>
        <tag>wechat</tag>
        <tag>MutationObserver</tag>
      </tags>
  </entry>
  <entry>
    <title>Remnant Shadows When Toggling HD Pictures with Alpha</title>
    <url>/blog/2018/12/remnant-shadows-when-toggling-pictures-with-alpha-in-firefox-and-safari/</url>
    <content><![CDATA[<p>See the demo:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span> <span class="attr">class</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./images/hd3.png"</span> <span class="attr">class</span>=<span class="string">"app__image"</span> <span class="attr">id</span>=<span class="string">"app__image"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"app__button"</span> <span class="attr">id</span>=<span class="string">"app__button"</span>&gt;</span>next image<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> app__button = <span class="built_in">document</span>.getElementById(<span class="string">'app__button'</span>)</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> app__image = <span class="built_in">document</span>.getElementById(<span class="string">'app__image'</span>)</span></span><br><span class="line"><span class="javascript">  app__button.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    app__image.style.visibility = <span class="string">'hidden'</span></span></span><br><span class="line"><span class="javascript">    app__image.src = <span class="string">'./images/hd4.png'</span></span></span><br><span class="line"><span class="javascript">    app__image.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      app__image.style.visibility = <span class="string">'visible'</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>The code is easy. But the images are special.</p>
<ul>
<li>Type is png.</li>
<li>Size is more than 10M.</li>
<li>Alpha channel has been modified.</li>
<li>Both happen on my win7 and Mac 10.13.</li>
</ul>
<p>In this case, when we click the button above, the result in Firefox and Safari would be:</p>
<p><img src="/blog/images/1543630801931.gif"></p>
<p>If you look at it carefully, you would see the remnant shadows of previous image. That is unexpected because I change the <code>src</code> in the <code>onload</code> callback. Also, the same thing would happen in Chrome, though the frequency is much lower. So, how do we solve this?</p>
<h4 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> app__button = <span class="built_in">document</span>.getElementById(<span class="string">'app__button'</span>)</span><br><span class="line"><span class="keyword">let</span> app__image = <span class="built_in">document</span>.getElementById(<span class="string">'app__image'</span>)</span><br><span class="line">app__button.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  app__image.src = <span class="string">'../images/transparent.png'</span></span><br><span class="line">  <span class="keyword">let</span> tempImage = <span class="keyword">new</span> Image()</span><br><span class="line">  tempImage.src = <span class="string">'../images/hd4.png'</span></span><br><span class="line">  tempImage.onload = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// setTimeout(() =&gt; &#123;</span></span><br><span class="line">    <span class="comment">// if you are still worried, you can use setTimeout or requestAnimationFrame to delay</span></span><br><span class="line">    app__image.src = event.target.src</span><br><span class="line">    <span class="comment">// &#125;, 20)</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>See? We change the previous image with a transparent image. A little hack, but it works.</p>
<p>Obviously, there is a little interval between images onload and browsers’ ready to render the latest image, especially in Firefox and Safari. When the browsers’ performance becomes better this problem may not happen again. Anyway, hope we lucky.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/22"><strong>Original Post</strong></a></p>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>performance</tag>
        <tag>image</tag>
      </tags>
  </entry>
  <entry>
    <title>Serval Ways to Force Update in Vue</title>
    <url>/blog/2018/12/serval-ways-to-re-render-in-vue/</url>
    <content><![CDATA[<p>I have to mention this before we go on. As the <a href="https://vuejs.org/v2/guide/components-edge-cases.html#Forcing-an-Update" target="_blank" rel="noopener">doc-Forcing-an-Update</a> says:</p>
<blockquote>
<p>If you find yourself needing to force an update in Vue, in <strong>99.99%</strong> of cases, you’ve made a mistake somewhere.</p>
</blockquote>
<p>When I come back to write a blog, I find it’s totally true. Well, let’s begin. Here is the demo code based on <em><a href="mailto:&#101;&#108;&#101;&#109;&#x65;&#x6e;&#x74;&#x2d;&#117;&#105;&#64;&#50;&#x2e;&#52;&#46;&#49;&#49;" target="_blank" rel="noopener">&#101;&#108;&#101;&#109;&#x65;&#x6e;&#x74;&#x2d;&#117;&#105;&#64;&#50;&#x2e;&#52;&#46;&#49;&#49;</a></em> and <em><a href="mailto:&#118;&#x75;&#x65;&#x40;&#50;&#46;&#53;&#46;&#49;&#55;" target="_blank" rel="noopener">&#118;&#x75;&#x65;&#x40;&#50;&#46;&#53;&#46;&#49;&#55;</a></em>:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-for</span>=<span class="string">"item in items"</span> <span class="attr">:key</span>=<span class="string">"item.id"</span>&gt;</span>&#123;&#123; item.label &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">el-tree</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:data</span>=<span class="string">"items"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">show-checkbox</span></span></span><br><span class="line"><span class="tag">    <span class="attr">node-key</span>=<span class="string">"id"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:default-expanded-keys</span>=<span class="string">"[2, 3]"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">v-if</span>=<span class="string">"isElTreeShow"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:key</span>=<span class="string">"elTreeVersion"</span></span></span><br><span class="line"><span class="tag">  &gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">el-tree</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">"#app"</span>,</span></span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      isElTreeShow: <span class="literal">true</span>,</span></span><br><span class="line">      elTreeVersion: 100,</span><br><span class="line">      items: [</span><br><span class="line">        &#123;</span><br><span class="line">          id: 1,</span><br><span class="line"><span class="javascript">          label: <span class="string">"Level one 1"</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: 2,</span><br><span class="line"><span class="javascript">          label: <span class="string">"Level one 2"</span>,</span></span><br><span class="line">          children: [</span><br><span class="line">            &#123;</span><br><span class="line">              id: 21,</span><br><span class="line"><span class="javascript">              label: <span class="string">"Level two 2-1"</span></span></span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          id: 3,</span><br><span class="line"><span class="javascript">          label: <span class="string">"Level one 3"</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      compare(a, b) &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> a.id - b.id;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      compareReverse(a, b) &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> -<span class="keyword">this</span>.compare(a, b);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Auto-Update-with-Vue’s-Reactivity-System"><a href="#Auto-Update-with-Vue’s-Reactivity-System" class="headerlink" title="Auto Update with Vue’s Reactivity System"></a>Auto Update with Vue’s Reactivity System</h2><p>Go check the doc.</p>
<h2 id="forceUpdate"><a href="#forceUpdate" class="headerlink" title="$forceUpdate"></a>$forceUpdate</h2><p>For example, if someone made a mistake and wrote the code like</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> length = app.items.length;</span><br><span class="line">app.items[length] = &#123; <span class="attr">id</span>: length + <span class="number">1</span>, <span class="attr">label</span>: <span class="string">`Level one <span class="subst">$&#123;length + <span class="number">1</span>&#125;</span>`</span> &#125;;</span><br></pre></td></tr></table></figure>

<p>You will not see the data update because you just add an nonreactive attribute. In this case, you might need <code>app.$forceUpdate()</code>. However, better idea is using code like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> length = app.items.length;</span><br><span class="line">app.items.push(&#123; <span class="attr">id</span>: length + <span class="number">1</span>, <span class="attr">label</span>: <span class="string">`Level one <span class="subst">$&#123;length + <span class="number">1</span>&#125;</span>`</span> &#125;);</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> length = app.items.length;</span><br><span class="line"><span class="keyword">this</span>.$<span class="keyword">set</span>(app.items, length, &#123;</span><br><span class="line">  id: length + <span class="number">1</span>,</span><br><span class="line">  label: <span class="string">`Level one <span class="subst">$&#123;length + <span class="number">1</span>&#125;</span>`</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Reassign"><a href="#Reassign" class="headerlink" title="Reassign"></a>Reassign</h2><p>However, it’s common to use third party components. In this case, it may not be easy to modify the component if we find something not good. For example, if we sort the data using:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.items.reverse();</span><br></pre></td></tr></table></figure>

<p>Here is the result:</p>
<p><img src="/blog/images/1543654707987.gif"></p>
<p>The part above the <code>hr</code> works as expected while the <code>el-tree</code> doesn’t change even you use <code>$forceUpdate</code>. So, in this case, what can we do?</p>
<p>We can make it update by reassigning like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.items = app.items.slice();</span><br></pre></td></tr></table></figure>

<p>Until now, every thing about force update has been solved. I haven’t met problems which can’t be solved by ways above. However, there is some way stronger I have to mention.</p>
<h2 id="v-if-key"><a href="#v-if-key" class="headerlink" title="v-if&#x2F;key"></a>v-if&#x2F;key</h2><p>In some cases, we do need to destroy and rebuild the component. But I didn’t find any API about <code>rebuild</code> except <a href="https://github.com/vuejs/Discussion/issues/356">this issue</a>. Some guys said we can rebuild using <code>v-if=&quot;isElTreeShow&quot;</code>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.isElTreeShow = !app.isElTreeShow;</span><br><span class="line">app.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  app.isElTreeShow = !app.isElTreeShow;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>or a better idea use <code>:key=&quot;elTreeVersion&quot;</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.elTreeVersion++;</span><br></pre></td></tr></table></figure>

<p>See? That’s pretty cool.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/47"><strong>Original Post</strong></a></p>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>key</tag>
      </tags>
  </entry>
  <entry>
    <title>自定义微信分享样式</title>
    <url>/blog/2018/10/set-custom-style-of-share-in-wechat/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>产品希望我们在微信分享出去的链接，有自己的样式，而不是仅仅一个链接。用产品的话来说，你发给客户一个链接，客户敢点么？？？</p>
<p>听着比较有意思，不过也不能说完全没有道理，毕竟各种各样的诈骗大家也是有所耳闻，经确认，产品想要：</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181002175453.png" alt="截图20181002175453.png"></p>
<p>而我们当前分享是：</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181002175558.png" alt="截图20181002175558.png"></p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>总监给我提示说，微信有 js-sdk ，可以在 js 里设置这个样式。</p>
<p>于是，我找到了<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421141115" target="_blank" rel="noopener">微信 JS-SDK 说明文档</a>，基本上就是根据文档走些配置，这个要和产品那边要些账号密码，改些东西之类，根据文档来，没什么好说的。</p>
<p>大体流程如下：</p>
<ol>
<li>步骤一：绑定域名</li>
<li>步骤二：引入 JS 文件</li>
<li>步骤三：通过 config 接口注入权限验证配置</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wx.config(&#123;&#125;) <span class="comment">//传入一些初始化参数</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>步骤四：通过 ready 接口处理成功验证</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wx.ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) <span class="comment">//传入成功回调</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>步骤五：通过 error 接口处理失败验证</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wx.error(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;) <span class="comment">//传入失败回调</span></span><br></pre></td></tr></table></figure>

<p>实际操作的时候，遇到了几点麻烦，这里需要提一下：</p>
<h4 id="测试的时候，注意开启-debug-模式，方便定位问题。"><a href="#测试的时候，注意开启-debug-模式，方便定位问题。" class="headerlink" title="测试的时候，注意开启 debug 模式，方便定位问题。"></a>测试的时候，注意开启 debug 模式，方便定位问题。</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wx.config(&#123; <span class="attr">debug</span>: <span class="literal">true</span> <span class="comment">/*其他参数*/</span> &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="出于安全考虑，开发者必须在服务器端实现签名的逻辑。"><a href="#出于安全考虑，开发者必须在服务器端实现签名的逻辑。" class="headerlink" title="出于安全考虑，开发者必须在服务器端实现签名的逻辑。"></a>出于安全考虑，开发者必须在服务器端实现签名的逻辑。</h4><p>这个是文档说的，反正就是给后台处理了，最终前端初始化需要的几个字段，除了 <code>debug</code> 和 <code>jsApiList</code> ，都是从后台拿的。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">wx.config(&#123;</span><br><span class="line">    debug: <span class="literal">true</span>, <span class="comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</span></span><br><span class="line">    appId: <span class="string">''</span>, <span class="comment">// 必填，公众号的唯一标识</span></span><br><span class="line">    timestamp: , <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">    nonceStr: <span class="string">''</span>, <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">    signature: <span class="string">''</span>,<span class="comment">// 必填，签名</span></span><br><span class="line">    jsApiList: [] <span class="comment">// 必填，需要使用的JS接口列表</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>后台在实现的时候，可能需要注意文档提示的两点：</p>
<ol>
<li><p>access_token（有效期 7200 秒，开发者必须在自己的服务全局缓存 access_token）</p>
</li>
<li><p>jsapi_ticket（有效期 7200 秒，开发者必须在自己的服务全局缓存 jsapi_ticket）</p>
</li>
</ol>
<p>因为这会导致一开始生成的签名没错，但是两个小时后就失效了。</p>
<h4 id="代码逻辑"><a href="#代码逻辑" class="headerlink" title="代码逻辑"></a>代码逻辑</h4><p>通常的逻辑都是前端从后台拿到上面的几个字段，在前端完成初始化，然后添加初始化成功和失败的回调。</p>
<p>示例：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> link = location.href</span><br><span class="line">$.ajax(&#123;</span><br><span class="line">  url: <span class="string">'your_url'</span>, <span class="comment">//后台给你提供的接口</span></span><br><span class="line">  type: <span class="string">'GET'</span>,</span><br><span class="line">  data: &#123; <span class="attr">url</span>: link &#125;,</span><br><span class="line">  <span class="keyword">async</span>: <span class="literal">true</span>,</span><br><span class="line">  dataType: <span class="string">'json'</span>,</span><br><span class="line">  success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    wx.config(&#123;</span><br><span class="line">      debug: <span class="literal">false</span>, <span class="comment">// 开启调试模式,调用的所有api的返回值会在客户端alert出来</span></span><br><span class="line">      appId: data.configMap.appId, <span class="comment">// 必填，公众号的唯一标识</span></span><br><span class="line">      timestamp: data.configMap.timestamp, <span class="comment">// 必填，生成签名的时间戳</span></span><br><span class="line">      nonceStr: data.configMap.nonceStr, <span class="comment">// 必填，生成签名的随机串</span></span><br><span class="line">      signature: data.configMap.signature, <span class="comment">// 必填，签名，见附录1</span></span><br><span class="line">      jsApiList: [<span class="string">'onMenuShareTimeline'</span>, <span class="string">'onMenuShareAppMessage'</span>] <span class="comment">// 必填，需要使用的JS接口列表，所有JS接口列表见附录2</span></span><br><span class="line">    &#125;)</span><br><span class="line">    wx.ready(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">      wx.onMenuShareAppMessage(&#123;</span><br><span class="line">        title: <span class="built_in">document</span>.title,</span><br><span class="line">        desc: <span class="built_in">document</span>.title,</span><br><span class="line">        link: link,</span><br><span class="line">        imgUrl: Imgurl,</span><br><span class="line">        trigger: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;,</span><br><span class="line">        cancel: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;,</span><br><span class="line">        fail: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      wx.onMenuShareTimeline(&#123;</span><br><span class="line">        title: <span class="built_in">document</span>.title,</span><br><span class="line">        link: link,</span><br><span class="line">        imgUrl: Imgurl,</span><br><span class="line">        trigger: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;,</span><br><span class="line">        cancel: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;,</span><br><span class="line">        fail: <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    wx.error(<span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">      alert(res)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  error: <span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">    alert(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>我司稍微特殊些，直接把初始化的代码放在前面需要引入微信的 js 文件后面了，所以我直接引入这个文件就完成了初始化操作。不过，我还是需要在引入后监听初始化成功和失败的回调。</p>
<p>我司代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./js/shareInWeChat.js?debug=1"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 里面包含了 wx.config(&#123;&#125;) 的代码--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 通过 debug 参数来切换调试模式  --&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">setWeChatShareStyle(product, imgUrl)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setWeChatShareStyle</span>(<span class="params">product, imgUrl</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> success = <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> fail = <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> desc =</span><br><span class="line">    product.description &amp;&amp; product.description !== <span class="string">''</span></span><br><span class="line">      ? product.description</span><br><span class="line">      : <span class="string">'后备描述'</span></span><br><span class="line">  wx.ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> eventConf = &#123;</span><br><span class="line">      title: product.name,</span><br><span class="line">      desc: desc,</span><br><span class="line">      imgUrl: imgUrl,</span><br><span class="line">      link: <span class="built_in">window</span>.location.href,</span><br><span class="line">      success: success</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pubMethods.isAndroid()) &#123;</span><br><span class="line">      <span class="comment">// 安卓适用于老接口，新接口不行</span></span><br><span class="line">      wx.onMenuShareAppMessage(eventConf)</span><br><span class="line">      wx.onMenuShareTimeline(eventConf)</span><br><span class="line">      wx.onMenuShareQQ(eventConf)</span><br><span class="line">      wx.onMenuShareQZone(eventConf)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pubMethods.isIOS()) &#123;</span><br><span class="line">      <span class="comment">// iOS 适用于新接口，老接口不行</span></span><br><span class="line">      wx.updateAppMessageShareData(eventConf, success)</span><br><span class="line">      wx.updateTimelineShareData(eventConf, success)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  wx.error(fail)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最初我担心，这样可能会监听不到 <code>wx.config</code> 初始化的结果，结果发现还是可以监听到的，说明 <code>wx.config</code> 里面的操作是个异步操作。</p>
<h4 id="代码兼容性"><a href="#代码兼容性" class="headerlink" title="代码兼容性"></a>代码兼容性</h4><ul>
<li>统一传参</li>
</ul>
<p>如上面代码所示，虽然根据微信的文档，对于不同的接口，传的参数稍有区别，但是我为了方便，都放在 <code>eventConf</code> 里面了，事实证明也是可以的（不可以我就要吐槽了，毕竟传入的是对象）。</p>
<ul>
<li>接口更新的 bug</li>
</ul>
<p>虽然微信文档上有接口更新的说明：</p>
<p><em>请注意，原有的 wx.onMenuShareTimeline、wx.onMenuShareAppMessage、wx.onMenuShareQQ、wx.onMenuShareQZone 接口，即将废弃。请尽快迁移使用客户端 6.7.2 及 JSSDK 1.4.0 以上版本支持的 wx.updateAppMessageShareData、updateTimelineShareData 接口。</em></p>
<p>但我实际上测试的结果是，安卓不支持新接口，iOS 支持，但是我如果把新老接口全用上，有一端会失败，所以最终才有上面那个机型判断的结果，对于不同的机型采用了不同的接口。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (pubMethods.isAndroid()) &#123;</span><br><span class="line">  <span class="comment">// 安卓适用于老接口，新接口不行</span></span><br><span class="line">  wx.onMenuShareAppMessage(eventConf)</span><br><span class="line">  wx.onMenuShareTimeline(eventConf)</span><br><span class="line">  wx.onMenuShareQQ(eventConf)</span><br><span class="line">  wx.onMenuShareQZone(eventConf)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (pubMethods.isIOS()) &#123;</span><br><span class="line">  <span class="comment">// iOS 适用于新接口，老接口不行</span></span><br><span class="line">  wx.updateAppMessageShareData(eventConf, success)</span><br><span class="line">  wx.updateTimelineShareData(eventConf, success)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>分享的图片不能是 base64</li>
</ul>
<p>由于我司需要对图片进行处理再去分享，所以当我用 <code>canvas</code> 导出 <code>base64</code> 作为 <code>imgUrl</code> 的时候，我发现是没有效果的。</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><p><a href="https://segmentfault.com/a/1190000013491531" target="_blank" rel="noopener">微信分享自定义样式</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/lxlin/p/6829893.html#undefined" target="_blank" rel="noopener">微信分享图标设置，以及 wx.config 配置</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>wechat</tag>
        <tag>share</tag>
        <tag>qq</tag>
      </tags>
  </entry>
  <entry>
    <title>settings in vscode</title>
    <url>/blog/2018/09/settings-in-vscode/</url>
    <content><![CDATA[<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol>
<li>vscode 支持特定语言的设置，比如，为不同的语言设置不同的配置：</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"[html]"</span>: &#123;</span><br><span class="line">    <span class="string">"editor.tabSize"</span>: <span class="number">4</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"[css]"</span>: &#123;</span><br><span class="line">    <span class="string">"editor.tabSize"</span>: <span class="number">4</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"[javascript]"</span>: &#123;</span><br><span class="line">    <span class="string">"editor.insertSpaces"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"editor.tabSize"</span>: <span class="number">2</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"[typescript]"</span>: &#123;</span><br><span class="line">    <span class="string">"editor.tabSize"</span>: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>个别插件的配置比较特殊，需要配置后才能正常使用，譬如 csscomb, eslint, Easy LESS 等，注意查看文档。</p>
</li>
<li><p>我的配置文件，借助 Settings Sync VSCode 插件，不定期修改会同步到 <a href="https://gist.github.com/xianshenglu" target="_blank" rel="noopener">https://gist.github.com/xianshenglu</a></p>
</li>
</ol>
<h2 id="相关插件"><a href="#相关插件" class="headerlink" title="相关插件"></a>相关插件</h2><h4 id="HTML："><a href="#HTML：" class="headerlink" title="HTML："></a>HTML：</h4><p>Auto Rename Tag 修改 HTML 标签时，自动修改匹配的标签</p>
<p>Open in Browser</p>
<p>HTML CSS Class Completion: CSS class 提示</p>
<p>HTMLHint: HTML 格式提示</p>
<h4 id="CSS："><a href="#CSS：" class="headerlink" title="CSS："></a>CSS：</h4><p>Can I Use: HTML5、CSS3、SVG 的浏览器兼容性检查</p>
<p>Color Highlight: 颜色值在代码中高亮显示</p>
<p>Color Picker: 拾色器</p>
<p>csscomb: css 排序，格式化，支持 .vue，<strong>但对于嵌入式样式缩进有问题</strong></p>
<p>HTML CSS Support: css 提示，支持 .vue</p>
<h4 id="JS"><a href="#JS" class="headerlink" title="JS"></a>JS</h4><p>ESLint: ESLint 语法校验，自动格式化，修改等</p>
<p>Version Lens package.json: 文件显示模块当前版本和最新版本</p>
<p>View Node Package: 快速打开选中模块的主页和代码仓库</p>
<p>JavaScript (ES6) code snippets: ES6 语法代码段</p>
<p>Version Lens: 在 package.json 里显示包最新版本号</p>
<h4 id="HTML-CSS-JS"><a href="#HTML-CSS-JS" class="headerlink" title="HTML&#x2F;CSS&#x2F;JS"></a>HTML&#x2F;CSS&#x2F;JS</h4><p>Emmet: html,css,js 提示</p>
<h4 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h4><p>vetur: 目前比较好的 Vue 语法高亮</p>
<p>VueHelper: Vue2 代码段（包括 Vue2 api、vue-router2、vuex2）</p>
<p>vue-peek: vue 文件内查找速览声明</p>
<p>vue-format: vue 格式化插件</p>
<h4 id="非语言类"><a href="#非语言类" class="headerlink" title="非语言类"></a>非语言类</h4><p>Bracket Pair Colorizer: 不同层级括号上色</p>
<p>Code Spelling Checker: 单词拼写检查</p>
<p>Output Colorizer: 彩色输出信息</p>
<p>Partial Diff: 对比两段代码或文件</p>
<p>Path Autocomplete: 路径补全</p>
<p>Path Intellisense: 路径提示</p>
<p>Project Manager: 快速切换项目</p>
<p>Settings Sync VSCode: 设置同步到 Gist</p>
]]></content>
      <categories>
        <category>software</category>
      </categories>
      <tags>
        <tag>--vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>Several Ways of Configuring Environment Variables in Web FrontEnd Project</title>
    <url>/blog/2023/08/several-ways-of-configuring-environment-variables-in-web-frontend-project/</url>
    <content><![CDATA[<p>It’s quite often that we need to define and use environment variables. May be in building process or runtime. There’re many solutions, I’ll show some of them.</p>
<h2 id="Production-CI-build-phase"><a href="#Production-CI-build-phase" class="headerlink" title="Production &#x2F; CI build phase"></a>Production &#x2F; CI build phase</h2><p><strong>Basically, we don’t need to care about them, just follow the rules provided by the platform because the env variables are often set manually in the platform.</strong> For example, in the <a href="https://vercel.com/" target="_blank" rel="noopener">vercel</a></p>
<p><img src="https://github.com/xianshenglu/blog/assets/23273077/8b142955-c0b2-439b-9e47-f1d374b5b153"></p>
<p>So, they will not appear in our projects’ code. </p>
<h2 id="Development-phase"><a href="#Development-phase" class="headerlink" title="Development phase"></a>Development phase</h2><p><strong>If the framework you’re currently using has provided such configurations, normally we don’t need to care also, just follow the rules provided by the platform.</strong></p>
<p>If not, we can consider some available solutions in the market.</p>
<h4 id="dotnet"><a href="#dotnet" class="headerlink" title="dotnet"></a><a href="https://github.com/motdotla/dotenv">dotnet</a></h4><p>Just put <code>.env</code> file in the root of your project:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">S3_BUCKET=<span class="string">"my bucket"</span></span><br><span class="line">SECRET_KEY=<span class="string">"my secret key"</span></span><br></pre></td></tr></table></figure>

<p>Then as early as possible in your application, import and configure <code>dotenv</code>:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">'dotenv'</span>).config()</span><br><span class="line"><span class="built_in">console</span>.log(process.env) <span class="comment">// remove this after you've confirmed it is working</span></span><br></pre></td></tr></table></figure>

<p>If you don’t want to add the <code>require</code> code to the source code, you can </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node -r dotenv/config your_script.js</span><br></pre></td></tr></table></figure>

<p>It works now.</p>
<p>Also, for the reason of security or interruptions between team members’ different configurations, I recommend putting <code>.env</code> file in the <code>.gitignore</code>. </p>
<p>For better instruction for the new developers, you can add another <code>.env.example</code> file not in the <code>.gitignore</code> with content like</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># You need to create a .env file in the root with the below env variables to run this project.</span></span><br><span class="line">S3_BUCKET=<span class="string">"your bucket"</span></span><br><span class="line">SECRET_KEY=<span class="string">"your secret key"</span></span><br></pre></td></tr></table></figure>

<h4 id="cross-env"><a href="#cross-env" class="headerlink" title="cross-env"></a><a href="https://github.com/kentcdodds/cross-env">cross-env</a></h4><p>In the past, we had another popular package <code>cross-env</code>. But now, it has been archived.</p>
<p>I think it’s really straightforward for new users.</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"cross-env S3_BUCKET=\"my bucket\" npm run start"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Just with some issues:</p>
<ul>
<li>It’ll become unfriendly if I have many env variables.</li>
<li>I need to remove the variables before committing if I don’t want to share them with others.</li>
</ul>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>For me, I would prefer <code>dotenv</code> at this moment.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/148"><strong>Issue</strong></a></p>
<p><a href="https://github.com/xianshenglu/blog/blob/master/source/_posts/.md"><strong>Source</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>env</tag>
        <tag>dotenv</tag>
        <tag>cross-env</tag>
      </tags>
  </entry>
  <entry>
    <title>Skills on Mobile Development</title>
    <url>/blog/2018/07/skills-on-mobile-development/</url>
    <content><![CDATA[<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><h3 id="Access-localhost-on-Mobile"><a href="#Access-localhost-on-Mobile" class="headerlink" title="Access localhost on Mobile"></a>Access localhost on Mobile</h3><p>As you know, If I am working with url like <code>http://localhost:8080</code> It doesn’t work on mobile. So, I have to try another way. After some research, I find something related:</p>
<ul>
<li><code>localhost</code> is a hostname which points to <code>127.0.0.1</code> by default and also can be changed.</li>
</ul>
<p>Normally, <strong>we are using the same WIFI on our computer and mobile.</strong> So, in my case,</p>
<ul>
<li>I use command <code>ipconfig</code> and got the ip <code>192.168.x.x</code>.</li>
<li>I add <code>--host 192.168.x.x</code> in my <em>package.json</em> scripts like this:</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"webpack-boilerplate"</span>,</span><br><span class="line">  <span class="string">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="string">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="string">"main"</span>: <span class="string">"app.js"</span>,</span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"npm run lint &amp;&amp; webpack --config webpack.config.js -p"</span>,</span><br><span class="line">    <span class="string">"dev"</span>: <span class="string">"npm run lint &amp;&amp; webpack-dev-server --config webpack.dev.config.js --inline --host 192.168.x.x"</span>,</span><br><span class="line">    <span class="string">"lint"</span>: <span class="string">"./node_modules/.bin/eslint js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>If you aren’t using <em>package.json</em>, you can directly replace <code>localhost</code> to <code>192.168.x.x</code> in the url.</li>
<li>Then I open the url <code>http://192.168.x.x:8080</code> on my computer and mobile. Both work!</li>
</ul>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="http://yujiangshui.com/multidevice-frontend-debug/" target="_blank" rel="noopener">移动端前端开发调试</a></li>
</ul>
]]></content>
      <categories>
        <category>debug</category>
      </categories>
      <tags>
        <tag>mobile</tag>
        <tag>webpack</tag>
      </tags>
  </entry>
  <entry>
    <title>前端大文件分拆上传与上传池管理</title>
    <url>/blog/2018/08/split-file-and-upload-in-frontend/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>后台管理项目有个上传组件，本来大家通过这个组件上传好好的，后来好像是腾讯云那边做了限制，这边上传 zip 包超过 50M 就会返回 413，所以总监让我对文件进行拆分，分块上传，然后他后台那边进行合并处理。</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>咋一看，好像蛮简单，就是拆分下文件，根据文件份数发 n 个请求就可以了，所以搜索了下，示例代码大概是这样：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">```<span class="selector-tag">js</span></span><br></pre></td></tr></table></figure>

<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>Blob</tag>
        <tag>Chinese</tag>
      </tags>
  </entry>
  <entry>
    <title>TCP Connection Reuse on HTTP/1.1 and 2.0</title>
    <url>/blog/2019/04/tcp-connection-reuse-in-http-1-1-and-2-0/</url>
    <content><![CDATA[<p>I saw the introduction of http&#x2F;2.0 in <a href="https://developers.google.com/web/fundamentals/performance/http2/#request_and_response_multiplexing" target="_blank" rel="noopener">developers.google.com</a>. However, I feel confused about the request and response multiplexing. So I decided to make a demo or an example for better understanding.</p>
<h2 id="TCP-Connection-Reuse"><a href="#TCP-Connection-Reuse" class="headerlink" title="TCP Connection Reuse"></a>TCP Connection Reuse</h2><p>When I saw the TCP connection reuse, I had a lot of questions in my head. For instances,</p>
<ul>
<li>how do I know if the TCP was reused?</li>
<li>What would the network be if the TCP wasn’t reused?</li>
<li>It seems that HTTP 1.1 also supports TCP connection reuse. So, what’s the difference?</li>
<li>….</li>
</ul>
<p>After searching, I found that there is a <strong>Connection ID</strong> column in the chrome dev tool <strong>Network</strong> panel. For example, here is the network image of <strong>baidu.com</strong> :</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20190427204954.png" alt="image"></p>
<p>According to this <a href="https://stackoverflow.com/questions/34184994/chrome-developer-tools-connection-id/43520092#43520092" target="_blank" rel="noopener">question</a></p>
<blockquote>
<p>The new Connection ID Network Panel column in Canary can help indicate to you that a TCP connection was reused instead of handshaking and establishing a new one.</p>
</blockquote>
<p>Combined with the above image, we can say that in the network panel of <strong>baidu.com</strong></p>
<ul>
<li>Requests to <strong>ss1.bdstatic.com</strong> are based on H2 (http&#x2F;2.0.) and share the same TCP connection because there is only one connection ID.</li>
<li>Requests to <strong><a href="http://www.baidu.com/" target="_blank" rel="noopener">www.baidu.com</a></strong> are based on http&#x2F;1.1 and 6 requests share two TCP connections because there are two connection IDs.</li>
</ul>
<p>It seems http&#x2F;1.1 also support TCP connection Reuse. So, how can I prove the advantages of H2 or what’s the difference between the connection reuse of http&#x2F;1.1 and 2.0? That confused me in the past.</p>
<h2 id="Prove-The-Advantages-of-H2"><a href="#Prove-The-Advantages-of-H2" class="headerlink" title="Prove The Advantages of H2"></a>Prove The Advantages of H2</h2><p>I pick two requests from the network record and then fetch it at the console. The code of requests to http&#x2F;1.1 is:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>(<span class="number">13</span>)</span><br><span class="line">  .fill()</span><br><span class="line">  .forEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fetch(<span class="string">'https://www.baidu.com/favicon.ico'</span>, &#123;</span><br><span class="line">      credentials: <span class="string">'omit'</span>,</span><br><span class="line">      referrer: <span class="string">'https://www.baidu.com/'</span>,</span><br><span class="line">      referrerPolicy: <span class="string">'unsafe-url'</span>,</span><br><span class="line">      body: <span class="literal">null</span>,</span><br><span class="line">      method: <span class="string">'GET'</span>,</span><br><span class="line">      mode: <span class="string">'cors'</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>And the code of requests to http&#x2F;2.0 is:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Array</span>(<span class="number">13</span>)</span><br><span class="line">  .fill()</span><br><span class="line">  .forEach(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    fetch(</span><br><span class="line">      <span class="string">'https://ss3.baidu.com/6ONWsjip0QIZ8tyhnq/ps_default.gif?_t=1556369856347'</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        credentials: <span class="string">'omit'</span>,</span><br><span class="line">        referrer: <span class="string">'https://www.baidu.com/'</span>,</span><br><span class="line">        referrerPolicy: <span class="string">'unsafe-url'</span>,</span><br><span class="line">        body: <span class="literal">null</span>,</span><br><span class="line">        method: <span class="string">'GET'</span>,</span><br><span class="line">        mode: <span class="string">'cors'</span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>Here are the results:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20190428205446.png"></p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20190427210224.png"></p>
<p>Take a closer look at the pictures, we can find that</p>
<ul>
<li>On http&#x2F;1.1 connections, chrome would open up to 6 TCP connections per host and reuse the connections. While on http&#x2F;2.0 connections, chrome would open <strong>only one</strong> TCP connection per host on http&#x2F;2.0 connections.</li>
<li>Also, on http&#x2F;1.1 connections chrome would send the requests <strong>one by one</strong> when the requests are using the same TCP connection. Just as the <a href="https://developers.google.com/web/tools/chrome-devtools/network/understanding-resource-timing" target="_blank" rel="noopener">developers.google.com</a> said:</li>
</ul>
<blockquote>
<p>On HTTP 1.0&#x2F;1.1 connections, Chrome enforces a maximum of six TCP connections per host. If you are requesting twelve items at once, the first six will begin and the last half will be queued. Once one of the original half is finished, the first item in the queue will begin its request process.</p>
</blockquote>
<p>This would bring more delay when sending more requests.</p>
<ul>
<li>While on http&#x2F;2 connections, chrome would send all the requests to the same origin simultaneously without delay.</li>
</ul>
<h2 id="Differences-of-TCP-Connection-Reuse-between-HTTP-1-1-and-2-0"><a href="#Differences-of-TCP-Connection-Reuse-between-HTTP-1-1-and-2-0" class="headerlink" title="Differences of TCP Connection Reuse between HTTP&#x2F;1.1 and 2.0"></a>Differences of TCP Connection Reuse between HTTP&#x2F;1.1 and 2.0</h2><p>On http&#x2F;1.1 connections, chrome would reuse TCP connection by default and you can find</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Connection: keep-alive</span><br></pre></td></tr></table></figure>

<p>in the response headers. But according to <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Connection_management_in_HTTP_1.x" target="_blank" rel="noopener">docs in mdn</a></p>
<blockquote>
<p>This connection will not stay open forever: idle connections are closed after some time (a server may use the Keep-Alive header to specify a minimum time the connection should be kept open).</p>
</blockquote>
<p>And for http&#x2F;2.0, according to <a href="https://developers.google.com/web/fundamentals/performance/http2/#one_connection_per_origin" target="_blank" rel="noopener">developers.google.com</a></p>
<blockquote>
<p>all HTTP&#x2F;2 connections are persistent, and only one connection per origin is required, which offers numerous performance benefits.</p>
</blockquote>
<p><a href="https://github.com/xianshenglu/blog/issues/85"><strong>Source</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>http</category>
      </categories>
      <tags>
        <tag>TCP</tag>
        <tag>http/1.1</tag>
        <tag>http/2.0</tag>
      </tags>
  </entry>
  <entry>
    <title>The Impact of Styles and Scripts Position in index.html</title>
    <url>/blog/2020/03/the-impact-of-styles-and-scripts-position-in-index.html/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>For a long time, I was thinking if the <em>.css</em> files would block DOM parsing and rendering. It seems I got different results sometimes. So, I decided to test and summarize the behaviors carefully with chrome.</p>
<p>Let’s begin.</p>
<h3 id="Put-css-Files-in-the"><a href="#Put-css-Files-in-the" class="headerlink" title="Put .css Files in the &lt;head&gt;"></a>Put <em>.css</em> Files in the <code>&lt;head&gt;</code></h3><p>Normally, we would put the <em>.css</em> files in the head and <em>.js</em> files at the bottom of <code>&lt;body&gt;</code>. For example,</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/header.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/main.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>MyApp<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      Header</span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      Main</span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span>Footer<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./static/app.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Say we blocked the <em>.css</em> files request by fiddler. And here are the questions,</p>
<ul>
<li>Would <em>header.css</em> block DOM parsing and rendering?</li>
<li>Would <em>header.css</em> block <em>main.css</em>, <em>app.js</em> and other resources fetching?</li>
</ul>
<p>And here are the results.</p>
<p><img src="/blog/images/1584456970837.gif"></p>
<ol>
<li><em>header.css</em> won’t block DOM parsing.</li>
<li><em>header.css</em>, <em>main.css</em> all blocked rendering which means <strong>the page would be always blank until all the <em>.css</em> files request in the <code>&lt;head&gt;</code> finished.</strong></li>
<li><em>header.css</em> won’t block <em>main.css</em>, <em>app.js</em> and other resources fetching. Though the codes in the resources won’t be executed in advance!</li>
<li>After <em>header.css</em>, <em>main.css</em> loaded and parsed, we will get the first paint.</li>
<li>Then <em>app.js</em> was fetched, parsed and executed with DOM parsing and rendering blocked.</li>
<li>After <em>app.js</em> was executed, DOM parsing and rendering keep working.</li>
<li>DOM parsing complete.</li>
<li>Rendering complete.</li>
</ol>
<h3 id="Put-css-Files-in-the-1"><a href="#Put-css-Files-in-the-1" class="headerlink" title="Put .css Files in the &lt;body&gt;"></a>Put <em>.css</em> Files in the <code>&lt;body&gt;</code></h3><p>It is not very common to see this usage recently. However, test is still needed if we want to know more. Consider the following code,</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>MyApp<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/header.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      Header</span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/main.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      Main</span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span>Footer<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./static/app.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Say I still block all the <em>.css</em> files with fiddler. What would the results be?</p>
<p><img src="/blog/images/1584452497349.gif"></p>
<p>As you can see,</p>
<ol>
<li><p><strong>The DOM parsing and rendering would work before they met <em>header.css</em> in the <code>&lt;body&gt;</code> which would get an earlier first paint</strong>. User can see something(usually there is a loading bar) before the styles in <code>&lt;body&gt;</code> loaded.</p>
</li>
<li><p><em>header.css</em> <strong>blocked DOM parsing</strong>, hence blocked rendering.</p>
</li>
<li><p><em>header.css</em> didn’t block other files fetching and <em>app.js</em> is still not executed in advance!</p>
</li>
<li><p>After <em>header.css</em> was loaded, <strong>the DOM parsing and rendering keeps working</strong>. Then blocked by <em>main.css</em> again. However, user can see the header now!</p>
</li>
<li><p>After <em>main.css</em> was loaded, <em>app.js</em> is executed!</p>
</li>
<li><p>DOM parsing complete</p>
</li>
<li><p>Rendering complete.</p>
</li>
</ol>
<p>Compared with the first example, we can find the difference is that</p>
<ul>
<li><em>.css</em> files in the <code>&lt;body&gt;</code> would block DOM parsing while <em>.css</em> files in the <code>&lt;head&gt;</code> wouldn’t though they both blocked rendering.</li>
</ul>
<p>Hence, if we put the styles in the <code>&lt;head&gt;</code>, we can make use of the time of styles downloading and parsing to parse more DOM.</p>
<p>However, <em>.css</em> files in the <code>&lt;body&gt;</code> would get a faster first paint and is closer to a progressive loading webpage . That’s because it doesn’t need to load all the styles in the <code>&lt;head&gt;</code> and allow content above the <code>&lt;link&gt;</code> to render.</p>
<p>Assuming that the requests of the styles need 1 second, let’s see the following demo.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- demo1 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/app.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/header.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      Header</span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/main.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      Main</span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/footer.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span>Footer<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- demo2 --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/app.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/header.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/main.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/footer.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      Header</span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      Main</span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span>Footer<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Demo2 would render the page after all the styles loaded while demo1 would load and render step by step. Assuming that there is a 1 second delay in <em>main.css</em>, the results would be:</p>
<p><em>styles in head</em></p>
<p><img src="/blog/images/%7B65466B88-0183-435E-AA55-0682FCE52CA5%7D_20200328210103.jpg" alt="styles in head"></p>
<p><em>styles in body</em></p>
<p><img src="/blog/images/70C9BEB6-EEB8-4795-A265-FE71D7605ED4.png" alt="styles in body"></p>
<p>As you can see, the result of <em>styles in body</em> might be more acceptable and expected. However, with that way we might need more code because we haven’t taken consideration of <code>script</code>. Things can be more complicated in production.</p>
<h3 id="Put-js-Files-in-the-or"><a href="#Put-js-Files-in-the-or" class="headerlink" title="Put .js Files in the &lt;head&gt; or &lt;body&gt;"></a>Put <em>.js</em> Files in the <code>&lt;head&gt;</code> or <code>&lt;body&gt;</code></h3><p>Actually, it works like styles in <code>&lt;body&gt;</code> where we put it in the <code>&lt;head&gt;</code> or <code>&lt;body&gt;</code>. The script without <code>async</code> and <code>deferred</code> would block DOM parsing and rendering. Actually, it is specified in W3C specifications.</p>
<blockquote>
<p>For classic scripts, if the async attribute is present, then the classic script will be fetched in parallel to parsing and evaluated as soon as it is available (potentially before parsing completes).<br>If the async attribute is not present but the defer attribute is present, then the classic script will be fetched in parallel and evaluated when the page has finished parsing.<br>If neither attribute is present, then the script is fetched and evaluated immediately, blocking parsing until these are both complete.</p>
</blockquote>
<p>Hence for better experience we can add a loading before the script. So it’s common to put the scripts at the bottom of <code>&lt;body&gt;</code> to let the loading dom be parsed and rendering first.</p>
<h3 id="Inline-Scripts-Blocks-Rendering"><a href="#Inline-Scripts-Blocks-Rendering" class="headerlink" title="Inline Scripts Blocks Rendering"></a>Inline Scripts Blocks Rendering</h3><p>It’s also worth mentioning that if we put an inline script at the bottom of the <code>&lt;body&gt;</code> the nearest or even all DOM and styles rendering before the script would be blocked until the script was executed. You can use code below to test</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/app.css"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/header.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">      Header</span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/main.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">      Main</span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./static/footer.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span>Footer<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> startTime = <span class="built_in">Date</span>.now();</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> interval = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">while</span> ((interval = <span class="built_in">Date</span>.now() - startTime) &lt; <span class="number">10000</span>) &#123;</span></span><br><span class="line">        if (interval % 1000 === 0) &#123;</span><br><span class="line"><span class="javascript">          <span class="built_in">console</span>.log(interval / <span class="number">1000</span> + <span class="string">" second passed"</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>In that case, users might not see the loading bar. So take care of the inline scripts.</p>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2><p>The above tests are tested in windows7 Chrome 80.0.3987.106.</p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://jakearchibald.com/2016/link-in-body/" target="_blank" rel="noopener">The future of loading CSS</a></p>
<p><a href="https://github.com/xianshenglu/blog/issues/103"><strong>Source</strong></a></p>
]]></content>
      <categories>
        <category>browser</category>
      </categories>
      <tags>
        <tag>DOM</tag>
        <tag>Chrome</tag>
      </tags>
  </entry>
  <entry>
    <title>Traps in reduce</title>
    <url>/blog/2019/08/traps-in-reduce/</url>
    <content><![CDATA[<h3 id="Optional-initialValue"><a href="#Optional-initialValue" class="headerlink" title="Optional initialValue?"></a>Optional <code>initialValue</code>?</h3><p>Sometimes, we can see code using <code>reduce</code> without <code>initialValue</code>. For example,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</span><br><span class="line">array.reduce(<span class="function">(<span class="params">re, v</span>) =&gt;</span> re + v);</span><br></pre></td></tr></table></figure>

<p>According to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce#Parameters" target="_blank" rel="noopener">mdn</a>, it is valid and seems simpler. However, is it a good practice?</p>
<h3 id="Cons-Brought-by-No-initialValue"><a href="#Cons-Brought-by-No-initialValue" class="headerlink" title="Cons Brought by No initialValue"></a>Cons Brought by No <code>initialValue</code></h3><p>In the real world, <code>array</code> could be <code>[]</code>. In this case,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [];</span><br><span class="line">array.reduce(<span class="function">(<span class="params">re, v</span>) =&gt;</span> re + v);</span><br></pre></td></tr></table></figure>

<p>You will got error in production!</p>
<blockquote>
<p>Uncaught TypeError: Reduce of empty array with no initial value</p>
</blockquote>
<p>Also, imagine that if you have met this code in your work ? What the hell does this <code>reduce</code> do?</p>
<ul>
<li>Join the <code>string</code></li>
<li>Or cumulative summation</li>
<li>Or other situations?</li>
</ul>
<p>You would never know until you have read the context.</p>
<p>As you can see, these are the most obvious cons brought by no <code>initialValue</code>.</p>
<ul>
<li>Potential Error</li>
<li>Unclear semantics</li>
</ul>
<h3 id="Benefits-Brought-with-initialValue"><a href="#Benefits-Brought-with-initialValue" class="headerlink" title="Benefits Brought with initialValue"></a>Benefits Brought with <code>initialValue</code></h3><p>Instead, if using <code>reduce</code> with <code>initialValue</code>. For example, in the above case, we can write like this</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [];</span><br><span class="line">array.reduce(<span class="function">(<span class="params">re, v</span>) =&gt;</span> re + v, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>We would never meet the error!</li>
<li>It is obvious that <code>reduce</code> is using to do the cumulative summation job.</li>
</ul>
<p><strong>Safer</strong> and <strong>Clearer!</strong></p>
<p><strong><a href="https://github.com/xianshenglu/blog/issues/97">Issue</a></strong></p>
<p><strong><a href="https://github.com/xianshenglu/blog/blob/master/source/_posts/traps-in-reduce.md">Source</a></strong></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>reduce</tag>
      </tags>
  </entry>
  <entry>
    <title>Tricks in Vue</title>
    <url>/blog/2019/01/tricks-in-vue/</url>
    <content><![CDATA[<p>There are some tricks which can’t be found easily in <a href="https://vuejs.org/index.html" target="_blank" rel="noopener">Vue.js homepage</a>. So, for convenient, I summarized them here.</p>
<h3 id="Vue"><a href="#Vue" class="headerlink" title="Vue"></a>Vue</h3><h4 id="Access-Global-Variable-in-Template"><a href="#Access-Global-Variable-in-Template" class="headerlink" title="Access Global Variable in Template"></a>Access Global Variable in Template</h4><p>Have you ever done something like this in lots of components?</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;a @click=&quot;window.open(&apos;...&apos;)&quot;&gt;&lt;/a&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      window: window</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;a @click=&quot;bus.$emit(&apos;some-event&apos;)&quot;&gt;&lt;/a&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      bus: bus</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>Actually, you don’t have to, you can register <code>window</code> or <code>bus</code> in <code>Vue.prototype</code> like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">Vue.prototype.window = <span class="built_in">window</span>;</span><br><span class="line">Vue.prototype.bus = bus;</span><br></pre></td></tr></table></figure>

<p>in the <em>main.js</em> or the entry file. Then you can use <code>bus</code> or <code>window</code> in <code>template</code> directly. Also, this usage prevents Vue watching the attributes of <code>bus</code> or <code>window</code> which would bring a waste of performance.</p>
<h4 id="Reactive-or-Not-Reactive"><a href="#Reactive-or-Not-Reactive" class="headerlink" title="Reactive or Not Reactive"></a>Reactive or Not Reactive</h4><p>Always, if we want a data reactive, we have to do something like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">data: &#123;</span><br><span class="line">  newTodoText: <span class="string">''</span>,</span><br><span class="line">  visitCount: <span class="number">0</span>,</span><br><span class="line">  hideCompletedTodos: <span class="literal">false</span>,</span><br><span class="line">  todos: [],</span><br><span class="line">  error: <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Set some initial value to adds <strong>all the properties found in its data object</strong> to Vue’s reactivity system.</p>
<p>Things we need to take care about is:</p>
<ul>
<li>If we want to add reactive attributes dynamically, we have to use something like <code>Vue.set</code> or <code>this.$set</code>. Otherwise, they might not be reactive.</li>
<li>If we definitely don’t want some data to participate in Vue’s reactivity system even we initialize it in <code>data</code>. We can use something like <code>Object.freeze()</code>. For example, freeze a <strong>huge</strong> array to improve <strong>performance</strong>.</li>
</ul>
<h4 id="Scoped-Style-Won’t-Work-on-Dynamically-Inserted-Elements"><a href="#Scoped-Style-Won’t-Work-on-Dynamically-Inserted-Elements" class="headerlink" title="Scoped Style Won’t Work on Dynamically Inserted Elements"></a>Scoped Style Won’t Work on Dynamically Inserted Elements</h4><p>I always use the <code>&lt;style scoped&gt;</code> tag in <em>.vue</em> files. It is always good except when we want to insert elements dynamically. For example:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot; ref=&quot;app&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    this.$refs.app.innerHTML = `&lt;h1 class=&quot;App__title&quot;&gt;App__title&lt;/h1&gt;`;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">.App__title &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p><code>color: red</code> won’t work on <code>.App__title</code> because of <code>scoped</code>. The actual style is rendered with a unique attribute like:</p>
<p><img src="/blog/images/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20190126215103.png"></p>
<p>So, how do we solve this? <code>/deep/</code> or <code>&gt;&gt;&gt;</code>.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;style scoped&gt;</span><br><span class="line">/deep/ .App__title &#123;</span><br><span class="line">  color: red;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>They can be used to override child component style. Here is the <a href="https://vue-loader.vuejs.org/guide/scoped-css.html#deep-selectors" target="_blank" rel="noopener">doc</a>.</p>
<h4 id="Smarter-Watchers"><a href="#Smarter-Watchers" class="headerlink" title="Smarter Watchers"></a>Smarter Watchers</h4><p>Have you ever written code like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  created() &#123;</span><br><span class="line">    <span class="keyword">this</span>.fetchPostList()</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    searchInputValue() &#123;</span><br><span class="line">      <span class="keyword">this</span>.fetchPostList()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Actually, you can simplify it by</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  watch: &#123;</span><br><span class="line">    searchInputValue:&#123;</span><br><span class="line">      handler: <span class="string">'fetchPostList'</span>,</span><br><span class="line">      immediate: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As the <a href="https://vuejs.org/v2/api/#vm-watch" target="_blank" rel="noopener">doc</a> said:</p>
<blockquote>
<p>Passing in immediate: true in the option will trigger the callback immediately with the current value of the expression.</p>
</blockquote>
<h4 id="attrs-and-listeners"><a href="#attrs-and-listeners" class="headerlink" title="$attrs and $listeners"></a>$attrs and $listeners</h4><p>I don’t know if you have used <code>$attrs</code> and <code>$listeners</code> from <code>this</code>. However, I never used those until I met this situation. For example:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">base-input</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:value</span>=<span class="string">"value"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">placeholder</span>=<span class="string">"parentPlaceholder"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">otherAttrs</span>=<span class="string">"otherAttrs"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">input</span>=<span class="string">"inputCb"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">click</span>=<span class="string">"clickCb"</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">base-input</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> BaseInput = &#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">"base-input"</span>,</span></span><br><span class="line">    template: `</span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">:value</span>=<span class="string">"value"</span> <span class="attr">:placeholder</span>=<span class="string">"placeholder"</span>  <span class="attr">:otherAttrs</span>=<span class="string">"otherAttrs"</span> @<span class="attr">input</span>=<span class="string">"$emit('input',$event)"</span> @<span class="attr">click</span>=<span class="string">"$emit('click',$event)"</span> @<span class="attr">focus</span>=<span class="string">"focusCb"</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span>`,</span></span><br><span class="line">    props: &#123;</span><br><span class="line">      value: &#123;</span><br><span class="line"><span class="javascript">        type: <span class="built_in">String</span></span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    computed: &#123;</span><br><span class="line">      listeners() &#123;</span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> listeners = &#123;</span></span><br><span class="line">          ...this.$listeners,</span><br><span class="line"><span class="javascript">          focus: <span class="keyword">this</span>.focusCb</span></span><br><span class="line">        &#125;;</span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> listeners;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      focusCb(event) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">"child"</span>, event);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="javascript">  <span class="built_in">window</span>.app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">"#app"</span>,</span></span><br><span class="line">    components: &#123;</span><br><span class="line">      BaseInput</span><br><span class="line">    &#125;,</span><br><span class="line">    data: &#123;</span><br><span class="line"><span class="javascript">      value: <span class="string">""</span>,</span></span><br><span class="line"><span class="javascript">      parentPlaceholder: <span class="string">"parentPlaceholder"</span></span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      inputCb(event) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(event);</span></span><br><span class="line">      &#125;,</span><br><span class="line">      clickCb(event) &#123;</span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(event);</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>It’s obviously tedious to bind every attribute and listener by hand. Actually, this is where <code>$attrs</code> and <code>$listeners</code> will help us. We can write the <code>BaseInput</code> <code>template</code> like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> BaseInput = &#123;</span><br><span class="line">  name: <span class="string">"base-input"</span>,</span><br><span class="line">  template: <span class="string">`&lt;div&gt;&lt;input type="text" :value="value"  v-bind="$attrs" v-on="listeners" /&gt;&lt;/div&gt;`</span>,</span><br><span class="line">  props: &#123;</span><br><span class="line">    value: &#123;</span><br><span class="line">      type: <span class="built_in">String</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    listeners() &#123;</span><br><span class="line">      <span class="keyword">const</span> listeners = &#123;</span><br><span class="line">        ...this.$listeners,</span><br><span class="line">        <span class="comment">// move `focus` in to `listeners` instead of adding one more `focus` listener.</span></span><br><span class="line">        focus: <span class="keyword">this</span>.focusCb</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">return</span> listeners;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    focusCb(event) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"child"</span>, event);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Vue-Router"><a href="#Vue-Router" class="headerlink" title="Vue-Router"></a>Vue-Router</h3><h4 id="router-and-route"><a href="#router-and-route" class="headerlink" title="$router and $route"></a>$router and $route</h4><p>Have you ever wonder about the relationship between <code>$router</code> and <code>$route</code>? I give you a hint:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.$router.currentRoute === <span class="keyword">this</span>.$route; <span class="comment">//true</span></span><br></pre></td></tr></table></figure>

<h3 id="Vuex"><a href="#Vuex" class="headerlink" title="Vuex"></a>Vuex</h3><h4 id="Commit-Data-by-One-Mutation"><a href="#Commit-Data-by-One-Mutation" class="headerlink" title="Commit Data by One Mutation"></a>Commit Data by One Mutation</h4><p>We can’t directly mutate <code>state</code> in Vuex. Instead, we have to <code>commit</code> a <code>mutation</code> to mutate the data. However, it would be tedious to write lots of similar mutations like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  modules: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    updateName(state, data) &#123;</span><br><span class="line">      state.name = data;</span><br><span class="line">    &#125;,</span><br><span class="line">    updateChildrenCount(state, data) &#123;</span><br><span class="line">      state.children.count = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// other similar mutations</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>We can write a public mutation to do this like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  modules: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    replaceProperty(state, &#123; path, data &#125;) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> path !== <span class="string">"string"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      path = path.split(<span class="string">"."</span>);</span><br><span class="line">      <span class="keyword">let</span> targetObj = path.slice(<span class="number">0</span>, <span class="number">-1</span>).reduce(<span class="function">(<span class="params">re, key</span>) =&gt;</span> re[key], state);</span><br><span class="line">      targetObj[path.pop()] = data;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Then we can mutate <code>state</code> in anywhere with only one mutation like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">commit(</span><br><span class="line">  <span class="string">"replaceProperty"</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"name"</span>,</span><br><span class="line">    data: name</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line">commit(</span><br><span class="line">  <span class="string">"replaceProperty"</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"children.count"</span>,</span><br><span class="line">    data: data</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br><span class="line">commit(</span><br><span class="line">  <span class="string">"replaceProperty"</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">"some.other.deep.path.in.state"</span>,</span><br><span class="line">    data: data</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">root</span>: <span class="literal">true</span> &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>It would also work for modules!</p>
<p><a href="https://github.com/xianshenglu/blog/issues/52"><strong>Original Post</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://www.youtube.com/watch?v=7lpemgMhi0k" target="_blank" rel="noopener">7 Secret Patterns Vue Consultants Don’t Want You to Know - Chris Fritz</a></li>
<li><a href="https://github.com/vuejs/vue-loader/issues/749">vue-loader&#x2F;issues&#x2F;749</a></li>
</ul>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>$attrs</tag>
        <tag>$listeners</tag>
      </tags>
  </entry>
  <entry>
    <title>Understand .sync in Vue</title>
    <url>/blog/2018/10/understand-sync-in-vue/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>The first time I met <code>.sync</code> modifier, I didn’t know it very well. So, I seldom use that. Today, I am going to get it.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>In the past, I use “two-way binding” like this:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"app"</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button-counter</span> <span class="attr">:child-count</span>=<span class="string">"parCount"</span> @<span class="attr">add</span>=<span class="string">"add"</span>&gt;</span><span class="tag">&lt;/<span class="name">button-counter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>parent component &#123;&#123;parCount&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#app"</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    parCount: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    add() &#123;</span><br><span class="line">      <span class="keyword">this</span>.parCount++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    <span class="string">"button-counter"</span>: &#123;</span><br><span class="line">      template:</span><br><span class="line">        <span class="string">'&lt;button @click="add"&gt;You clicked me &#123;&#123; childCount &#125;&#125; times.&lt;/button&gt;'</span>,</span><br><span class="line">      props: [<span class="string">"childCount"</span>],</span><br><span class="line">      methods: &#123;</span><br><span class="line">        add() &#123;</span><br><span class="line">          <span class="keyword">this</span>.$emit(<span class="string">"add"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>It was easy to understand except a little inconvenient. I need to listen and handle event in child and parent component. Also</p>
<p><em>true two-way binding can create maintenance issues, because child components can mutate the parent without the source of that mutation being obvious in both the parent and the child.</em></p>
<p>So, Vue recommends emitting events in the pattern of <code>update:myPropName</code>. For example:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"app"</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button-counter</span></span></span><br><span class="line"><span class="tag">    <span class="attr">:child-count</span>=<span class="string">"parCount"</span></span></span><br><span class="line"><span class="tag">    @<span class="attr">update:child-count</span>=<span class="string">"parCount=$event"</span></span></span><br><span class="line"><span class="tag">  &gt;</span><span class="tag">&lt;/<span class="name">button-counter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>parent component &#123;&#123;parCount&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#app"</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    parCount: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;&#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    <span class="string">"button-counter"</span>: &#123;</span><br><span class="line">      template:</span><br><span class="line">        <span class="string">'&lt;button @click="add"&gt;You clicked me &#123;&#123; childCount &#125;&#125; times.&lt;/button&gt;'</span>,</span><br><span class="line">      props: [<span class="string">"childCount"</span>],</span><br><span class="line">      methods: &#123;</span><br><span class="line">        add() &#123;</span><br><span class="line">          <span class="keyword">this</span>.$emit(<span class="string">"update:child-count"</span>, <span class="keyword">this</span>.childCount + <span class="number">1</span>); <span class="comment">// child-count is right while childCount won't work</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>See? In this case, we don’t have to add event callback in parent component because vue have done that. And this is the principle of <code>.sync</code>. For convenience, Vue offers a shorthand for this pattern with the <code>.sync</code> modifier which would make the code above like:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"app"</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button-counter</span> <span class="attr">:child-count.sync</span>=<span class="string">"parCount"</span>&gt;</span><span class="tag">&lt;/<span class="name">button-counter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>parent component &#123;&#123;parCount&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#app"</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    parCount: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;&#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    <span class="string">"button-counter"</span>: &#123;</span><br><span class="line">      template:</span><br><span class="line">        <span class="string">'&lt;button @click="add"&gt;You clicked me &#123;&#123; childCount &#125;&#125; times.&lt;/button&gt;'</span>,</span><br><span class="line">      props: [<span class="string">"childCount"</span>],</span><br><span class="line">      methods: &#123;</span><br><span class="line">        add() &#123;</span><br><span class="line">          <span class="keyword">this</span>.$emit(<span class="string">"update:childCount"</span>, <span class="keyword">this</span>.childCount + <span class="number">1</span>); <span class="comment">// childCount is right while child-count won't work</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Also,</p>
<p><em>The .sync modifier can also be used with v-bind when using an object to set multiple props at once:</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">text-document</span> <span class="attr">v-bind.sync</span>=<span class="string">"doc"</span>&gt;</span><span class="tag">&lt;/<span class="name">text-document</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><em>This passes each property in the <code>doc</code> object (e.g. <code>title</code>) as an individual prop, then adds <code>v-on</code> update listeners for each one.</em></p>
<p>For more information, go <a href="https://vuejs.org/v2/guide/components-custom-events.html#sync-Modifier" target="_blank" rel="noopener">Vue.js</a></p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>.sync</tag>
      </tags>
  </entry>
  <entry>
    <title>Usage of ESLint</title>
    <url>/blog/2018/10/usage-of-eslint/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>I won’t start with questions like what or why. I will start with how and why. Let’s begin.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><h3 id="install-eslint"><a href="#install-eslint" class="headerlink" title="install eslint"></a>install eslint</h3><p>Install global eslint package:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i eslint@latest -g</span><br></pre></td></tr></table></figure>

<p>Then setup a config file. For example:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /</span><br><span class="line"><span class="built_in">cd</span> d/nodemodules</span><br><span class="line">eslint --init</span><br></pre></td></tr></table></figure>

<p>Then it will give you some choices.</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006154426.png" alt="截图20181006154426.png"></p>
<p><strong>tips:</strong></p>
<ol>
<li><em>You may need to <code>npm init</code> first but you can remove it later.</em></li>
<li><em>If you can’t use arrow key, you may try use cmd.exe instead</em>.</li>
</ol>
<p>After that you will get a config file with some settings.</p>
<p>According to tips on terminal, you will need to load some packages like me because of your previous choices. So, I need to:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i eslint-plugin-react@latest -g</span><br></pre></td></tr></table></figure>

<p>Actually you can remove the <em>package.json</em> ( if you have ) now because we are making global eslint settings, not for a project.</p>
<p>As far, I have a global eslint config file (<em>d:\nodemodules\.eslintrc.json</em>). And my test file is <em>test4.js</em>. Here is the origin code:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> name = &#123;</span><br><span class="line">  name: <span class="string">"test4.js"</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">params</span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>So, how can I lint <em>test4.js</em> by <em>d:\nodemodules\.eslintrc.json</em>?</p>
<h3 id="run-eslint-on-terminal"><a href="#run-eslint-on-terminal" class="headerlink" title="run eslint on terminal"></a>run eslint on terminal</h3><p>Let’s switch to the folder of <em>test4.js</em>. Then for me, I run code below:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eslint --config d:\nodeModules\.eslintrc.json test4.js</span><br></pre></td></tr></table></figure>

<p>Result:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006161411.png" alt="截图20181006161411.png"></p>
<p>Here it is. Well, of course we want to fix it when run lint. So, according to <a href="https://eslint.org/docs/user-guide/command-line-interface" target="_blank" rel="noopener">ESLint doc</a> we can try code below:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eslint --fix --config d:\nodeModules\.eslintrc.json test4.js</span><br></pre></td></tr></table></figure>

<p>Result:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006163246.png" alt="截图20181006163246.png"></p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006163413.png" alt="截图20181006163413.png"></p>
<p>ESLint will fix some problems, mainly spaces. In the case above, <strong>no-unused-vars</strong> problems will not be fixed.</p>
<h3 id="set-custom-rules"><a href="#set-custom-rules" class="headerlink" title="set custom rules"></a>set custom rules</h3><p>Futhermore, the expected indent is 4 spaces. But I want 2 spaces to be the default indent. So, we always set our own rules based on ESLint. In my case, I altered the <em>d:\nodemodules\.eslintrc.json</em> like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="comment">//other settings</span></span><br><span class="line">    <span class="string">"rules"</span>: &#123;</span><br><span class="line">        <span class="string">"indent"</span>: [</span><br><span class="line">            <span class="string">"error"</span>,</span><br><span class="line">            <span class="number">2</span></span><br><span class="line">            <span class="comment">//change to 2 not 4</span></span><br><span class="line">        ],</span><br><span class="line">      <span class="comment">//other rules</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Then, run the code above again:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eslint --fix --config d:\nodeModules\.eslintrc.json test4.js</span><br></pre></td></tr></table></figure>

<p>It works immediately. If you want to change other rules, you may have to know more about the existing rules in <a href="https://eslint.org/docs/rules/" target="_blank" rel="noopener">Eslint rules</a>.</p>
<p>For me, For me, I usually set own rules based on <strong>standard</strong> not <strong>recommended rules</strong> and my custom rules is like:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">//other settings</span></span><br><span class="line">  <span class="string">"extends"</span>: <span class="string">"standard"</span>,</span><br><span class="line">  <span class="comment">//other settings</span></span><br><span class="line">  <span class="string">"rules"</span>: &#123;</span><br><span class="line">    <span class="string">"indent"</span>: [<span class="string">"error"</span>, <span class="number">2</span>],</span><br><span class="line">    <span class="string">"linebreak-style"</span>: [<span class="string">"off"</span>, <span class="string">"unix"</span>],</span><br><span class="line">    <span class="string">"quotes"</span>: [<span class="string">"error"</span>, <span class="string">"single"</span>],</span><br><span class="line">    <span class="string">"semi"</span>: [<span class="string">"error"</span>, <span class="string">"never"</span>],</span><br><span class="line">    <span class="string">"no-multiple-empty-lines"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"max"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">"maxEOF"</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>In this case, we run again:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eslint --fix --config d:\nodeModules\.eslintrc.json test4.js</span><br></pre></td></tr></table></figure>

<p>Actually, I got error:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006165344.png" alt="截图20181006165344.png"></p>
<p>So, I have to run</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i eslint-config-standard@latest -g</span><br></pre></td></tr></table></figure>

<p>It turns out I got more warnings.</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006165741.png" alt="截图20181006165741.png"></p>
<p>So, I keep installing:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i eslint-plugin-import@latest eslint-plugin-node@latest eslint-plugin-promise@latest eslint-plugin-standard@latest -g</span><br></pre></td></tr></table></figure>

<p>After that, there is no <strong>correct</strong> warnings. So, I run</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eslint --fix --config d:\nodeModules\.eslintrc.json test4.js</span><br></pre></td></tr></table></figure>

<p>I got a little difference because of different rules:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006165945.png" alt="截图20181006165945.png"></p>
<h3 id="script-in-html"><a href="#script-in-html" class="headerlink" title="script in .html"></a>script in .html</h3><p>If you use code above to format js in .html, it will fail. For example:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- test4.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">      html,</span><br><span class="line">      body &#123;</span><br><span class="line">        width: 100%;</span><br><span class="line">        height: 100%;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> name = &#123;</span></span><br><span class="line"><span class="javascript">        name: <span class="string">"test4.js"</span></span></span><br><span class="line">      &#125;;</span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> obj = &#123;&#125;;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params">params</span>) </span>&#123;&#125;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">eslint --fix --config d:\nodeModules\.eslintrc.json test4.html</span><br></pre></td></tr></table></figure>

<p>Result:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006172654.png" alt="截图20181006172654.png"></p>
<p>See? Actually, we need plugins for non .js files. After search, I have to run code:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i eslint-plugin-html@latest -g</span><br></pre></td></tr></table></figure>

<p>Also, we need to update <em>d:\nodeModules\.eslintrc.json</em> and it would be:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"env"</span>: &#123;</span><br><span class="line">    <span class="string">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"commonjs"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"es6"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"node"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"extends"</span>: <span class="string">"standard"</span>,</span><br><span class="line">  <span class="string">"parserOptions"</span>: &#123;</span><br><span class="line">    <span class="string">"ecmaFeatures"</span>: &#123;</span><br><span class="line">      <span class="string">"jsx"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"ecmaVersion"</span>: <span class="number">2018</span>,</span><br><span class="line">    <span class="string">"sourceType"</span>: <span class="string">"module"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"plugins"</span>: [<span class="string">"html"</span>],<span class="comment">//add this plugin</span></span><br><span class="line">  <span class="string">"rules"</span>: &#123;</span><br><span class="line">    <span class="string">"indent"</span>: [<span class="string">"error"</span>, <span class="number">2</span>],</span><br><span class="line">    <span class="string">"linebreak-style"</span>: [<span class="string">"off"</span>, <span class="string">"unix"</span>],</span><br><span class="line">    <span class="string">"quotes"</span>: [<span class="string">"error"</span>, <span class="string">"single"</span>],</span><br><span class="line">    <span class="string">"semi"</span>: [<span class="string">"error"</span>, <span class="string">"never"</span>],</span><br><span class="line">    <span class="string">"no-multiple-empty-lines"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"max"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">"maxEOF"</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After that, you run the code and ESLint would work for .html files.</p>
<h3 id="move-–fix-to-editor"><a href="#move-–fix-to-editor" class="headerlink" title="move –fix to editor"></a>move –fix to editor</h3><p>As far, it seems there is only one flaw left. Do we have to run the code every time we want to format?</p>
<p>Actually, we don’t have to. For me, using vscode, ESLint provides plugins to do these jobs. For other editor users, you may want to check the ESLint doc.</p>
<p>Here is the operations for vscode.</p>
<p>Install ESLint plugin. Then add some settings in your <em>User Settings.</em></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"eslint.options"</span>: &#123;</span><br><span class="line">    <span class="comment">//replace with your filename and path</span></span><br><span class="line">    <span class="string">"configFile"</span>: <span class="string">"D:/nodeModules/eslint/.eslintrc.json"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"eslint.alwaysShowStatus"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"eslint.autoFixOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"eslint.run"</span>: <span class="string">"onSave"</span>,</span><br><span class="line">  <span class="string">"eslint.validate"</span>: [</span><br><span class="line">    <span class="string">"javascript"</span>,</span><br><span class="line">    <span class="string">"javascriptreact"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"language"</span>: <span class="string">"html"</span>,</span><br><span class="line">      <span class="string">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"language"</span>: <span class="string">"vue"</span>,</span><br><span class="line">      <span class="string">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>After restarting your editor, you will see</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006173812.png" alt="截图20181006173812.png"></p>
<p>And</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006173913.png" alt="截图20181006173913.png"></p>
<p>If your default settings of <code>formatOnSave:true</code>, then ESLint would format your code onSave.</p>
<h3 id="make-global-and-local-config-file-independent"><a href="#make-global-and-local-config-file-independent" class="headerlink" title="make global and local config file independent"></a>make global and local config file independent</h3><p>Until now, everything seems perfect with ESLint. But there is one thing I need to mention. Suppose that you create a new vue project using vue-cli.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vue create my-proj</span><br><span class="line"><span class="built_in">cd</span> my-proj</span><br></pre></td></tr></table></figure>

<p>You may find that ESLinter error like below:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006180631.png" alt="截图20181006180631.png"></p>
<p>You can see this because we set the <code>eslint.options</code> in the <code>User Settings</code>. <code>eslint.options</code> setting is like passing it on the command line in a terminal using the <code>--config</code>. If you do this ESLint respects this and will not use the one in the project folder.</p>
<p>However, if we delete the <code>eslint.options</code> it won’t be able to format other files. So, the compromise solution is :</p>
<ol>
<li>delete the <code>eslint.options</code></li>
<li>move the global config file to the top.</li>
</ol>
<p>For example:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">home</span><br><span class="line">  .eslintrc</span><br><span class="line">  projects</span><br><span class="line">    projectOne</span><br><span class="line">      .eslintrc</span><br><span class="line">    projectTwo</span><br></pre></td></tr></table></figure>

<p>If we move the <em>d:\nodeModules\.eslintrc.json</em> to home, then delete the <code>eslint.options</code>. The result would be:</p>
<ul>
<li>code in project one will be validated using the local .eslintrc file</li>
<li>code in project two will be validated using the .eslintrc file in your home directory</li>
</ul>
<p>Got it? I learn this from <a href="https://github.com/Microsoft/vscode-eslint/issues/527">Override global eslintrc if one is found in current project</a>.</p>
<p>At last, eslint in <code>User Settings</code> is:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">"eslint.options"</span>: &#123;</span><br><span class="line">    <span class="comment">// "configFile": "D:/nodeModules/eslint/.eslintrc.json",</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"eslint.alwaysShowStatus"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"eslint.autoFixOnSave"</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="string">"eslint.run"</span>: <span class="string">"onSave"</span>,</span><br><span class="line">  <span class="string">"eslint.validate"</span>: [</span><br><span class="line">    <span class="string">"javascript"</span>,</span><br><span class="line">    <span class="string">"javascriptreact"</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"language"</span>: <span class="string">"html"</span>,</span><br><span class="line">      <span class="string">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"language"</span>: <span class="string">"vue"</span>,</span><br><span class="line">      <span class="string">"autoFix"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>And in the folder of all projects, I have global eslint config file:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181006210753.png" alt="截图20181006210753.png"></p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://github.com/Microsoft/vscode-eslint/issues/527">Override global eslintrc if one is found in current project</a></li>
</ul>
]]></content>
      <categories>
        <category>code-quality</category>
      </categories>
      <tags>
        <tag>ESLint</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>Use Custom Font on Web</title>
    <url>/blog/2018/08/use-custom-font-on-web/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>CSS3 can set custom <code>font-family</code> with src pointing to the specific font file. We can use it for some cool font or use it when there is no specific font on the user’s computer.</p>
<p>However, when I try to use it I find something blocking my way.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>Well, it’s about the language problem.</p>
<p>As we all know, if I try to use some font for Non-English language the font file may not be small enough. For example, I am trying to use some kind of Chinese font and I find the font file. However, the file is more than 5M and I haven’t handled the compatibility problem.</p>
<p>So, I am trying to find a solution about this. And I find <a href="https://github.com/ecomfe/fontmin/">fontmin</a>!</p>
<p><a href="https://github.com/ecomfe/fontmin/">fontmin</a> will extract the text you files used and generate the corresponding font file which is much smaller than your original font file.</p>
<p>For example:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Fontmin = <span class="built_in">require</span>(<span class="string">'fontmin'</span>)</span><br><span class="line"><span class="keyword">var</span> srcPath = <span class="string">'src/font/*.ttf'</span></span><br><span class="line"><span class="keyword">var</span> destPath = <span class="string">'asset/font'</span></span><br><span class="line"><span class="keyword">var</span> text = <span class="string">'我说你是人间的四月天；笑响点亮了四面风；轻灵在春的光艳中交舞着变。'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// initial</span></span><br><span class="line"><span class="keyword">var</span> fontmin = <span class="keyword">new</span> Fontmin()</span><br><span class="line">  .src(srcPath) <span class="comment">// font file you want to simplify</span></span><br><span class="line">  .use(</span><br><span class="line">    Fontmin.glyph(&#123;</span><br><span class="line">      <span class="comment">// extract glyph</span></span><br><span class="line">      text: text <span class="comment">// all the text you will use</span></span><br><span class="line">    &#125;)</span><br><span class="line">  )</span><br><span class="line">  .use(Fontmin.ttf2eot()) <span class="comment">// eot transform plugin</span></span><br><span class="line">  .use(Fontmin.ttf2woff()) <span class="comment">// woff transform plugin</span></span><br><span class="line">  .use(Fontmin.ttf2svg()) <span class="comment">// svg transform plugin</span></span><br><span class="line">  .use(Fontmin.css()) <span class="comment">// css generation plugin</span></span><br><span class="line">  .dest(destPath) <span class="comment">// output the simplified font file</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// run</span></span><br><span class="line">fontmin.run(<span class="function"><span class="keyword">function</span>(<span class="params">err, files, stream</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'done'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>In my case, I need to extract text from some file. So, I do it like this:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> text</span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line">fs.readFile(<span class="string">'data.js'</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">er, data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (er) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">console</span>.log(er)</span><br><span class="line">  &#125;</span><br><span class="line">  text = data</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> Fontmin = <span class="built_in">require</span>(<span class="string">'fontmin'</span>)</span><br><span class="line">  <span class="keyword">var</span> srcPath = <span class="string">'font/*.ttf'</span></span><br><span class="line">  <span class="keyword">var</span> destPath = <span class="string">'font/'</span></span><br><span class="line">  <span class="comment">// initial</span></span><br><span class="line">  <span class="keyword">var</span> fontmin = <span class="keyword">new</span> Fontmin()</span><br><span class="line">    .src(srcPath) <span class="comment">// font file you want to simplify</span></span><br><span class="line">    .use(</span><br><span class="line">      Fontmin.glyph(&#123;</span><br><span class="line">        <span class="comment">// extract glyph</span></span><br><span class="line">        text: text <span class="comment">// all the text you will use</span></span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line">    .use(Fontmin.ttf2eot()) <span class="comment">// eot transform plugin</span></span><br><span class="line">    .use(Fontmin.ttf2woff()) <span class="comment">// woff transform plugin</span></span><br><span class="line">    .use(Fontmin.ttf2svg()) <span class="comment">// svg transform plugin</span></span><br><span class="line">    .use(Fontmin.css()) <span class="comment">// css generation plugin</span></span><br><span class="line">    .dest(destPath) <span class="comment">// output the simplified font file</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// run</span></span><br><span class="line">  fontmin.run(<span class="function"><span class="keyword">function</span>(<span class="params">err, files, stream</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'done'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>And here is what I got:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180804204452.png" alt="截图20180804204452.png"></p>
<p>which is much smaller than origin Microsoft YaHei UI Light.ttf(<strong>11M</strong>).</p>
<p>However, here is a little tip I want to give you.</p>
<p>After you run the script above, <strong>the original font file <em>*.ttf</em> has been replaced.</strong> So, you had better back up the original font file before you run the script. Then if you need to run the script again, you should use the original font file, not the file which has been updated.</p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>font</tag>
        <tag>fontmin</tag>
      </tags>
  </entry>
  <entry>
    <title>Use Text Align Last Except When I Have Only One Line Of Text</title>
    <url>/blog/2018/06/use-text-align-last-except-when-i-have-only-one-line-of-text/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>As the title says, what I want is like image below:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20180609163513.png"></p>
<p>Is that Possible, ha?</p>
<h2 id="Steps"><a href="#Steps" class="headerlink" title="Steps"></a>Steps</h2><p>At the first, I thought that was impossible with css only. But I find an answer in SO. Here is the code:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"par"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"child child1"</span>&gt;</span>box box box box box <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"child child2"</span>&gt;</span>box box<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"child child3"</span>&gt;</span>box box box box<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.par</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: left;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.par</span> <span class="selector-class">.child</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.par</span> <span class="selector-class">.child1</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.par</span> <span class="selector-class">.child2</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: yellowgreen;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.par</span> <span class="selector-class">.child3</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: orange;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>That is magic!</p>
<p>Because inline-blocks is an inline-level element. So, it will be in the left of the container <code>.par</code> built because of <code>text-align:left</code>. The width of <code>inline-block</code> is determined by the content which is only one line. So, <code>text-align:center</code> on the <code>.child</code> doesn’t work because the width of <code>.child</code> is equal to the width of one line content in the <code>.child</code>.</p>
<p>Also, the <code>inline-block</code> is a block container. When there is more than one line, the width of <code>inline-block</code> will be equal to the width of <code>.par</code>. In this case, <code>text-align:center</code> will work on the last line because the width of last line is less than the width of the <code>inline-block</code>.</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><p>Anyway, this solution is awesome. Thanks to the reference.</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://stackoverflow.com/questions/43556557/how-can-i-use-text-align-last-except-when-i-have-only-one-line-of-text/43556943#comment88476400_43556943" target="_blank" rel="noopener">how-can-i-use-text-align-last-except-when-i-have-only-one-line-of-text</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>text-align</tag>
        <tag>text-align-last</tag>
      </tags>
  </entry>
  <entry>
    <title>Vue Form Input Bindings Fail?</title>
    <url>/blog/2018/10/vue-form-input-bindings-fail/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>When I was using form validate in Vue, I found sometimes vue doesn’t render data which was modified by me. I even thought it was a bug. Anyway, let’s take a look.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>Here is a simple demo:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.app</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"app"</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">"positive-num"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:value.trim</span>=<span class="string">"positiveNum"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">input</span>=<span class="string">"oldValidate"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:placeholder</span>=<span class="string">"positiveNumTip"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;positiveNumResTip&#125;&#125;&#123;&#123;positiveNum&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#app"</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    positiveNumTip: <span class="string">"please enter a positive num"</span>,</span><br><span class="line">    positiveNum: <span class="string">""</span>,</span><br><span class="line">    positiveNumResTip: <span class="string">"validated and modified result: "</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    oldValidate(event) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = event.target.value;</span><br><span class="line">      <span class="keyword">let</span> reg = <span class="regexp">/^[\d]+[.]?[\d]*$/</span>;</span><br><span class="line">      <span class="keyword">let</span> newVal = <span class="built_in">Number</span>.parseFloat(value);</span><br><span class="line">      <span class="keyword">if</span> (!value.match(reg)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(newVal) || newVal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.positiveNum = newVal;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.positiveNum = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.positiveNum = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>When I was pressing <em>dddddddddd</em>, what did I got?</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181004204524.png" alt="截图20181004204524.png"></p>
<p>The first letter was replaced to 1 but the others not. And the most important is the result I got is always 1 which means <code>this.positiveNum</code> is 1 while the value in the <code>input</code> is not 1.</p>
<p>Why?</p>
<p>I even thought it was a bug until one day I met a similar problem which was solved in SO.</p>
<p>The key is the Lifecycle. The guide mentions it before but I didn’t understand it until now. Let’s see the picture again:</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181004205221.png" alt="截图20181004205221.png"></p>
<p>See?</p>
<p>The first time we change <code>positiveNum</code> to 1 and then we always change <code>positiveNum</code> to 1. So, vue wouldn’t re-render because the data doesn’t change. So, the connection between <code>input</code> and <code>positiveNum</code> was cut off until <code>positiveNum</code> isn’t equal to 1.</p>
<p>We can add <code>updated</code> to see how many times data has changed:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#app"</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    positiveNumTip: <span class="string">"please enter a positive num"</span>,</span><br><span class="line">    positiveNum: <span class="string">""</span>,</span><br><span class="line">    positiveNumResTip: <span class="string">"validated and modified result: "</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    oldValidate(event) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = event.target.value;</span><br><span class="line">      <span class="keyword">let</span> reg = <span class="regexp">/^[\d]+[.]?[\d]*$/</span>;</span><br><span class="line">      <span class="keyword">let</span> newVal = <span class="built_in">Number</span>.parseFloat(value);</span><br><span class="line">      <span class="keyword">if</span> (!value.match(reg)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(newVal) || newVal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.positiveNum = newVal;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.positiveNum = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.positiveNum = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  updated() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"data updated"</span>); <span class="comment">//only triggered once</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>As explained before, you can only see <code>&#39;data updated&#39;</code> once.</p>
<p>So, how can we solved this problem?</p>
<p>The key is still the Lifecycle. Vue wouldn’t re-render because data doesn’t change. So, we can update data after data has been changed and rendered. Understood? See code below:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"app"</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span></span></span><br><span class="line"><span class="tag">      <span class="attr">type</span>=<span class="string">"text"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">"positive-num"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:value.trim</span>=<span class="string">"positiveNum"</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">input</span>=<span class="string">"newValidate"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:placeholder</span>=<span class="string">"positiveNumTip"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;positiveNumResTip&#125;&#125;&#123;&#123;positiveNum&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">"#app"</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    positiveNumTip: <span class="string">"please enter a positive num"</span>,</span><br><span class="line">    positiveNum: <span class="string">""</span>,</span><br><span class="line">    positiveNumResTip: <span class="string">"validated and modified result: "</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    oldValidate(event) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = event.target.value;</span><br><span class="line">      <span class="keyword">let</span> reg = <span class="regexp">/^[\d]+[.]?[\d]*$/</span>;</span><br><span class="line">      <span class="keyword">let</span> newVal = <span class="built_in">Number</span>.parseFloat(value);</span><br><span class="line">      <span class="keyword">if</span> (!value.match(reg)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(newVal) || newVal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">this</span>.positiveNum = newVal;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">this</span>.positiveNum = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.positiveNum = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    newValidate(event) &#123;</span><br><span class="line">      <span class="keyword">let</span> value = event.target.value;</span><br><span class="line">      <span class="keyword">let</span> reg = <span class="regexp">/^[\d]+[.]?[\d]*$/</span>;</span><br><span class="line">      <span class="keyword">this</span>.positiveNum = value;</span><br><span class="line">      <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.positiveNum.match(reg)) &#123;</span><br><span class="line">          <span class="keyword">let</span> newVal = <span class="built_in">Number</span>.parseFloat(<span class="keyword">this</span>.positiveNum);</span><br><span class="line">          <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(newVal) || newVal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.positiveNum = newVal;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.positiveNum = <span class="string">""</span>; <span class="comment">//for better use I changed the wrong value to ''</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  updated() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"data updated"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>See? I move the origin logic to the <code>this.$nextTick(callback)</code>. Every time you press the wrong button, it will pass the wrong value to <code>positiveNum</code> and will be corrected in <code>this.$nextTick(callback)</code> which will make the logic run correctly. Also, you can see the updated log at the console.</p>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://stackoverflow.com/questions/49920790/change-child-component-checked-state-from-parent-component-synchronously-fail" target="_blank" rel="noopener">change child-component checked state from parent-component synchronously fail</a></li>
</ul>
]]></content>
      <categories>
        <category>vue</category>
      </categories>
      <tags>
        <tag>$nextTick</tag>
      </tags>
  </entry>
  <entry>
    <title>Web Performance Optimization Summary in 2019.3</title>
    <url>/blog/2019/03/web-performance-optimization-summary-in-2019-3/</url>
    <content><![CDATA[<h2 id="Where-to-Learn-Web-Performance-Optimization-WPO"><a href="#Where-to-Learn-Web-Performance-Optimization-WPO" class="headerlink" title="Where to Learn Web Performance Optimization(WPO)"></a>Where to Learn Web Performance Optimization(WPO)</h2><p>About one month ago, I started to learn and summarize the knowledge about web performance optimization. However, beyond my expectations, there is too many things need to know. After thinking, I chose <a href="https://developers.google.com/web/fundamentals/performance/why-performance-matters/" target="_blank" rel="noopener">developers.google.com</a> to start to learn. And other resources are listed <a href="https://github.com/xianshenglu/blog/issues/70"><strong>here</strong></a> with this article.</p>
<p>The reasons that I chose <a href="https://developers.google.com/web/fundamentals/performance/why-performance-matters/" target="_blank" rel="noopener">developers.google.com</a> can be listed below:</p>
<ul>
<li>Articles will update when some methods or workarounds is outdated. This is extremely important for me to check it out when I need to update my knowledge about WPO. Also, it lets me know that I am learning something which can be tested and applied right now. For me, a blog is not better than a real-time updated document.</li>
<li>All the knowledge about WPO was listed systematically which is easy to understand, remember and use.</li>
</ul>
<h2 id="Summary-About-WPO"><a href="#Summary-About-WPO" class="headerlink" title="Summary About WPO"></a>Summary About WPO</h2><p>There are too many things for me to remember or test according to the doc. So, I am trying to summarize and abstract to make it simple to deduce and remember. Well, let’s start with the questions.</p>
<h3 id="What-Is-the-Target-of-WPO"><a href="#What-Is-the-Target-of-WPO" class="headerlink" title="What Is the Target of WPO"></a>What Is the Target of WPO</h3><p>To make the page load as quickly as possible, also in a progressive way if possible.</p>
<h3 id="How-Can-We-Do-That"><a href="#How-Can-We-Do-That" class="headerlink" title="How Can We Do That"></a>How Can We Do That</h3><p>Generally, we can analyze from the following aspects.</p>
<!-- #### Loading Performance -->

<ul>
<li><p>Use as much <strong>cache</strong> as possible.</p>
<ul>
<li>For a better control of cache in the front end, we may need to learn something about <code>PWA</code> or <code>Service Worker</code>.</li>
<li>Or we might need some knowledge about offline storage like <code>Indexed DB</code>, <code>Web SQL</code>, <code>localStorage</code> and so on.</li>
</ul>
</li>
<li><p>For those content that we can’t use the cache, we need to take other measures.</p>
<ul>
<li><p>Send <strong>as little content as possible</strong> which</p>
<ul>
<li><p>needs <code>code compression</code>, <code>GZIP</code>, <code>code split</code>, <code>tree shake</code>, <code>image compression</code> and remove or replace the bigger resources with smaller ones if possible.</p>
</li>
<li><p>refactor component, export, import and file structure with <code>code split</code> or routes.</p>
<!-- //todo test -->
  <!-- Don't put data based on routes or splitter in one file which would let final bundles in _app.js_. --></li>
</ul>
</li>
<li><p>Send the content <strong>as closely as possible</strong> which</p>
<ul>
<li>needs the help of <code>CDN</code>.</li>
</ul>
</li>
<li><p>Send the content <strong>simultaneously as many as possible</strong> which</p>
<ul>
<li>needs the help of <code>http/2.0</code> to breakthrough the 6 parallel TCP connections limit in http&#x2F;1.1 and request the resources simultaneously instead of one by one.</li>
</ul>
</li>
<li><p>Load the resource <strong>in a more efficient way</strong> which</p>
<ul>
<li><p>needs to put <code>script</code> at the bottom of <code>body</code></p>
</li>
<li><p>use the <code>async</code> or <code>defer</code> according to the situation</p>
</li>
<li><p>use <code>prefetch</code>, <code>preconnect</code> or <code>dns-prefetch</code> according to the situation</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- #### Rendering Performance -->

<ul>
<li><p><strong>Render the page in a more efficient way</strong> which requires more efficient practice in our daily code. For examples,</p>
<ul>
<li><p>Use <code>requestAnimationFrame</code> to change the UI instead of <code>setTimeout</code> or <code>setInterval</code>.</p>
</li>
<li><p>Implement lazy load with <code>Intersection Observer</code> instead of calculating the position of each target element by <code>getBoundingClientRect</code>.</p>
</li>
<li><p>Stick to compositor-only properties like <code>transform</code> and <code>opacity</code> to avoid re-layout and re-paint.</p>
</li>
<li><p>Reduce the complexity of selectors.</p>
</li>
<li><p>….</p>
</li>
</ul>
</li>
</ul>
<h3 id="How-Can-We-Prove-That-Our-Optimization-Is-Work"><a href="#How-Can-We-Prove-That-Our-Optimization-Is-Work" class="headerlink" title="How Can We Prove That Our Optimization Is Work"></a>How Can We Prove That Our Optimization Is Work</h3><p>We need some tools like below to collect the result each time we did an optimization.</p>
<ul>
<li><a href="https://developers.google.com/web/tools/lighthouse/" target="_blank" rel="noopener">Lighthouse</a></li>
<li><a href="https://www.webpagetest.org/easy" target="_blank" rel="noopener">WebPageTest</a></li>
<li><a href="https://developers.google.com/speed/pagespeed/insights/" target="_blank" rel="noopener">PageSpeed Insights</a></li>
<li>……</li>
</ul>
<h3 id="Strictly"><a href="#Strictly" class="headerlink" title="Strictly"></a>Strictly</h3><p>Strictly speaking, if we want to do WPO seriously for a long time, we still need to do something like:</p>
<ul>
<li>Set a performance budget</li>
<li>Use <code>performance</code> or google analysis tool to get the performance data in the real scene.</li>
<li>…</li>
</ul>
<h2 id="Last-Words"><a href="#Last-Words" class="headerlink" title="Last Words"></a>Last Words</h2><p>Here is just a summary about WPO. More accurate information is in <a href="https://developers.google.com/web/fundamentals/performance/why-performance-matters/" target="_blank" rel="noopener">developers.google.com</a>.</p>
<p><a href="https://github.com/xianshenglu/blog/issues/70"><strong>Source</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>Web Performance Optimization</category>
      </categories>
      <tags>
        <tag>performance</tag>
        <tag>browser</tag>
        <tag>LightHouse</tag>
      </tags>
  </entry>
  <entry>
    <title>Differences between Node.js env and user environment variables</title>
    <url>/blog/2023/09/what-are-we-doing-when-we-are-changing-environment-variables/</url>
    <content><![CDATA[<p>We often use <code>process.env</code> to manage environment variables in front-end or Node.js projects.</p>
<h3 id="How-the-env-works-in-the-front-end"><a href="#How-the-env-works-in-the-front-end" class="headerlink" title="How the env works in the front-end"></a>How the env works in the front-end</h3><p>In lots of cases, we’re using <code>dotenv</code> or <code>cross-env</code> to manage environment variables.</p>
<p>If you check the source code of <a href="https://github.com/motdotla/dotenv"><code>dotenv</code></a>, you will find that it assigns all the defined env variables to the <code>process.env</code>.</p>
<p><img src="/blog/images/what-are-we-doing-when-we-are-changing-environment-variables-image.png" alt="Alt text"></p>
<p>According to the document of <a href="https://nodejs.org/dist/latest-v8.x/docs/api/process.html#process_process_env" target="_blank" rel="noopener">Node.js</a>.</p>
<blockquote>
<p>It is possible to modify this object(<code>process.env</code>), but <strong>such modifications will not be reflected outside the Node.js process</strong>.</p>
</blockquote>
<p>And <a href="https://github.com/kentcdodds/cross-env">cross-env</a> will pass the target env to <code>cross-spawn</code> to launch a child process.</p>
<p><img src="/blog/images/what-are-we-doing-when-we-are-changing-environment-variables-image-3.png" alt="Alt text"></p>
<p><img src="/blog/images/what-are-we-doing-when-we-are-changing-environment-variables-image-2.png" alt="Alt text"></p>
<blockquote>
<p>The <code>child_process.spawn()</code> method spawns a new process using the given command, with command line arguments in args.</p>
</blockquote>
<p>In conclusion, the env variables set by <code>dotenv</code> or <code>cross-env</code> are only visible in the running Node.js process.</p>
<p>But it doesn’t matter normally because the env is set in the same process as the app or the app is running in a child process with the target env.</p>
<p>Thus <strong>if you open the Windows system environment variable dialog when your app is running, you will not see the defined env</strong> because it’s out of the app process.</p>
<p>If you set env by <code>$env:TEST_ENV=dev</code> in PowerShell or <code>set TEST_ENV=dev</code> in cmd, you will not get the expected value in another shell or cmd by <code>$env:TEST_ENV</code> or <code>echo &quot;%TEST_ENV%&quot;</code>.</p>
<h3 id="Change-the-env-variable-like-editing-in-the-Windows-“environment-variable-dialog”"><a href="#Change-the-env-variable-like-editing-in-the-Windows-“environment-variable-dialog”" class="headerlink" title="Change the env variable like editing in the Windows “environment variable dialog”"></a>Change the env variable like editing in the Windows “environment variable dialog”</h3><p>If you want to do this, you can use <code>setx TEST_ENV dev</code> in Powershell or cmd. Then <strong>open a new process(not a new child process)</strong> you will get the new <code>TEST_ENV</code> value.</p>
<p>For example, if you change the env out of vscode, you need to restart the vscode. Otherwise, even if you open a new shell in the vscode, you still can’t see the new env value.</p>
<p>If you don’t want to restart vscode you can use <code>refreshenv</code> in the vscode powershell or cmd after installing <a href="https://chocolatey.org/install" target="_blank" rel="noopener">chocolatey</a>(<em>Package Manager for Windows</em>). For example,</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$env:TEST_ENV</span>  <span class="comment"># dev</span></span><br><span class="line">setx TEST_ENV prod</span><br><span class="line"><span class="variable">$env:TEST_ENV</span>  <span class="comment"># dev, not change</span></span><br><span class="line">refreshenv</span><br><span class="line"><span class="variable">$env:TEST_ENV</span> <span class="comment"># prod, changed</span></span><br></pre></td></tr></table></figure>

<p>Since we can use <code>setx</code> to set the env variable permanently, we can also let Node.js execute the <code>setx</code> command. For example,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; spawnSync &#125; = <span class="built_in">require</span>(<span class="string">"child_process"</span>);</span><br><span class="line">spawnSync(<span class="string">'setx'</span>, [<span class="string">'-m'</span>, <span class="string">'TEST_ENV'</span>, <span class="string">'prod'</span>]);</span><br></pre></td></tr></table></figure>

<p>In the script,</p>
<blockquote>
<p>The <code>child_process.spawnSync()</code> method is generally identical to <code>child_process.spawn()</code> with the exception that the function will not return until the child process has fully closed.</p>
</blockquote>
<p><a href="https://github.com/xianshenglu/blog/issues/150"><strong>Issue</strong></a></p>
<p><a href="https://github.com/xianshenglu/blog/blob/master/source/_posts/what-are-we-doing-when-we-are-changing-environment-variables.md"><strong>Source</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>TBD</tag>
      </tags>
  </entry>
  <entry>
    <title>What Is the background-color&#39;s Height of Inline Non-Replaced Element?</title>
    <url>/blog/2018/05/what-is-the-background-color-height-of-inline-non-replaced-element/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>As we all know, when we set <code>background-color</code> in block-level non-replaced elements, the height of <code>background-color</code> is equal to <code>border-top</code>+<code>padding-top</code>+<code>height</code>+<code>padding-bottom</code>+<code>border-bottom</code> according to box-model which is very clear.</p>
<h2 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h2><p>However, things get weird when we set <code>background-color</code> to inline non-replaced element because <code>height</code> doesn’t apply to the element. For example:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inline"</span>&gt;</span></span><br><span class="line">  inline non-replaced element</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: Microsoft YaHei;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.inline</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/20180517161430.png" alt="20180517161430.png"></p>
<p>So, here is the question,</p>
<ul>
<li>Assume there is no <code>margin</code> and <code>padding</code>,how much is the size of the <code>background-color</code> area which is also the content area ?any rules?</li>
</ul>
<p>And here is the answer I figured out:</p>
<ul>
<li>It depends.</li>
</ul>
<p>Then we are going to talk a lot about how it depends.</p>
<p>If we measured the direction as the screenshot above ,we can get some data below, called Case A :</p>
<ul>
<li>font-size:40px</li>
<li>background-color’s height : about 50px</li>
<li>top&#x2F;bottom space : about 15px</li>
</ul>
<p>May be you thought that those data should be like these, called Case B :</p>
<ul>
<li>font-size:40px</li>
<li>background-color’s height : about 40px</li>
<li>top&#x2F;bottom space : about 20px, equals to half-leading</li>
</ul>
<p>It seems Case B is more reasonable.</p>
<p>However, the fact is that Case A is applied until Chrome-66.</p>
<p>Anyway, <code>line-height</code> is definitive, always 80px.</p>
<p>After reading <a href="https://www.w3.org/TR/2011/REC-CSS2-20110607/visudet.html#inline-non-replaced" target="_blank" rel="noopener">10.6.1 Inline, non-replaced elements</a> in CSS2.1 and SO, I think the point is below:</p>
<blockquote>
<p>The ‘height’ property does not apply. The height of the content area should be based on the font, but this specification does not specify how. A UA may, e.g., use the em-box or the maximum ascender and descender of the font.</p>
</blockquote>
<blockquote>
<p>(The latter would ensure that glyphs with parts above or below the em-box still fall within the content area, but leads to differently sized boxes for different fonts; the former would ensure authors can control background styling relative to the ‘line-height’, but leads to glyphs painting outside their content area.)</p>
</blockquote>
<p>According to the specification above, I think that Case B means</p>
<blockquote>
<p>A UA use the em-box which would ensure authors can control background styling relative to the ‘line-height’, but leads to glyphs painting outside their content area.</p>
</blockquote>
<p>while Case A means</p>
<blockquote>
<p>A UA use the maximum ascender and descender of the font which would ensure that glyphs with parts above or below the em-box still fall within the content area, but leads to differently sized boxes for different fonts.</p>
</blockquote>
<p>Then, I try to prove it with different fonts which will lead differently sized boxes according to specification above.</p>
<p>For example, change <code>font-family</code>from <code>Microsoft YaHei</code>to<code>Georgia</code>:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"inline"</span>&gt;</span>inline non-replaced element <span class="tag">&lt;<span class="name">br</span> /&gt;</span>sss<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: Georgia;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.inline</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/blog/images/20180517162130.png" alt="20180517162130.png"></p>
<p>As you can see ,these data becomes:</p>
<ul>
<li>font-size:40px</li>
<li>background-color’s height : about 46px</li>
<li>top space : about 15px</li>
<li>bottom space: about 19px</li>
</ul>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>So, precisely, assuming that there is no <code>margin</code> and <code>padding</code>,we can say that background-color’s height of inline non-replaced element is</p>
<ul>
<li>determined by <code>font-size</code></li>
<li>and modified partially by <code>font-family</code> which depends on the rules UA takes.</li>
</ul>
<p>And also the area outside of the <code>background-color</code> area isn’t equal to half-leading.</p>
<p>Reference:</p>
<p><a href="https://stackoverflow.com/questions/28363186/inline-elements-and-line-height" target="_blank" rel="noopener">Inline elements and line-height</a></p>
<p><a href="https://iamvdo.me/en/blog/css-font-metrics-line-height-and-vertical-align" target="_blank" rel="noopener">Deep dive CSS: font metrics, line-height and vertical-align
</a></p>
<p><a href="https://segmentfault.com/q/1010000020023014/a-1020000020036595" target="_blank" rel="noopener">这个 div 的 10px 是哪里来的能帮我看一下吗？</a></p>
]]></content>
      <categories>
        <category>css</category>
      </categories>
      <tags>
        <tag>background-color</tag>
        <tag>inline non-replaced element</tag>
        <tag>content area</tag>
      </tags>
  </entry>
  <entry>
    <title>WheelEvent Compatibility and Delta Handler</title>
    <url>/blog/2019/01/wheelevent-compatibility-and-delta-handler/</url>
    <content><![CDATA[<p>I have seen many times people talking about the compatibility problems of wheelEvent, something about <code>wheel</code>, <code>DOMMouseScroll</code>, <code>mousewheel</code> etc. But now, it seems we don’t need to care about those compatibility problems anymore.</p>
<p>As <a href="https://developer.mozilla.org/en-US/docs/Web/Events/wheel#Browser_compatibility" target="_blank" rel="noopener">mdn</a> shows, <strong>IE9 support <code>wheel</code> event in <code>addEventListener</code> and <code>DOMMouseScroll</code> is only needed for Firefox 17-</strong>. And for other major browsers, they all support <code>wheel</code> event.</p>
<p>But, there are other problems still need to take care.</p>
<h3 id="delta"><a href="#delta" class="headerlink" title="delta"></a><code>delta</code></h3><p><code>event.delta</code> returns different numbers in the major browsers. For instance, if you run the code below at your console in some page,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'wheel'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.deltaY)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>then moving your mouse wheel, you will see the <code>deltaY</code> numbers.</p>
<table>
<thead>
<tr>
<th>browsers&#x2F;win7</th>
<th>deltaY</th>
</tr>
</thead>
<tbody><tr>
<td>Chrome 70</td>
<td>100</td>
</tr>
<tr>
<td>Firefox 64</td>
<td>3</td>
</tr>
<tr>
<td>IE 11</td>
<td>88.19</td>
</tr>
</tbody></table>
<p>Well, you can find a solution to unify the <code>deltaY</code>. But I think the easier way is to give up unifying and only do the accumulation job. For example, try the code below:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> wheelSize = <span class="number">0</span></span><br><span class="line"><span class="built_in">document</span>.body.addEventListener(<span class="string">'wheel'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  wheelSize += event.deltaY &gt; <span class="number">0</span> ? <span class="number">0.025</span> : <span class="number">-0.025</span></span><br><span class="line">  <span class="built_in">console</span>.log(wheelSize, event.deltaY)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>In this way, we will get the unified <code>wheelSize</code>.</p>
<h3 id="More-Situations-Need-to-Watch-Out"><a href="#More-Situations-Need-to-Watch-Out" class="headerlink" title="More Situations Need to Watch Out"></a>More Situations Need to Watch Out</h3><p>When used in projects, there are more things we need to watch out. For example,</p>
<ul>
<li>We might have <code>wheelSize</code> limit.</li>
<li>We might want to prevent calculating <code>wheelSize</code> when the page has been scrolled to the top or the bottom.</li>
<li>…</li>
</ul>
<p>And the code would become more complicated. For instance,</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> targetNode = <span class="built_in">document</span>.body</span><br><span class="line"><span class="keyword">let</span> curWheelSize = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> minWheelSize = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> maxWheelSize = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> minScrollTop = <span class="number">0</span></span><br><span class="line"><span class="keyword">let</span> maxScrollTop =</span><br><span class="line">  targetNode.parentNode.scrollHeight - targetNode.parentNode.offsetHeight</span><br><span class="line">targetNode.addEventListener(<span class="string">'wheel'</span>, wheelCb)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wheelCb</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> isDeltaYPositive = event.deltaY &gt; <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> scrollTop = targetNode.parentNode.scrollTop</span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line">    (scrollTop &lt;= minScrollTop &amp;&amp; !isDeltaYPositive) ||</span><br><span class="line">    (scrollTop &gt;= maxScrollTop &amp;&amp; isDeltaYPositive)</span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> stepSize = isDeltaYPositive ? <span class="number">0.025</span> : <span class="number">-0.025</span></span><br><span class="line">  <span class="keyword">let</span> targetWheelSize = curWheelSize + stepSize</span><br><span class="line">  targetWheelSize = <span class="built_in">Math</span>.max(targetWheelSize, minWheelSize)</span><br><span class="line">  targetWheelSize = <span class="built_in">Math</span>.min(targetWheelSize, maxWheelSize)</span><br><span class="line">  curWheelSize = targetWheelSize</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/xianshenglu/blog/issues/58"><strong>Original Post</strong></a></p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2>]]></content>
      <categories>
        <category>js</category>
      </categories>
      <tags>
        <tag>WheelEvent</tag>
        <tag>delta</tag>
        <tag>wheel</tag>
        <tag>DOMMouseScroll</tag>
        <tag>mousewheel</tag>
      </tags>
  </entry>
  <entry>
    <title>When and How to Use Frame?</title>
    <url>/blog/2018/06/when-and-how-to-use-frame/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>There has been a long time that I don’t know whether should I use frame like <code>jQuery</code> or still stick to pure js. So, I decided to summarize some principles for future reference.</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><h4 id="Before-using"><a href="#Before-using" class="headerlink" title="Before using"></a>Before using</h4><ol>
<li>Figure out the problem that the frame solved?</li>
<li>Figure out what kind of situation the frame would be useful, similar with above.</li>
<li>Why would so many people use this not other similar frames?</li>
<li>How many parts in the frame?</li>
<li>What is the relationship between those parts?</li>
</ol>
<h4 id="When-should-use"><a href="#When-should-use" class="headerlink" title="When should use"></a>When should use</h4><ul>
<li>Needed in work.</li>
<li>Emancipate the productive forces based on the fact that you can solve this with ease by pure js.</li>
</ul>
<h4 id="When-shouldn’t-use"><a href="#When-shouldn’t-use" class="headerlink" title="When shouldn’t use"></a>When shouldn’t use</h4><ul>
<li>Don’t need in work and you don’t know how to implement it with pure js and use it just for laze.</li>
<li>Need it in work and just use it without understanding the principle.</li>
</ul>
<h2 id="Recommendation"><a href="#Recommendation" class="headerlink" title="Recommendation"></a>Recommendation</h2><ul>
<li>You can implement it with pure js easily so that you want to use it to emancipate the productive forces.</li>
<li>In need of other situation, you have to implement it immediately so you use it and figure out the principle as soon as possible in case of bugs.</li>
</ul>
]]></content>
      <categories>
        <category>frame</category>
      </categories>
  </entry>
  <entry>
    <title>X-UA-Compatible and ie=edge</title>
    <url>/blog/2018/10/x-ua-compatible-and-ie-edge/</url>
    <content><![CDATA[<h2 id="Preface"><a href="#Preface" class="headerlink" title="Preface"></a>Preface</h2><p>平时会用 vue 写新项目，老项目就在原有基础上更新。对于 vue 这种框架，使用官方的脚手架通常就避免了很多问题，就像平时用模板创建新的单页一样。</p>
<p>然而有时总是会遇到些不按模板走的代码，虽然跑起来也没有问题，但是放到有些浏览器上就有 bug 了，这个时候对既有模板的理解和掌握就很重要了。</p>
<h2 id="Main"><a href="#Main" class="headerlink" title="Main"></a>Main</h2><p>当我用 html 模板创建一个新单页时，拿到的页面是这样的，vue 也是类似，至少三个 <code>meta</code> 标签基本都是一样的：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>viewport</code> 是在兼容移动端时才了解的内容，费了不少功夫。而 <code>X-UA-Compatible</code> 则是在遇到非常规代码的时候才想起来的。有一回改个老项目，用了 <code>transform</code>，在 ie11 上测试，没有用，而且在它的工具栏里样式表里根本看不到我写的代码，这个时候我就好奇了，这是 ie11 啊，怎么会不支持 <code>transform</code> 呢？然后我瞄了一下开发者工具，大概是这样的：</p>
<p><img src="/blog/images/%E6%88%AA%E5%9B%BE20181003201618.png" alt="截图20181003201618.png"></p>
<p>然后我就好奇了，为什么会是 ie7 模式呢？我明明装的是 ie11 浏览器啊，然后脑袋一闪，好像明白了什么，看了看 <code>html</code> ，果然没有:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>加上之后，再刷新，网页就正常了。</p>
<p>在这件事之前，我知道这个东西，但是因为是用的模板，一直没有遇到过这个问题，而且通常来说，我会以为，我既然是在 ie11 里打开的，默认你也没有理由用 ie11- 的文档模式去渲染啊，结果就错了。后来看到 SO 上高票答主大概是这么解释 ie 的行为的：</p>
<p><em>ie 会用它认为最好的方式去渲染页面，如果没有上面那行代码的话</em></p>
<p>此外，ie11 已经开始废弃上面那个了，如果不兼容 ie 的话，其实上面的代码也可以不用写了，不过目前为止 html 模板和 vue 的模板都还是默认支持的。而上面的那行代码实际意思呢，就是：</p>
<p><em>Edge：始终以最新的文档模式来渲染页面。忽略文档类型声明。对于 IE8，始终保持以 IE8 标准模式渲染页面。对于 IE9，则以 IE9 标准模式渲染页面。</em></p>
<p>当然 ie 还可以等于其他值，不过其他值大多都是老版本，目前而言，都没有必要去纠结了，譬如：</p>
<ul>
<li>“IE&#x3D;edge”</li>
<li>“IE&#x3D;11”</li>
<li>“IE&#x3D;EmulateIE11”</li>
<li>“IE&#x3D;10”</li>
<li>“IE&#x3D;EmulateIE10”</li>
<li>“IE&#x3D;9”</li>
<li>“IE&#x3D;EmulateIE9</li>
<li>…</li>
</ul>
<h2 id="Ending"><a href="#Ending" class="headerlink" title="Ending"></a>Ending</h2><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://stackoverflow.com/questions/6771258/what-does-meta-http-equiv-x-ua-compatible-content-ie-edge-do" target="_blank" rel="noopener">What does &lt;meta http-equiv&#x3D;“X-UA-Compatible” content&#x3D;“IE&#x3D;edge”&gt; do?</a></li>
</ul>
]]></content>
      <categories>
        <category>html</category>
      </categories>
      <tags>
        <tag>meta</tag>
        <tag>content</tag>
        <tag>http-equiv</tag>
        <tag>X-UA-Compatible</tag>
        <tag>ie=edge</tag>
      </tags>
  </entry>
</search>
