<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/blog/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/blog/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/blog/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/blog/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/blog/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hey , you !">
<meta property="og:url" content="https://github.com/xianshenglu/blog/page/12/index.html">
<meta property="og:site_name" content="Hey , you !">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hey , you !">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/blog/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://github.com/xianshenglu/blog/page/12/"/>





  <title>Hey , you !</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/blog/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hey , you !</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/blog/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/blog/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/blog/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/blog/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/xianshenglu/blog/blog/2018/06/layout-on-mobile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xianshenglu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/23273077">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey , you !">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/06/layout-on-mobile/" itemprop="url">Layout On Mobile</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-15T19:03:50+08:00">
                2018-06-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/css/" itemprop="url" rel="index">
                    <span itemprop="name">css</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1,820
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>Preface</h2>
<p>Based on <a href="../first-exploration-on-mobile/">first-exploration-on-mobile</a> we can develop adaptive pages on mobile. Now, let's do it.</p>
<h2>Main</h2>
<h3>Basic Code</h3>
<p>Suppose that we got the PSD which is designed according to iPhone6. So, what do we have now?</p>
<ul>
<li>width:375*667</li>
<li>DPR:2</li>
</ul>
<p>So, let's develop according to iPhone6 first. And this is the basic code:</p>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=375,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="comment">/* reset.css */</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    * &#123;</span></span><br><span class="line"><span class="undefined">      margin: 0;</span></span><br><span class="line"><span class="undefined">      padding: 0;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    html,</span></span><br><span class="line"><span class="undefined">    body &#123;</span></span><br><span class="line"><span class="undefined">      height: 100%;</span></span><br><span class="line"><span class="undefined">      width: 100%;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    li &#123;</span></span><br><span class="line"><span class="undefined">      list-style: none;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">    a &#123;</span></span><br><span class="line"><span class="undefined">      text-decoration: none;</span></span><br><span class="line"><span class="undefined">      color: inherit;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="comment">/* base.css */</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.nav</span>,</span></span><br><span class="line"><span class="css">    <span class="selector-class">.nav__list</span> &#123;</span></span><br><span class="line"><span class="undefined">      width: 100%;</span></span><br><span class="line"><span class="undefined">      height: 100%;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.nav__list</span> &#123;</span></span><br><span class="line"><span class="undefined">      background-color: pink;</span></span><br><span class="line"><span class="undefined">      overflow: hidden;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.nav__item</span> &#123;</span></span><br><span class="line"><span class="undefined">      width: 65px;</span></span><br><span class="line"><span class="undefined">      height: 40px;</span></span><br><span class="line"><span class="undefined">      line-height: 40px;</span></span><br><span class="line"><span class="undefined">      margin: 5px;</span></span><br><span class="line"><span class="undefined">      float: left;</span></span><br><span class="line"><span class="undefined">      background-color: yellowgreen;</span></span><br><span class="line"><span class="undefined">      color: white;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="css">    <span class="selector-class">.nav__link</span> &#123;</span></span><br><span class="line"><span class="undefined">      display: block;</span></span><br><span class="line"><span class="undefined">      width: 100%;</span></span><br><span class="line"><span class="undefined">      height: 100%;</span></span><br><span class="line"><span class="undefined">      text-align: center;</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"nav"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav__list"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav4<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"nav__item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">class</span>=<span class="string">"nav__link"</span>&gt;</span>nav5<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Well, I made a simple one just for test. Hope you don't mind. If we switch to iPhone6 device, it looks okay.</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180616161355.png" alt=""></p>
<p>Of course it will be terrible if we switch to other devices. For example, iPhone6 Plus:</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180616161446.png" alt=""></p>
<p>We got extra space on the right because the width of iPhone6 Plus is 414px which is wider than 375px in iPhone6.</p>
<p><strong>Please notice that we have used 65px, 40px and 5px in the css. Those values should be zoomed according to the device-width.</strong></p>
<p>So, here is the way how we fix this:</p>
<h3>Adaptive by rem and js</h3>
<p>We need do some transform to use rem. On iPhone6 with 375px and DPR:2,</p>
<ol>
<li>We can use 65px, 40px, 5px with:</li>
</ol>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=375,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>We can also use 130px, 80px, 10px with:</li>
</ol>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=750,initial-scale=0.5"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>Further on, if we calculate rem by (device-width*DPR)/10:</li>
</ol>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--width=750=375*DPR,initial-scale=0.5=1/DPR--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=750,initial-scale=0.5"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="comment">/*75px = device-width * DPR / 10 */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">75px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="comment">/*32px = 16px * DPR */</span></span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">32px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Those numbers would be:</p>
<ul>
<li>65px =&gt; (65/375) * device-width =&gt; (65/375) * 10rem</li>
<li>40px =&gt; (40/375) * device-width =&gt; (40/375) * 10rem</li>
<li>5px =&gt; (5/375) * device-width =&gt; (5/375) * 10rem</li>
</ul>
<p>In fact, options above will get the same effect. But for option3, <strong>we make everything connected with DPR and device-width.</strong></p>
<p>So, here is the basic logic to be adaptive:</p>
<ol>
<li>We use the device-width*DPR/10 to calculate <code>rem</code> and set it on <code>html</code>.</li>
<li>We set (initial font-size * DPR) on <code>body</code>.</li>
<li>For <code>font-size</code> set with px, we have to set different font-size for different DPR by <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/-webkit-device-pixel-ratio" target="_blank" rel="noopener">@media/-webkit-device-pixel-ratio</a> or plugins(e.g. less).</li>
<li>We update <code>meta</code> by setting the <code>width</code> as device-width*DPR and <code>initial-scale</code> as 1/DPR which would make the page render in device-width*DPR and then scale to device-width.</li>
</ol>
<p>Well, you can just see the code:</p>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(</span></span><br><span class="line"><span class="javascript">      <span class="string">'DOMContentLoaded'</span>,</span></span><br><span class="line"><span class="undefined">      () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> dpr = <span class="built_in">window</span>.devicePixelRatio</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> html = <span class="built_in">document</span>.documentElement</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> body = <span class="built_in">document</span>.body</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> deviceWidth = <span class="built_in">window</span>.innerWidth || html.clientWidth</span></span><br><span class="line"><span class="javascript">        html.style.fontSize = (deviceWidth * dpr) / <span class="number">10</span> + <span class="string">'px'</span></span></span><br><span class="line"><span class="javascript">        html.setAttribute(<span class="string">'data-dpr'</span>, dpr)</span></span><br><span class="line"><span class="javascript">        body.style.fontSize = <span class="string">'initial'</span></span></span><br><span class="line"><span class="javascript">        body.style.fontSize = <span class="built_in">parseInt</span>(getComputedStyle(body).fontSize) * dpr + <span class="string">'px'</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> metaViewport = <span class="built_in">document</span>.querySelector(<span class="string">'meta[name=viewport]'</span>)</span></span><br><span class="line"><span class="undefined">        metaViewport.setAttribute(</span></span><br><span class="line"><span class="javascript">          <span class="string">'content'</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">`width=<span class="subst">$&#123;dpr * deviceWidth&#125;</span>,initial-scale=<span class="subst">$&#123;<span class="number">1</span> <span class="regexp">/ dpr&#125;`</span></span></span></span></span><br><span class="line"><span class="undefined">        )</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="javascript">      &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;,</span></span><br><span class="line"><span class="javascript">      <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">    )</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet/less"</span> <span class="attr">href</span>=<span class="string">"./less.less"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdnjs.cloudflare.com/ajax/libs/less.js/3.0.2/less.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>base.css in <em>less.less</em></p>
<p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* base.css */</span></span><br><span class="line"><span class="selector-class">.px2px</span>(<span class="variable">@name</span>, <span class="variable">@px</span>) &#123;</span><br><span class="line">  <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span>) * <span class="number">1px</span>;</span><br><span class="line">  <span class="selector-attr">[data-dpr='2']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span>*<span class="number">2</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for mx3</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.5']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.5</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//for Pixel2</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.625']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.625</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for XiaoMi note</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.75']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.75</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-attr">[data-dpr='3']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">3</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//for Pixel2 XL</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='3.5']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">3.5</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for Samsung note4</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='4']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: <span class="variable">@px</span> * <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">  <span class="comment">//suggest use em not px otherwise have to set different font-size for different DPR</span></span><br><span class="line">  <span class="selector-class">.px2px</span>(font-size, <span class="number">16px</span>);</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__list</span> &#123;</span><br><span class="line">  <span class="comment">// width: 110%;</span></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="comment">// for inline-block</span></span><br><span class="line">  <span class="comment">// white-space: nowrap;</span></span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">  <span class="comment">// letter-spacing: -0.3em;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__item</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="comment">// display: inline-block;</span></span><br><span class="line">  <span class="comment">// letter-spacing: normal;</span></span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">65</span>/<span class="number">375</span> * <span class="number">10rem</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">10rem</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5</span>/<span class="number">375</span> * <span class="number">10rem</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">10rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__link</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Code above will work in Apple's product. However, when we switch to Pixel 2 we will find this:</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180617130210.png" alt=""></p>
<p>After a little calculation, I find that the total width of 5 <code>navs</code> is 1078.85 while width of <code>.nav__list</code> is 1078. Well, I think it is reasonable though I hate this.</p>
<p>In this case, we have to do something else to fix this. For example:</p>
<ul>
<li>Set <code>margin-right:auto</code> on the last nav.</li>
<li>Set wider <code>width</code> of <code>.nav__list</code> and set <code>overflow:hidden</code> on <code>.nav</code>.</li>
<li>Use <code>width:20%</code> and <code>padding</code> instead of <code>margin</code>.</li>
<li>Other css tricks.</li>
</ul>
<p>Anyway, this is the previous solution for adaptation on mobile before appearance of <code>vw</code>,<code>flex</code> and <code>grid</code> layout.</p>
<p>Let's make a conclusion:</p>
<ul>
<li>principle</li>
</ul>
<ol>
<li>Set different font-size for different DPR by less.</li>
<li>Use viewport scale to solve the problem of 1px on border and font-size.</li>
<li>Make the width and height of element connect with device-width by <code>rem</code>.</li>
</ol>
<ul>
<li>pro</li>
</ul>
<ol>
<li>Fix 1px problem on <code>border</code> because we set 1px on device*DPR.</li>
</ol>
<ul>
<li>con</li>
</ul>
<ol>
<li>We have to set lots of <code>font-size</code> based on DPR every time we want to set <code>font-size</code> with px. Though we can simplify our job by preprocessor(e.g. less). However, how we going to do with more and more DPR?</li>
</ol>
<p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.px2px</span>(<span class="variable">@name</span>, <span class="variable">@px</span>) &#123;</span><br><span class="line">  <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span>) * <span class="number">1px</span>;</span><br><span class="line">  <span class="selector-attr">[data-dpr='2']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span>*<span class="number">2</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for mx3</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.5']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.5</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//for Pixel2</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.625']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.625</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for XiaoMi note</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='2.75']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">2.75</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-attr">[data-dpr='3']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">3</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//for Pixel2 XL</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='3.5']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: round(<span class="variable">@px</span> * <span class="number">3.5</span>) * <span class="number">1px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// for Samsung note4</span></span><br><span class="line">  <span class="selector-attr">[data-dpr='4']</span> <span class="selector-tag">&amp;</span> &#123;</span><br><span class="line">    <span class="attribute">@&#123;name&#125;</span>: <span class="variable">@px</span> * <span class="number">4px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Write more and more? That's not a good idea.</p>
<p><strong>If we use <code>em</code> instead it will not be a problem because we already set the initial font-size * DPR on <code>body</code>.</strong></p>
<ol start="2">
<li>Decimals appear which may cause a little problem in layout.</li>
</ol>
<h3>Adaptive by vw</h3>
<p>Before we start with <code>vw</code> let's take a look at the rem and js solution. So, do we have a <strong>better</strong> solution for:</p>
<ol>
<li>border 1px problem? I don't think so.</li>
<li>make the width and height of element connect with device-width? Yes, we do have <code>vw</code>, <code>vh</code> even <code>vmin</code> and <code>vmax</code>.</li>
</ol>
<p>And for the con of the rem and js solution:</p>
<ol>
<li><strong>In this case, we can use <code>rem</code> instead of <code>em</code> because <code>rem</code> works more like <code>px</code> than <code>em</code></strong></li>
<li>Can we avoid the decimals ? May be not with <code>vw</code> but won't be worse than <code>rem</code>.</li>
</ol>
<p>Anyway, here is the code:</p>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.addEventListener(</span></span><br><span class="line"><span class="javascript">      <span class="string">'DOMContentLoaded'</span>,</span></span><br><span class="line"><span class="undefined">      () =&gt; &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> dpr = <span class="built_in">window</span>.devicePixelRatio</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> html = <span class="built_in">document</span>.documentElement</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> body = <span class="built_in">document</span>.body</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> deviceWidth = <span class="built_in">window</span>.innerWidth || html.clientWidth</span></span><br><span class="line"><span class="javascript">        html.setAttribute(<span class="string">'data-dpr'</span>, dpr)</span></span><br><span class="line"><span class="javascript">        html.style.fontSize = <span class="string">'initial'</span></span></span><br><span class="line"><span class="javascript">        html.style.fontSize = <span class="built_in">parseInt</span>(getComputedStyle(html).fontSize) * dpr + <span class="string">'px'</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> metaViewport = <span class="built_in">document</span>.querySelector(<span class="string">'meta[name=viewport]'</span>)</span></span><br><span class="line"><span class="undefined">        metaViewport.setAttribute(</span></span><br><span class="line"><span class="javascript">          <span class="string">'content'</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">`width=<span class="subst">$&#123;dpr * deviceWidth&#125;</span>,initial-scale=<span class="subst">$&#123;<span class="number">1</span> <span class="regexp">/ dpr&#125;`</span></span></span></span></span><br><span class="line"><span class="undefined">        )</span></span><br><span class="line"><span class="undefined">      &#125;,</span></span><br><span class="line"><span class="javascript">      &#123; <span class="attr">capture</span>: <span class="literal">true</span> &#125;,</span></span><br><span class="line"><span class="javascript">      <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">    )</span></span><br><span class="line"><span class="undefined">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet/less"</span> <span class="attr">href</span>=<span class="string">"./less.less"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://cdnjs.cloudflare.com/ajax/libs/less.js/3.0.2/less.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>base.css in <em>less.less</em></p>
<p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* base.css */</span></span><br><span class="line"><span class="selector-class">.nav</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1rem</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__list</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__item</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">65</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">5</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__link</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>I tested every device in chrome device-mode. They all work.</p>
<p><strong>However, there are still decimals which might bite you someday.</strong></p>
<p>Anyway, let's make a conclusion:</p>
<ul>
<li>principle</li>
</ul>
<ol>
<li>Make the font-size connect with dpr by <code>rem</code>.</li>
<li>Use viewport scale to solve the problem of 1px on border and font-size.</li>
<li>Make the width and height of element connect with device-width by <code>vw</code>.</li>
</ol>
<ul>
<li>pro</li>
</ul>
<ol>
<li>Border 1px problem is solved as before.</li>
<li>Decimals problem will be a litter better than rem and js solution.</li>
</ol>
<ul>
<li>con</li>
</ul>
<ol>
<li>Decimals still exist.</li>
</ol>
<h3>Adaptive by vw and flex</h3>
<p>Solution with vw almost perfect except the decimals. So, how we are going to fix that? <code>Flex</code> gave us a choice.</p>
<p><strong>We can leave the decimals to browser by <code>flex</code>.</strong></p>
<p><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*part of css which has been modified*/</span></span><br><span class="line"><span class="selector-class">.nav__list</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">  <span class="attribute">display</span>: flex; <span class="comment">/*new added*/</span></span><br><span class="line">  <span class="attribute">justify-content</span>: space-around; <span class="comment">/*new added*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.nav__item</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">  <span class="attribute">background-color</span>: yellowgreen;</span><br><span class="line">  <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> auto; <span class="comment">/*new added*/</span></span><br><span class="line"></span><br><span class="line">  <span class="attribute">width</span>: <span class="number">65</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">40</span>/<span class="number">375</span> * <span class="number">100vw</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>If you don't know something about flex, please check MDN. Anyway, we can leave decimals to browser. That is the most exciting part.</p>
<p>Well, let's make a conclusion:</p>
<ul>
<li>principle</li>
</ul>
<ol>
<li>Make the font-size connect with dpr by <code>rem</code>.</li>
<li>Use viewport scale to solve the problem of 1px on border and font-size.</li>
<li>Make the width and height of element connect with device-width by <code>vw</code>.</li>
<li>Leave margin to browser by <code>flex</code>.</li>
</ol>
<ul>
<li>pro</li>
</ul>
<ol>
<li>Border 1px problem is solved as before.</li>
<li>Decimals problem will be better than <code>vw</code>.</li>
</ol>
<ul>
<li>con</li>
</ul>
<ol>
<li>Decimals still exist but only has a little influence.</li>
</ol>
<h2>Ending</h2>
<p>Anyway, the decimals problem always exist because of different sizes of mobiles. But the more new API we have, the less influence it will have.</p>
<p>Besides, js above is not perfect. Here is the <a href="https://github.com/xianshenglu/mobile/blob/master/layout/">current</a> version I am using.</p>
<p>And the last thing is we didn't handle the problem with <code>img</code>. Maybe you should seek some help from <a href="https://github.com/strues/retinajs">retina.js</a>.</p>
<h2>Reference</h2>
<p><a href="../first-exploration-on-mobile/">first-exploration-on-mobile</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/@media/-webkit-device-pixel-ratio" target="_blank" rel="noopener">@media/-webkit-device-pixel-ratio</a></p>
<p><a href="https://github.com/amfe/lib-flexible">lib-flexible</a></p>
<p><a href="https://github.com/strues/retinajs">retina.js</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/xianshenglu/blog/blog/2018/06/first-exploration-on-mobile/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xianshenglu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/23273077">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey , you !">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/06/first-exploration-on-mobile/" itemprop="url">First Exploration on Mobile</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-14T14:11:45+08:00">
                2018-06-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/css/" itemprop="url" rel="index">
                    <span itemprop="name">css</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2,270
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>Preface</h2>
<p>Recently, I have been working on mobile development. Before this I have heard something strange but I didn't pay attention to. Now, I have to figure out though there is a lot of stuff. I am trying to make it clear as possible as I can but I am not sure content below is completely right.</p>
<h2>Basic concepts</h2>
<h3>Css Pixels, Physical Pixels and DPR</h3>
<p>First, let's start with demo:</p>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cont"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">html</span>,</span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cont</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.left</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: left;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20%</span>;</span><br><span class="line">  <span class="attribute">background</span>: lightblue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.right</span> &#123;</span><br><span class="line">  <span class="attribute">float</span>: right;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">20%</span>;</span><br><span class="line">  <span class="attribute">background</span>: yellowgreen;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Before switching to device mode, make sure you don't have code starts with <code>&lt;meta name=&quot;viewport&quot; ...</code> in your <code>head</code> tag.</p>
<p>Normally, we will find everything seems ok when we switch to mobile. For example, Let's switch to iPhone6.</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180614143059.png" alt=""></p>
<p>According to <a href="https://developer.chrome.com/devtools/docs/device-mode" target="_blank" rel="noopener">chrome-devtools</a>, width 375 and height 667 is <code>css pixels</code>. And before we keep going , we need to figure out some terms first including <code>css pixels</code>, <code>physical pixels</code> and <code>DPR</code>. Here is some related readings:</p>
<ul>
<li>
<p><a href="https://stackoverflow.com/questions/3588983/converting-between-physical-pixels-and-css-pixels" target="_blank" rel="noopener">converting-between-physical-pixels-and-css-pixels</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/8785643/what-exactly-is-device-pixel-ratio" target="_blank" rel="noopener">what-exactly-is-device-pixel-ratio</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener">mdn-devicePixelRatio</a></p>
</li>
</ul>
<p>After reading those stuff, I am still confused. But I can figure something out at least. Well, here is the point based on iPhone6:</p>
<ul>
<li>
<p>width 375 and height 667 is <code>css pixels</code></p>
</li>
<li>
<p><code>DPR</code> is 2</p>
</li>
<li>
<p><code>DPR</code> = <code>physical pixels</code>/<code>css pixels</code>. So <code>physical pixels</code> is 750*1334</p>
</li>
</ul>
<h3>Layout Viewport and Visual Viewport</h3>
<p>Ok, let's keep going. If you calculate the dimensions of viewport, you will get some strange values like below:</p>
<p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.clientWidth <span class="comment">//980</span></span><br><span class="line"><span class="built_in">document</span>.documentElement.clientHeight <span class="comment">//1743</span></span><br></pre></td></tr></table></figure></p>
<p>Maybe you thought that the value should be 375*667 or 750*1334. However, it doesn't. The result 980*1743 is the dimensions of <code>layout viewport</code>. Well, before keep going we need to know something about <code>layout viewport</code> and <code>visual viewport</code>. Here is the related articles:</p>
<ul>
<li>
<p><a href="https://www.quirksmode.org/mobile/viewports.html" target="_blank" rel="noopener">quirksmode-viewports</a></p>
</li>
<li>
<p><a href="https://www.quirksmode.org/mobile/viewports2.html" target="_blank" rel="noopener">quirksmode-viewports2</a></p>
</li>
<li>
<p><a href="https://quirksmode.org/mobile/viewports/" target="_blank" rel="noopener">quirksmode-viewports-app</a></p>
</li>
</ul>
<p>Based on the articles above we can be sure of something about <code>layout viewport</code> and <code>visual viewport</code>.</p>
<ul>
<li>
<p><code>layout viewport</code> is the area that the browser uses to calculate the dimensions of elements with percentual width.</p>
</li>
<li>
<p><code>visual viewport</code> is the part of the page thats currently shown on-screen. The user may scroll to change the part of the page he sees, or zoom to change the size of the <code>visual viewport</code>.</p>
</li>
<li>
<p>Zoom doesn't change the size of <code>layout viewport</code> but <code>visual viewport</code>.</p>
</li>
<li>
<p>The size of <code>visual viewport</code> &lt;= the size of <code>layout viewport</code>.</p>
</li>
<li>
<p>Both <code>layout viewport</code> and <code>visual viewport</code> are measured by <code>css pixels</code>.</p>
</li>
<li>
<p>Many mobile browsers initially show any page in fully zoomed-out mode to show the complete content of the site. Thus <code>layout viewport</code> is equal to the <code>visual viewport</code> at that moment.</p>
</li>
</ul>
<p>And in this case of iPhone6, here is something we can be sure of:</p>
<ul>
<li>
<p><code>layout viewport</code> is 980*1743</p>
</li>
<li>
<p><code>visual viewport</code> is also 980*1743</p>
</li>
<li>
<p>The mobile browser show the page in fully zoomed-out mode to show the complete content of the site.</p>
</li>
</ul>
<h3>Meta Tag</h3>
<p>Now, we know what happened when we switch to mobile mode. Also, we know why the size of font becomes smaller in visual.</p>
<p>However, we would want the <code>layout viewport</code> to be 375*667 or 750*1334 if we want to build a adaptive website. Fortunately, we can control the size of <code>layout viewport</code> by tag <code>meta</code>. For instance,</p>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=375,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>You can find the doc of <code>meta</code> in <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta#Specifications" target="_blank" rel="noopener">mdn-meta</a> and <code>viewport</code> in <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Mobile/Viewport_meta_tag" target="_blank" rel="noopener">mdn-viewport_meta_tag</a>. In the code above, we define 375px for the <code>width</code> of <code>layout viewport</code>. Here, 375px is <code>css pixels</code>. Also, you can prove it by:</p>
<p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.documentElement.clientWidth <span class="comment">//375</span></span><br><span class="line"><span class="built_in">document</span>.documentElement.clientHeight <span class="comment">//667</span></span><br></pre></td></tr></table></figure></p>
<p>So, any change? Yes. The change is the font-size is bigger in visual than before. Before we change the text is too small to read.</p>
<p>We can keep testing by change the <code>width</code> in <code>meta</code>. For example, let's try 750:</p>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=750,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Look what we got:</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180614143060.gif" alt=""></p>
<p>This makes sense. However, if you remove <code>user-scalable=no</code> in the <code>meta</code> the browser will again enter into the fully zoomed-out mode. In that case, you will find the font-size is smaller and the whole page is showed in the screen which make the effect of <code>initial-scale=1</code> disappear.</p>
<p>To be compatible with mobiles with different sizes we need to switch the number to <code>device-width</code>:</p>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1,user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>It is easy to understand, I think. Until now, it seems that we can be compatible with mobiles. Is that true?</p>
<h2>Adaptive Layout</h2>
<p>In the case above, we set <code>width:50%</code> for the <code>.left</code> and <code>.right</code> box. So, they could be adaptive. If we use <code>px</code> the page will not be adaptive because the size of viewport varies between mobiles. So, we have two choices</p>
<ol>
<li>Use different size according to the size of viewport</li>
<li>Use percentage always</li>
</ol>
<p>Option2 will work if our page is simple enough. In most instances, it will bring a disaster because of nested elements. One modification in parent will bring changes to all descendant elements.</p>
<p>The problem of option1 is if we can avoid writing so many media queries codes to adapt to different sizes of viewport. For example:</p>
<p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* ... other codes for .cont with different sizes */</span></span><br><span class="line">@<span class="keyword">media</span> (max-width: <span class="number">800px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.cont</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">media</span> (max-width: <span class="number">400px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.cont</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*... other codes for .cont with different sizes */</span></span><br></pre></td></tr></table></figure></p>
<p>Actually, we can avoid these codes. The key is <code>rem</code>. For example, code above can be simplified like:</p>
<p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">80px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.cont</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">2.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* no more codes for .cont with different sizes */</span></span><br></pre></td></tr></table></figure></p>
<p>When the size of viewport is 400px, we just need to update the <code>font-size</code> of <code>html</code> with <code>40px</code>. That is easy with js. Seems wonderful with <code>rem</code>? huh?</p>
<p>You can use <code>rem</code> everywhere and js just run one time. Here is the related lib <a href="https://github.com/amfe/lib-flexible">lib-flexible</a>.</p>
<h2>Latest Adaptive Layout</h2>
<p>Basically, there is no big problem with <code>rem</code>. Well, you might realize that we can totally use <code>vw</code> instead. That's correct! The compatibility has become better for most developers to use. The same thing happen to <code>flex</code> and <code>grid</code> layout. Until 2018.6, <code>flex</code> is a choice but we still need to wait for <code>grid</code> or look for some polyfill.</p>
<p>However, there is still some little problems when using <code>vw</code> or <code>rem</code> layout.</p>
<ul>
<li>We still use <code>px</code> for <code>font-size</code> and <code>border</code>.</li>
</ul>
<p>I think it is easy to understand because decimals would appear. In that case, we may get <code>15px</code> or <code>17px</code> instead of <code>16px</code>. At the same time, <code>border</code> may disappear because of some numbers like <code>0.9px</code>.</p>
<ul>
<li>Develop with plugins</li>
</ul>
<p>For instance, if we are developing based on iPhone6 whose width is 375px in css pixel while the designer gives us a PSD whose width is 750px, how we are going to do? Calculate the div with 75px and transform to 10% and write 10vw? So we calculate and write it one by one? That's terrible.</p>
<p>We can just write 75px and other numbers and leave the transform jobs to plugins(e.g. <code>less</code>,<code>postcss</code>.etc.).</p>
<h2>Problems Caused by DPR</h2>
<h3>Blurry or Sharp in Different DPR Device</h3>
<p>Until now, we haven't talked about DPR which we mentioned in the beginning. As <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener">mdn-devicepixelratio</a> says:</p>
<blockquote>
<p>In simpler terms, this tells the browser how many of the screen's actual pixels should be used to draw a single CSS pixel.</p>
</blockquote>
<p>On the desktop or before the appearance of Retina display, DPR is always equal to 1. However, things became complicated after that. At present, there is a lot of DPR on the market which varies from 1 to 4. Sometimes, there comes 1.5 or 2.75. Anyway, we will talk about it later.</p>
<p>We can always get DPR by <code>window.devicePixelRatio</code>. The problem is that on retina screens or device whose DPR more than 1 images will become blurry. Of course we will try to avoid that. So, we have to figure out what happened to those mobiles with bigger DPR.</p>
<p>According to <a href="https://www.smashingmagazine.com/2012/08/towards-retina-web/" target="_blank" rel="noopener">towards-retina-web</a>,</p>
<blockquote>
<p>A bitmap pixel is the smallest unit of data in a raster image (PNG, JPG, GIF, etc). Each pixel contains information on how it is to be displayed, including its position in the images coordinate system and its color.</p>
</blockquote>
<blockquote>
<p>Beside its raster resolution, an image on the Web has an abstract size, defined in CSS pixels. The browser squeezes or stretches the image based on its CSS height or width during the rendering process.</p>
</blockquote>
<blockquote>
<p>When a raster image is displayed at full size on a standard-density display, 1 bitmap pixel corresponds to 1 device pixel, resulting in a full-fidelity representation. Because a bitmap pixel cant be further divided, it gets multiplied by four on Retina displays(assuming DPR is 2) to preserve the same physical size of the image, losing detail along the way.</p>
</blockquote>
<p>For example, we got iPhone6 whose DPR is 2. And img we have is:</p>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"example.png"</span> <span class="attr">width</span>=<span class="string">"2"</span> <span class="attr">height</span>=<span class="string">"2"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>Assume that size of example.png is 2*2 and the picture is like:</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180615093229.png" alt=""></p>
<p>With DPR of 2, the browser has to use 2 device pixels to draw a single css pixel. So <code>img</code> with 2*2 css pixels will be drew by 4*4 device pixel which means example.png with 2*2 bitmap pixels will be drew by 4*4 device pixel. So, 4 bitmap pixels of example.png will be drew by 16 device pixels which means 1 bitmap pixel will be drew by 4 device pixels.</p>
<p>Let's move on, normally what we want might be:</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180615090536.png" alt=""></p>
<p>However, actual result will be:</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180615090453.png" alt=""></p>
<p>The result happens because 1 bitmap pixel can't be further divided into 4 device pixels. That's what @smashingmagazine says:</p>
<blockquote>
<p>A bitmap pixel is the smallest unit of data in a raster image (PNG, JPG, GIF, etc).</p>
</blockquote>
<blockquote>
<p>Because a bitmap pixel cant be further divided, it gets multiplied by four on Retina displays(assuming DPR is 2) to preserve the same physical size of the image, losing detail along the way.</p>
</blockquote>
<p>You can also find another example in <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener">mdn-devicepixelratio</a>.</p>
<p>So, how can we fix this? Basically, choices we have are listed as below:</p>
<ol>
<li>Change the size of <code>img</code>, for example:</li>
</ol>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"example.png"</span> <span class="attr">width</span>=<span class="string">"1"</span> <span class="attr">height</span>=<span class="string">"1"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>In this case, <code>img</code> with 1*1 css pixel will be drew by 2*2 device pixels which means example.png with 2*2 bitmap pixels will be divided by 2*2 device pixels. Hence, 1 bitmap pixel corresponds to 1 device pixel.</p>
<p>We might not use this alone because the layout would be affected.</p>
<ol start="2">
<li>Replace example.png with 4*4 and keep the original <code>img</code> with 2*2 css pixels, same explanation as above.</li>
</ol>
<p>In this case, we might do this by changing the <code>src</code> attribute in the <code>img</code>. For example, update the <code>src</code> search param <code>?v=2*2</code> with <code>?v=4*4</code> or change from example.png to example@2x.png. <a href="https://github.com/strues/retinajs">retinajs</a> will help you do this job.</p>
<ol start="3">
<li>
<p>Use icon-font instead of raster image.</p>
</li>
<li>
<p>Use svg instead.</p>
</li>
</ol>
<p>Actually, what you need to care about is not only <code>img</code> but also <code>background-image</code>. So, option1 and option2 will be not convenient without any other help(e.g. retinajs).</p>
<p>Also, with DPR smaller than 2 we need to switch size back. If not, image will become sharp which is the opposite process of blur. For instance:</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180615155759.png" alt=""></p>
<p>Compare with the process of blur:</p>
<p><img src="../images/%E6%88%AA%E5%9B%BE20180615090453.png" alt=""></p>
<p>Option3 and option4 would be easier. And with the help of <a href="http://www.iconfont.cn/" target="_blank" rel="noopener">iconfont</a>, things can be easier and easier when you choose svg.</p>
<p>Personally, I would choose option4 in daily work. For more information about the options, click <a href="https://www.smashingmagazine.com/2012/08/towards-retina-web/" target="_blank" rel="noopener">towards-retina-web</a>.</p>
<h3>Problems about Border</h3>
<p>Assume that we are using iPhone6 whose DPR is 2, border with 1 css pixel will be drew with 2 device pixels. Does that matter?</p>
<p>Yeah, sometimes that make the border thicker in visual. When we set 1px on border, actually what we might want is to set the thinnest border that device support. Normally, on desktop browser 1px is the thinnest. So in this case, you might need to talk with designer if he wants the thinnest border(e.g. 0.5px) or still 1px.</p>
<p>Anyway, there is lots of ways if we want to set the thinnest border. So, I wrote another blog to talk about that. Please check <a href="./layout-on-mobile.md">border on mobile</a>.</p>
<h2>Ending</h2>
<p>I have written too much about the basic knowledge about layout on mobile. However, there are still lots of problems I haven't mentioned. Anyway, I will write them in other blogs.</p>
<h2>Reference</h2>
<p><a href="https://www.quirksmode.org/mobile/viewports.html" target="_blank" rel="noopener">quirksmode-viewports</a></p>
<p><a href="https://www.quirksmode.org/mobile/viewports2.html" target="_blank" rel="noopener">quirksmode-viewports2</a></p>
<p><a href="https://quirksmode.org/mobile/viewports/" target="_blank" rel="noopener">quirksmode-viewports-app</a></p>
<p><a href="https://www.quirksmode.org/blog/archives/2010/04/a_pixel_is_not.html" target="_blank" rel="noopener">a_pixel_is_not</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta#Specifications" target="_blank" rel="noopener">mdn-meta</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Mobile/Viewport_meta_tag" target="_blank" rel="noopener">mdn-viewport_meta_tag</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio" target="_blank" rel="noopener">mdn-devicepixelratio</a></p>
<p><a href="https://drafts.csswg.org/mediaqueries-3/#units" target="_blank" rel="noopener">specs-mediaqueries-3</a></p>
<p><a href="https://developer.chrome.com/devtools/docs/device-mode" target="_blank" rel="noopener">chrome-devtools</a></p>
<p><a href="https://stackoverflow.com/questions/8785643/what-exactly-is-device-pixel-ratio" target="_blank" rel="noopener">what-exactly-is-device-pixel-ratio</a></p>
<p><a href="https://stackoverflow.com/questions/3588983/converting-between-physical-pixels-and-css-pixels" target="_blank" rel="noopener">converting-between-physical-pixels-and-css-pixels</a></p>
<p><a href="https://www.smashingmagazine.com/2012/08/towards-retina-web/" target="_blank" rel="noopener">towards-retina-web</a></p>
<p><a href="http://www.iconfont.cn/" target="_blank" rel="noopener">iconfont</a></p>
<p><a href="https://github.com/strues/retinajs">retinajs</a></p>
<p><a href="https://github.com/amfe/lib-flexible">lib-flexible</a></p>
<p>Chinese:</p>
<p><a href="https://segmentfault.com/a/1190000004336869" target="_blank" rel="noopener">()</a></p>
<p><a href="https://segmentfault.com/a/1190000004358316" target="_blank" rel="noopener">()</a></p>
<p><a href="http://www.html-js.com/article/Mobile-terminal-H5-mobile-terminal-HD-multi-screen-adaptation-scheme%203041" target="_blank" rel="noopener"></a></p>
<p><a href="https://www.w3cplus.com/mobile/lib-flexible-for-html5-layout.html" target="_blank" rel="noopener"> flexible  h5 </a></p>
<p><a href="https://www.w3cplus.com/mobile/vw-layout-in-vue.html" target="_blank" rel="noopener"> vue  vw </a></p>
<p><a href="https://www.w3cplus.com/css/vw-for-layout.html" target="_blank" rel="noopener"></a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/xianshenglu/blog/blog/2018/06/label-can-t-be-focused-in-firefox-with-element.focus()/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xianshenglu">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/23273077">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hey , you !">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/blog/2018/06/label-can-t-be-focused-in-firefox-with-element.focus()/" itemprop="url">Label Can't Be Focused In Firefox With Element.focus()</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-10T11:13:18+08:00">
                2018-06-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/html/" itemprop="url" rel="index">
                    <span itemprop="name">html</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  120
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2>Preface</h2>
<p>As the title says, let's see the demo below:</p>
<h2>Main</h2>
<p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">id</span>=<span class="string">"cont"</span> <span class="attr">contentEditable</span>&gt;</span></span><br><span class="line">   label should be focused</span><br><span class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"focus"</span>&gt;</span>make label focus<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#cont</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">background</span>: pink;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">150px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'#focus'</span>)[<span class="number">0</span>].onclick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  $(<span class="string">'#cont'</span>)[<span class="number">0</span>].focus()</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">'#cont'</span>)[<span class="number">0</span>].onfocus = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(event.type)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">$</span>(<span class="params">selector</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="built_in">document</span>.querySelectorAll(selector))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Suppose that you are using chrome, after loaded please press <code>F12</code> and open the console and then click the button. <code>label#cont</code> should be focused after clicking the button.So, there will be word <code>focus</code> at the console.</p>
<p>However, firefox wouldn't do that until you click the label. Anyway, I have posted a <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1468049" target="_blank" rel="noopener">bug</a>. Let's see what will happen.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/blog/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/15/">15</a><a class="extend next" rel="next" href="/blog/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars3.githubusercontent.com/u/23273077"
                alt="xianshenglu" />
            
              <p class="site-author-name" itemprop="name">xianshenglu</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/blog/archives/">
              
                  <span class="site-state-item-count">44</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/blog/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/blog/tags/index.html">
                  <span class="site-state-item-count">111</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/xianshenglu" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://stackoverflow.com/users/9147721/xianshenglu" target="_blank" title="StackOverflow">
                      
                        <i class="fa fa-fw fa-stack-overflow"></i>StackOverflow</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:xianshenglu@foxmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xianshenglu</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.4</div>



  <div class="footer-custom">Hosted by <a target="_blank" href="https://pages.github.com">GitHub Pages</a></div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/blog/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/blog/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/blog/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/blog/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/blog/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/blog/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  
  <script type="text/javascript" src="/blog/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/blog/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
